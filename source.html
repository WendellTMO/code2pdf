<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>ACID Evolution</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">ACID Evolution</h1>
</header>
<!-- title only -->
<!-- <h1 style="text-align:center;">ACID Evolution</h1> -->
<!-- title with div -->
<!-- <div style="text-align:center;">
  <h3>Automated Categorizer of Infrastructure as code Defects Evolution</h3>
</div> -->
<h2 id="python-codes">Python Codes</h2>
<h3 id="main-code">Main Code</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> excavator</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> constants</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> pickle</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">import</span> time</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">import</span> datetime</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">import</span> sys </span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">import</span> git</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">import</span> nltk</span>
<span id="cb1-11"><a href="#cb1-11"></a>nltk.download(<span class="st">&#39;punkt&#39;</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a>nltk.download(<span class="st">&#39;punkt_tab&#39;</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">This script goes to each repo and mines commits and commit messages and then get the defect category </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="kw">def</span> getBranchName(path):</span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="cf">try</span>:</span>
<span id="cb1-19"><a href="#cb1-19"></a>        repo <span class="op">=</span> git.Repo(path)</span>
<span id="cb1-20"><a href="#cb1-20"></a>        default_branch_ref <span class="op">=</span> repo.git.symbolic_ref(<span class="st">&#39;refs/remotes/origin/HEAD&#39;</span>)</span>
<span id="cb1-21"><a href="#cb1-21"></a>        default_branch <span class="op">=</span> default_branch_ref.replace(<span class="st">&#39;refs/remotes/origin/&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb1-22"><a href="#cb1-22"></a>        <span class="cf">return</span> default_branch</span>
<span id="cb1-23"><a href="#cb1-23"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-24"><a href="#cb1-24"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Error selecting Branch repo </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb1-25"><a href="#cb1-25"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="kw">def</span> giveTimeStamp():</span>
<span id="cb1-28"><a href="#cb1-28"></a>  tsObj <span class="op">=</span> time.time()</span>
<span id="cb1-29"><a href="#cb1-29"></a>  strToret <span class="op">=</span> datetime.datetime.fromtimestamp(tsObj).strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="cf">return</span> strToret</span>
<span id="cb1-31"><a href="#cb1-31"></a></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="cf">if</span> <span class="va">__name__</span><span class="op">==</span><span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a>    t1 <span class="op">=</span> time.time()</span>
<span id="cb1-35"><a href="#cb1-35"></a>    <span class="bu">print</span>(<span class="st">&#39;Started at:&#39;</span>, giveTimeStamp()) </span>
<span id="cb1-36"><a href="#cb1-36"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb1-37"><a href="#cb1-37"></a></span>
<span id="cb1-38"><a href="#cb1-38"></a>    flag_arg <span class="op">=</span> sys.argv[sys.argv.index(<span class="st">&quot;--flag-arg&quot;</span>) <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb1-39"><a href="#cb1-39"></a>    <span class="cf">if</span> flag_arg <span class="op">==</span> <span class="st">&#39;-x&#39;</span>: </span>
<span id="cb1-40"><a href="#cb1-40"></a>       orgName<span class="op">=</span><span class="st">&#39;EXTRA&#39;</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>       <span class="bu">print</span>(<span class="st">&#39;ACID will now run on extra testing repos&#39;</span>)</span>
<span id="cb1-42"><a href="#cb1-42"></a>       out_fil_nam <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/EXTRA2_TEST_ONLY.PKL&#39;</span></span>
<span id="cb1-43"><a href="#cb1-43"></a>       out_csv_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/EXTRA2_TEST_ONLY_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb1-44"><a href="#cb1-44"></a>       out_pkl_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/EXTRA2_TEST_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span></span>
<span id="cb1-45"><a href="#cb1-45"></a>    <span class="cf">elif</span> flag_arg <span class="op">==</span> <span class="st">&quot;-replication&quot;</span>:</span>
<span id="cb1-46"><a href="#cb1-46"></a>        orgName <span class="op">=</span> <span class="st">&#39;PIPR-replication&#39;</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>        <span class="bu">print</span>(<span class="st">&#39;ACID will now run on PIPr Replication repos&#39;</span>)</span>
<span id="cb1-48"><a href="#cb1-48"></a>        out_fil_nam <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/REPLICATION_ONLY.PKL&#39;</span></span>
<span id="cb1-49"><a href="#cb1-49"></a>        out_csv_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/REPLICATION_ONLY_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb1-50"><a href="#cb1-50"></a>        out_pkl_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/REPLICATION_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span></span>
<span id="cb1-51"><a href="#cb1-51"></a>    <span class="cf">elif</span> flag_arg <span class="op">==</span> <span class="st">&quot;-t&quot;</span>:</span>
<span id="cb1-52"><a href="#cb1-52"></a>        orgName<span class="op">=</span><span class="st">&#39;TEST&#39;</span></span>
<span id="cb1-53"><a href="#cb1-53"></a>        <span class="bu">print</span>(<span class="st">&#39;ACID will now run on default testing repos&#39;</span>)</span>
<span id="cb1-54"><a href="#cb1-54"></a>        out_fil_nam <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/TEST2_ONLY.PKL&#39;</span></span>
<span id="cb1-55"><a href="#cb1-55"></a>        out_csv_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/TEST2_ONLY_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>        out_pkl_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/TEST2_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span> </span>
<span id="cb1-57"><a href="#cb1-57"></a>    <span class="cf">else</span>:</span>
<span id="cb1-58"><a href="#cb1-58"></a>        orgName <span class="op">=</span> flag_arg</span>
<span id="cb1-59"><a href="#cb1-59"></a>        <span class="bu">print</span>(<span class="ss">f&#39;ACID will now run on </span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss"> repos&#39;</span>)</span>
<span id="cb1-60"><a href="#cb1-60"></a>        output_location <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--output&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb1-61"><a href="#cb1-61"></a>        out_fil_nam     <span class="op">=</span> output_location <span class="op">+</span> <span class="ss">f&#39;/</span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss">_ONLY.PKL&#39;</span></span>
<span id="cb1-62"><a href="#cb1-62"></a>        out_csv_fil     <span class="op">=</span> output_location <span class="op">+</span> <span class="ss">f&#39;/</span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss">_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb1-63"><a href="#cb1-63"></a>        out_pkl_fil     <span class="op">=</span> output_location <span class="op">+</span> <span class="ss">f&#39;/</span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss">_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span></span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a>    <span class="cf">if</span> orgName <span class="op">==</span> <span class="st">&#39;EXTRA&#39;</span> <span class="kw">or</span> orgName <span class="op">==</span> <span class="st">&quot;TEST&quot;</span> <span class="kw">or</span> orgName <span class="op">==</span> <span class="st">&quot;PIPR-replication&quot;</span>:</span>
<span id="cb1-66"><a href="#cb1-66"></a>        csv_replication <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-67"><a href="#cb1-67"></a>        csv_default     <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-68"><a href="#cb1-68"></a>    <span class="cf">else</span>:</span>
<span id="cb1-69"><a href="#cb1-69"></a>        csv_replication <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--csv-replication&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb1-70"><a href="#cb1-70"></a>        csv_default     <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--csv-default&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb1-71"><a href="#cb1-71"></a>        </span>
<span id="cb1-72"><a href="#cb1-72"></a>    script_dir <span class="op">=</span> os.path.dirname(os.path.abspath(<span class="va">__file__</span>))</span>
<span id="cb1-73"><a href="#cb1-73"></a>    pathRepo <span class="op">=</span> script_dir <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> constants.DATASET_DIR <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> orgName <span class="op">+</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb1-74"><a href="#cb1-74"></a>    fileName <span class="op">=</span> pathRepo <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> constants.REPO_FILE_LIST</span>
<span id="cb1-75"><a href="#cb1-75"></a>    elgibleRepos <span class="op">=</span> excavator.getEligibleProjects(fileName)</span>
<span id="cb1-76"><a href="#cb1-76"></a>    dic   <span class="op">=</span> {}</span>
<span id="cb1-77"><a href="#cb1-77"></a>    categ <span class="op">=</span> []</span>
<span id="cb1-78"><a href="#cb1-78"></a>    <span class="cf">for</span> proj_ <span class="kw">in</span> elgibleRepos:</span>
<span id="cb1-79"><a href="#cb1-79"></a>        <span class="cf">try</span>:</span>
<span id="cb1-80"><a href="#cb1-80"></a>            <span class="cf">if</span> proj_ <span class="op">==</span> constants.REPO_FILE_LIST:</span>
<span id="cb1-81"><a href="#cb1-81"></a>                <span class="cf">continue</span></span>
<span id="cb1-82"><a href="#cb1-82"></a>            path_proj <span class="op">=</span> pathRepo <span class="op">+</span> proj_</span>
<span id="cb1-83"><a href="#cb1-83"></a>            branchName <span class="op">=</span> getBranchName(path_proj) </span>
<span id="cb1-84"><a href="#cb1-84"></a>            per_proj_commit_dict, per_proj_full_defect_list <span class="op">=</span> excavator.runMiner(orgName, proj_, branchName, csv_file_path<span class="op">=</span>csv_replication, csv_default<span class="op">=</span>csv_default)</span>
<span id="cb1-85"><a href="#cb1-85"></a>            categ <span class="op">=</span> categ <span class="op">+</span> per_proj_full_defect_list </span>
<span id="cb1-86"><a href="#cb1-86"></a>            <span class="co"># print proj_ , len(per_proj_full_defect_list) </span></span>
<span id="cb1-87"><a href="#cb1-87"></a>            <span class="bu">print</span>(<span class="st">&#39;Finished analyzing:&#39;</span>, proj_)</span>
<span id="cb1-88"><a href="#cb1-88"></a>            dic[proj_] <span class="op">=</span> (per_proj_commit_dict, per_proj_full_defect_list)</span>
<span id="cb1-89"><a href="#cb1-89"></a>            <span class="co"># print(dic[proj_])</span></span>
<span id="cb1-90"><a href="#cb1-90"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-91"><a href="#cb1-91"></a>            <span class="bu">print</span>(e)</span>
<span id="cb1-92"><a href="#cb1-92"></a>        <span class="bu">print</span>(<span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">50</span>)  </span>
<span id="cb1-93"><a href="#cb1-93"></a>    </span>
<span id="cb1-94"><a href="#cb1-94"></a>    all_proj_df <span class="op">=</span> pd.DataFrame(categ) </span>
<span id="cb1-95"><a href="#cb1-95"></a>    all_proj_df.to_csv(out_csv_fil, header<span class="op">=</span>[<span class="st">&#39;HASH&#39;</span>,<span class="st">&#39;CATEG&#39;</span>,<span class="st">&#39;REPO&#39;</span>,<span class="st">&#39;TIME&#39;</span>], index<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb1-96"><a href="#cb1-96"></a></span>
<span id="cb1-97"><a href="#cb1-97"></a>    <span class="cf">with</span> <span class="bu">open</span>(out_pkl_fil, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> fp_:</span>
<span id="cb1-98"><a href="#cb1-98"></a>        pickle.dump(dic, fp_)  </span>
<span id="cb1-99"><a href="#cb1-99"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb1-100"><a href="#cb1-100"></a>    <span class="bu">print</span>(<span class="st">&#39;Ended at:&#39;</span>, giveTimeStamp())</span>
<span id="cb1-101"><a href="#cb1-101"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb1-102"><a href="#cb1-102"></a>    t2 <span class="op">=</span> time.time()</span>
<span id="cb1-103"><a href="#cb1-103"></a>    time_diff <span class="op">=</span> <span class="bu">round</span>( (t2 <span class="op">-</span> t1 ) <span class="op">/</span> <span class="dv">60</span>, <span class="dv">5</span>) </span>
<span id="cb1-104"><a href="#cb1-104"></a>    <span class="bu">print</span>(<span class="st">&quot;Duration: </span><span class="sc">{}</span><span class="st"> minutes&quot;</span>.<span class="bu">format</span>(time_diff))</span>
<span id="cb1-105"><a href="#cb1-105"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)        </span></code></pre></div>
<h3 id="main-concurrent-code">Main Concurrent Code</h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">import</span> excavator</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">import</span> constants</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="im">import</span> pickle</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="im">import</span> time</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="im">import</span> datetime</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="im">import</span> sys </span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="im">import</span> git</span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="im">import</span> concurrent.futures</span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="im">import</span> nltk</span>
<span id="cb2-12"><a href="#cb2-12"></a>nltk.download(<span class="st">&#39;punkt&#39;</span>)</span>
<span id="cb2-13"><a href="#cb2-13"></a>nltk.download(<span class="st">&#39;punkt_tab&#39;</span>)</span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">This script goes to each repo and mines commits and commit messages and then get the defect category </span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="kw">def</span> getBranchName(path):</span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="cf">try</span>:</span>
<span id="cb2-20"><a href="#cb2-20"></a>        repo <span class="op">=</span> git.Repo(path)</span>
<span id="cb2-21"><a href="#cb2-21"></a>        default_branch_ref <span class="op">=</span> repo.git.symbolic_ref(<span class="st">&#39;refs/remotes/origin/HEAD&#39;</span>)</span>
<span id="cb2-22"><a href="#cb2-22"></a>        default_branch <span class="op">=</span> default_branch_ref.replace(<span class="st">&#39;refs/remotes/origin/&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb2-23"><a href="#cb2-23"></a>        <span class="cf">return</span> default_branch</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb2-25"><a href="#cb2-25"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Error selecting Branch repo </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-26"><a href="#cb2-26"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb2-27"><a href="#cb2-27"></a></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="kw">def</span> giveTimeStamp():</span>
<span id="cb2-29"><a href="#cb2-29"></a>  tsObj <span class="op">=</span> time.time()</span>
<span id="cb2-30"><a href="#cb2-30"></a>  strToret <span class="op">=</span> datetime.datetime.fromtimestamp(tsObj).strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb2-31"><a href="#cb2-31"></a>  <span class="cf">return</span> strToret</span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="cf">if</span> <span class="va">__name__</span><span class="op">==</span><span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb2-34"><a href="#cb2-34"></a></span>
<span id="cb2-35"><a href="#cb2-35"></a>    t1 <span class="op">=</span> time.time()</span>
<span id="cb2-36"><a href="#cb2-36"></a>    <span class="bu">print</span>(<span class="st">&#39;Started at:&#39;</span>, giveTimeStamp()) </span>
<span id="cb2-37"><a href="#cb2-37"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb2-38"><a href="#cb2-38"></a></span>
<span id="cb2-39"><a href="#cb2-39"></a>    flag_arg <span class="op">=</span> sys.argv[sys.argv.index(<span class="st">&quot;--flag-arg&quot;</span>) <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb2-40"><a href="#cb2-40"></a>    <span class="cf">if</span> flag_arg <span class="op">==</span> <span class="st">&#39;-x&#39;</span>: </span>
<span id="cb2-41"><a href="#cb2-41"></a>       orgName<span class="op">=</span><span class="st">&#39;EXTRA&#39;</span></span>
<span id="cb2-42"><a href="#cb2-42"></a>       <span class="bu">print</span>(<span class="st">&#39;ACID will now run on extra testing repos&#39;</span>)</span>
<span id="cb2-43"><a href="#cb2-43"></a>       out_fil_nam <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/EXTRA2_TEST_ONLY.PKL&#39;</span></span>
<span id="cb2-44"><a href="#cb2-44"></a>       out_csv_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/EXTRA2_TEST_ONLY_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb2-45"><a href="#cb2-45"></a>       out_pkl_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/EXTRA2_TEST_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span></span>
<span id="cb2-46"><a href="#cb2-46"></a>    <span class="cf">elif</span> flag_arg <span class="op">==</span> <span class="st">&quot;-replication&quot;</span>:</span>
<span id="cb2-47"><a href="#cb2-47"></a>        orgName <span class="op">=</span> <span class="st">&#39;PIPR-replication&#39;</span></span>
<span id="cb2-48"><a href="#cb2-48"></a>        <span class="bu">print</span>(<span class="st">&#39;ACID will now run on PIPr Replication repos&#39;</span>)</span>
<span id="cb2-49"><a href="#cb2-49"></a>        out_fil_nam <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/REPLICATION_ONLY.PKL&#39;</span></span>
<span id="cb2-50"><a href="#cb2-50"></a>        out_csv_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/REPLICATION_ONLY_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb2-51"><a href="#cb2-51"></a>        out_pkl_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/REPLICATION_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span></span>
<span id="cb2-52"><a href="#cb2-52"></a>    <span class="cf">elif</span> flag_arg <span class="op">==</span> <span class="st">&quot;-t&quot;</span>:</span>
<span id="cb2-53"><a href="#cb2-53"></a>        orgName<span class="op">=</span><span class="st">&#39;TEST&#39;</span></span>
<span id="cb2-54"><a href="#cb2-54"></a>        <span class="bu">print</span>(<span class="st">&#39;ACID will now run on default testing repos&#39;</span>)</span>
<span id="cb2-55"><a href="#cb2-55"></a>        out_fil_nam <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/TEST2_ONLY.PKL&#39;</span></span>
<span id="cb2-56"><a href="#cb2-56"></a>        out_csv_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/TEST2_ONLY_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb2-57"><a href="#cb2-57"></a>        out_pkl_fil <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/OUTPUT/TEST2_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span> </span>
<span id="cb2-58"><a href="#cb2-58"></a>    <span class="cf">else</span>:</span>
<span id="cb2-59"><a href="#cb2-59"></a>        orgName <span class="op">=</span> flag_arg</span>
<span id="cb2-60"><a href="#cb2-60"></a>        <span class="bu">print</span>(<span class="ss">f&#39;ACID will now run on </span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss"> repos&#39;</span>)</span>
<span id="cb2-61"><a href="#cb2-61"></a>        output_location <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--output&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb2-62"><a href="#cb2-62"></a>        out_fil_nam     <span class="op">=</span> output_location <span class="op">+</span> <span class="ss">f&#39;/</span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss">_ONLY.PKL&#39;</span></span>
<span id="cb2-63"><a href="#cb2-63"></a>        out_csv_fil     <span class="op">=</span> output_location <span class="op">+</span> <span class="ss">f&#39;/</span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss">_CATEG_OUTPUT_FINAL.csv&#39;</span></span>
<span id="cb2-64"><a href="#cb2-64"></a>        out_pkl_fil     <span class="op">=</span> output_location <span class="op">+</span> <span class="ss">f&#39;/</span><span class="sc">{</span>flag_arg<span class="sc">}</span><span class="ss">_ONLY_CATEG_OUTPUT_FINAL.PKL&#39;</span></span>
<span id="cb2-65"><a href="#cb2-65"></a>    <span class="kw">def</span> process_project(orgName, proj_, pathRepo, dic, categ, csv_replication, csv_default):</span>
<span id="cb2-66"><a href="#cb2-66"></a>     <span class="cf">try</span>:</span>
<span id="cb2-67"><a href="#cb2-67"></a>        <span class="cf">if</span> proj_ <span class="op">==</span> constants.REPO_FILE_LIST: <span class="cf">return</span></span>
<span id="cb2-68"><a href="#cb2-68"></a>        path_proj <span class="op">=</span> pathRepo <span class="op">+</span> proj_</span>
<span id="cb2-69"><a href="#cb2-69"></a>        branchName <span class="op">=</span> getBranchName(path_proj)</span>
<span id="cb2-70"><a href="#cb2-70"></a>        </span>
<span id="cb2-71"><a href="#cb2-71"></a>        <span class="cf">if</span> branchName <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-72"><a href="#cb2-72"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f&quot;Branch name not found for project </span><span class="sc">{</span>proj_<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-73"><a href="#cb2-73"></a></span>
<span id="cb2-74"><a href="#cb2-74"></a>        per_proj_commit_dict, per_proj_full_defect_list <span class="op">=</span> excavator.runMiner(orgName, proj_, branchName, csv_replication, csv_default)</span>
<span id="cb2-75"><a href="#cb2-75"></a>        </span>
<span id="cb2-76"><a href="#cb2-76"></a>        categ <span class="op">+=</span> per_proj_full_defect_list</span>
<span id="cb2-77"><a href="#cb2-77"></a>        dic[proj_] <span class="op">=</span> (per_proj_commit_dict, per_proj_full_defect_list)</span>
<span id="cb2-78"><a href="#cb2-78"></a></span>
<span id="cb2-79"><a href="#cb2-79"></a>        <span class="bu">print</span>(<span class="ss">f&#39;Finished analyzing: </span><span class="sc">{</span>proj_<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb2-80"><a href="#cb2-80"></a>        <span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb2-81"><a href="#cb2-81"></a>     <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb2-82"><a href="#cb2-82"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Error processing project </span><span class="sc">{</span>proj_<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-83"><a href="#cb2-83"></a></span>
<span id="cb2-84"><a href="#cb2-84"></a>    <span class="kw">def</span> run_in_parallel(orgName, elgibleRepos, pathRepo, dic, categ, csv_replication, csv_default):</span>
<span id="cb2-85"><a href="#cb2-85"></a>     <span class="cf">with</span> concurrent.futures.ThreadPoolExecutor() <span class="im">as</span> executor:</span>
<span id="cb2-86"><a href="#cb2-86"></a>        futures <span class="op">=</span> [executor.submit(process_project, orgName, proj_, pathRepo, dic, categ, csv_replication, csv_default) <span class="cf">for</span> proj_ <span class="kw">in</span> elgibleRepos]</span>
<span id="cb2-87"><a href="#cb2-87"></a>        </span>
<span id="cb2-88"><a href="#cb2-88"></a>        <span class="co"># Wait for all tasks to complete and handle exceptions</span></span>
<span id="cb2-89"><a href="#cb2-89"></a>        <span class="cf">for</span> future <span class="kw">in</span> concurrent.futures.as_completed(futures):</span>
<span id="cb2-90"><a href="#cb2-90"></a>            <span class="cf">try</span>:</span>
<span id="cb2-91"><a href="#cb2-91"></a>                future.result()  <span class="co"># Retrieve the result of the task (or raise any exceptions)</span></span>
<span id="cb2-92"><a href="#cb2-92"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb2-93"><a href="#cb2-93"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Task raised an exception: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-94"><a href="#cb2-94"></a>    </span>
<span id="cb2-95"><a href="#cb2-95"></a>    <span class="cf">if</span> orgName <span class="op">==</span> <span class="st">&#39;EXTRA&#39;</span> <span class="kw">or</span> orgName <span class="op">==</span> <span class="st">&quot;TEST&quot;</span> <span class="kw">or</span> orgName <span class="op">==</span> <span class="st">&quot;PIPR-replication&quot;</span>:</span>
<span id="cb2-96"><a href="#cb2-96"></a>        csv_replication <span class="op">=</span> <span class="va">None</span></span>
<span id="cb2-97"><a href="#cb2-97"></a>        csv_default     <span class="op">=</span> <span class="va">None</span></span>
<span id="cb2-98"><a href="#cb2-98"></a>    <span class="cf">else</span>:</span>
<span id="cb2-99"><a href="#cb2-99"></a>        csv_replication <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--csv-replication&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb2-100"><a href="#cb2-100"></a>        csv_default     <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--csv-default&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb2-101"><a href="#cb2-101"></a>        </span>
<span id="cb2-102"><a href="#cb2-102"></a>    script_dir <span class="op">=</span> os.path.dirname(os.path.abspath(<span class="va">__file__</span>))</span>
<span id="cb2-103"><a href="#cb2-103"></a>    pathRepo <span class="op">=</span> script_dir <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> constants.DATASET_DIR <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> orgName <span class="op">+</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb2-104"><a href="#cb2-104"></a>    fileName <span class="op">=</span> pathRepo <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> constants.REPO_FILE_LIST</span>
<span id="cb2-105"><a href="#cb2-105"></a>    elgibleRepos <span class="op">=</span> excavator.getEligibleProjects(fileName)</span>
<span id="cb2-106"><a href="#cb2-106"></a>    dic   <span class="op">=</span> {}</span>
<span id="cb2-107"><a href="#cb2-107"></a>    categ <span class="op">=</span> []</span>
<span id="cb2-108"><a href="#cb2-108"></a>    run_in_parallel(orgName, elgibleRepos, pathRepo, dic, categ, csv_replication, csv_default)</span>
<span id="cb2-109"><a href="#cb2-109"></a>    </span>
<span id="cb2-110"><a href="#cb2-110"></a>    all_proj_df <span class="op">=</span> pd.DataFrame(categ) </span>
<span id="cb2-111"><a href="#cb2-111"></a>    all_proj_df.to_csv(out_csv_fil, header<span class="op">=</span>[<span class="st">&#39;HASH&#39;</span>,<span class="st">&#39;CATEG&#39;</span>,<span class="st">&#39;REPO&#39;</span>,<span class="st">&#39;TIME&#39;</span>], index<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb2-112"><a href="#cb2-112"></a></span>
<span id="cb2-113"><a href="#cb2-113"></a>    <span class="cf">with</span> <span class="bu">open</span>(out_pkl_fil, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> fp_:</span>
<span id="cb2-114"><a href="#cb2-114"></a>        pickle.dump(dic, fp_)  </span>
<span id="cb2-115"><a href="#cb2-115"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb2-116"><a href="#cb2-116"></a>    <span class="bu">print</span>(<span class="st">&#39;Ended at:&#39;</span>, giveTimeStamp())</span>
<span id="cb2-117"><a href="#cb2-117"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb2-118"><a href="#cb2-118"></a>    t2 <span class="op">=</span> time.time()</span>
<span id="cb2-119"><a href="#cb2-119"></a>    time_diff <span class="op">=</span> <span class="bu">round</span>( (t2 <span class="op">-</span> t1 ) <span class="op">/</span> <span class="dv">60</span>, <span class="dv">5</span>) </span>
<span id="cb2-120"><a href="#cb2-120"></a>    <span class="bu">print</span>(<span class="st">&quot;Duration: </span><span class="sc">{}</span><span class="st"> minutes&quot;</span>.<span class="bu">format</span>(time_diff))</span>
<span id="cb2-121"><a href="#cb2-121"></a>    <span class="bu">print</span>(<span class="st">&#39;*&#39;</span><span class="op">*</span><span class="dv">100</span>)        </span></code></pre></div>
<h3 id="excavator-code">Excavator Code</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">from</span>    nltk.tokenize  <span class="im">import</span> sent_tokenize</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">from</span>    git            <span class="im">import</span> Repo</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span>  os </span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">import</span>  csv </span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="im">import</span>  numpy <span class="im">as</span> np</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">import</span>  sys</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="im">import</span>  subprocess</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="im">import</span>  constants</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="im">import</span>  classifier</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="im">import</span>  ast</span>
<span id="cb3-11"><a href="#cb3-11"></a>csv.field_size_limit(sys.maxsize)</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">def</span> getEligibleProjects(fileNameParam):</span>
<span id="cb3-15"><a href="#cb3-15"></a>  repo_list <span class="op">=</span> []</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="cf">with</span> <span class="bu">open</span>(fileNameParam, constants.FILE_READ_MODE) <span class="im">as</span> f:</span>
<span id="cb3-17"><a href="#cb3-17"></a>    reader <span class="op">=</span> csv.reader(f)</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="cf">for</span> row <span class="kw">in</span> reader:</span>
<span id="cb3-19"><a href="#cb3-19"></a>      repo_list.append(row[<span class="dv">0</span>])</span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="cf">return</span> repo_list</span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="kw">def</span> getPuppetFilesOfRepo(repo_dir_absolute_path):</span>
<span id="cb3-23"><a href="#cb3-23"></a>    pp_, non_pp <span class="op">=</span> [], []</span>
<span id="cb3-24"><a href="#cb3-24"></a>    <span class="cf">for</span> root_, dirs, files_ <span class="kw">in</span> os.walk(repo_dir_absolute_path):</span>
<span id="cb3-25"><a href="#cb3-25"></a>      <span class="cf">for</span> file_ <span class="kw">in</span> files_:</span>
<span id="cb3-26"><a href="#cb3-26"></a>        full_p_file <span class="op">=</span> os.path.join(root_, file_)</span>
<span id="cb3-27"><a href="#cb3-27"></a>        <span class="cf">if</span>((os.path.exists(full_p_file)) <span class="kw">and</span> (constants.AST_PATH <span class="kw">not</span> <span class="kw">in</span> full_p_file) ):</span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#             if (full_p_file.endswith(constants.PP_EXTENSION)):</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>          <span class="cf">if</span> <span class="bu">any</span>(full_p_file.endswith(ext) <span class="cf">for</span> ext <span class="kw">in</span> constants.IAC_FILES):</span>
<span id="cb3-30"><a href="#cb3-30"></a>            pp_.append(full_p_file)</span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="cf">return</span> pp_</span>
<span id="cb3-32"><a href="#cb3-32"></a></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="kw">def</span> getRelPathOfFiles(all_pp_param, repo_dir_absolute_path):</span>
<span id="cb3-34"><a href="#cb3-34"></a>  common_path <span class="op">=</span> repo_dir_absolute_path</span>
<span id="cb3-35"><a href="#cb3-35"></a>  files_relative_paths <span class="op">=</span> [os.path.relpath(path, common_path) <span class="cf">for</span> path <span class="kw">in</span> all_pp_param]</span>
<span id="cb3-36"><a href="#cb3-36"></a>  <span class="cf">return</span> files_relative_paths </span>
<span id="cb3-37"><a href="#cb3-37"></a></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="kw">def</span> getPuppRelatedCommits(repo_dir_absolute_path, ppListinRepo, branchName<span class="op">=</span>constants.MASTER_BRANCH):</span>
<span id="cb3-39"><a href="#cb3-39"></a>  mappedPuppetList<span class="op">=</span>[]</span>
<span id="cb3-40"><a href="#cb3-40"></a>  track_exec_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-41"><a href="#cb3-41"></a>  repo_  <span class="op">=</span> Repo(repo_dir_absolute_path)</span>
<span id="cb3-42"><a href="#cb3-42"></a>  all_commits <span class="op">=</span> <span class="bu">list</span>(repo_.iter_commits(branchName))</span>
<span id="cb3-43"><a href="#cb3-43"></a>  <span class="cf">for</span> each_commit <span class="kw">in</span> all_commits:</span>
<span id="cb3-44"><a href="#cb3-44"></a>    track_exec_cnt <span class="op">=</span> track_exec_cnt <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-45"><a href="#cb3-45"></a></span>
<span id="cb3-46"><a href="#cb3-46"></a>    cmd_of_interrest1 <span class="op">=</span> constants.CHANGE_DIR_CMD <span class="op">+</span> repo_dir_absolute_path <span class="op">+</span> <span class="st">&quot; ; &quot;</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>    cmd_of_interrest2 <span class="op">=</span> constants.GIT_COMM_CMD_1 <span class="op">+</span> <span class="bu">str</span>(each_commit)  <span class="op">+</span>  constants.GIT_COMM_CMD_2</span>
<span id="cb3-48"><a href="#cb3-48"></a>    cmd_of_interrest <span class="op">=</span> cmd_of_interrest1 <span class="op">+</span> cmd_of_interrest2</span>
<span id="cb3-49"><a href="#cb3-49"></a>    commit_of_interest  <span class="op">=</span> <span class="bu">str</span>(subprocess.check_output([constants.BASH_CMD, constants.BASH_FLAG, cmd_of_interrest])) <span class="co">#in Python 3 subprocess.check_output returns byte</span></span>
<span id="cb3-50"><a href="#cb3-50"></a></span>
<span id="cb3-51"><a href="#cb3-51"></a>    <span class="cf">for</span> ppFile <span class="kw">in</span> ppListinRepo:</span>
<span id="cb3-52"><a href="#cb3-52"></a>      <span class="cf">if</span> ppFile <span class="kw">in</span> commit_of_interest:</span>
<span id="cb3-53"><a href="#cb3-53"></a>        file_with_path <span class="op">=</span> os.path.join(repo_dir_absolute_path, ppFile)</span>
<span id="cb3-54"><a href="#cb3-54"></a>        mapped_tuple <span class="op">=</span> (file_with_path, each_commit)</span>
<span id="cb3-55"><a href="#cb3-55"></a>        mappedPuppetList.append(mapped_tuple)</span>
<span id="cb3-56"><a href="#cb3-56"></a></span>
<span id="cb3-57"><a href="#cb3-57"></a>  <span class="cf">return</span> mappedPuppetList</span>
<span id="cb3-58"><a href="#cb3-58"></a></span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="kw">def</span> IacRelatedCommits(repo_dir_absolute_path, iac_list_repo, branchName<span class="op">=</span>constants.MASTER_BRANCH):</span>
<span id="cb3-60"><a href="#cb3-60"></a>  mapped_iac_list <span class="op">=</span> []</span>
<span id="cb3-61"><a href="#cb3-61"></a>  track_exec_cnt  <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-62"><a href="#cb3-62"></a>  repo_  <span class="op">=</span> Repo(repo_dir_absolute_path)</span>
<span id="cb3-63"><a href="#cb3-63"></a>  all_commits <span class="op">=</span> <span class="bu">list</span>(repo_.iter_commits(branchName))</span>
<span id="cb3-64"><a href="#cb3-64"></a>  <span class="cf">for</span> each_commit <span class="kw">in</span> all_commits:</span>
<span id="cb3-65"><a href="#cb3-65"></a>    track_exec_cnt <span class="op">=</span> track_exec_cnt <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-66"><a href="#cb3-66"></a></span>
<span id="cb3-67"><a href="#cb3-67"></a>    cmd_of_interrest1 <span class="op">=</span> constants.CHANGE_DIR_CMD <span class="op">+</span> repo_dir_absolute_path <span class="op">+</span> <span class="st">&quot; ; &quot;</span></span>
<span id="cb3-68"><a href="#cb3-68"></a>    cmd_of_interrest2 <span class="op">=</span> constants.GIT_COMM_CMD_1 <span class="op">+</span> <span class="bu">str</span>(each_commit)  <span class="op">+</span>  constants.GIT_COMM_CMD_2</span>
<span id="cb3-69"><a href="#cb3-69"></a>    cmd_of_interrest <span class="op">=</span> cmd_of_interrest1 <span class="op">+</span> cmd_of_interrest2</span>
<span id="cb3-70"><a href="#cb3-70"></a>    commit_of_interest  <span class="op">=</span> <span class="bu">str</span>(subprocess.check_output([constants.BASH_CMD, constants.BASH_FLAG, cmd_of_interrest])) <span class="co">#in Python 3 subprocess.check_output returns byte</span></span>
<span id="cb3-71"><a href="#cb3-71"></a></span>
<span id="cb3-72"><a href="#cb3-72"></a>    <span class="cf">for</span> iac_file <span class="kw">in</span> iac_list_repo:</span>
<span id="cb3-73"><a href="#cb3-73"></a>      <span class="cf">if</span> iac_file <span class="kw">in</span> commit_of_interest:</span>
<span id="cb3-74"><a href="#cb3-74"></a>        file_with_path <span class="op">=</span> os.path.join(repo_dir_absolute_path, iac_file)</span>
<span id="cb3-75"><a href="#cb3-75"></a>        mapped_tuple <span class="op">=</span> (file_with_path, each_commit)</span>
<span id="cb3-76"><a href="#cb3-76"></a>        mapped_iac_list.append(mapped_tuple)</span>
<span id="cb3-77"><a href="#cb3-77"></a></span>
<span id="cb3-78"><a href="#cb3-78"></a>  <span class="cf">return</span> mapped_iac_list</span>
<span id="cb3-79"><a href="#cb3-79"></a></span>
<span id="cb3-80"><a href="#cb3-80"></a><span class="kw">def</span> getDiffStr(repo_path_p, commit_hash_p, file_p):</span>
<span id="cb3-81"><a href="#cb3-81"></a>    cdCommand <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>constants<span class="sc">.</span>CHANGE_DIR_CMD<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>repo_path_p<span class="sc">}</span><span class="ss"> ; &quot;</span></span>
<span id="cb3-82"><a href="#cb3-82"></a>    theFile <span class="op">=</span> os.path.relpath(file_p, repo_path_p)</span>
<span id="cb3-83"><a href="#cb3-83"></a>    </span>
<span id="cb3-84"><a href="#cb3-84"></a>    diffCommand <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>constants<span class="sc">.</span>GIT_SHOW_CMD<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>commit_hash_p<span class="sc">}</span><span class="ss"> -- </span><span class="sc">{</span>theFile<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb3-85"><a href="#cb3-85"></a>    command2Run <span class="op">=</span> cdCommand <span class="op">+</span> diffCommand</span>
<span id="cb3-86"><a href="#cb3-86"></a></span>
<span id="cb3-87"><a href="#cb3-87"></a>    diff_output <span class="op">=</span> subprocess.check_output(</span>
<span id="cb3-88"><a href="#cb3-88"></a>        [constants.BASH_CMD, constants.BASH_FLAG, command2Run]</span>
<span id="cb3-89"><a href="#cb3-89"></a>    ).decode(<span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb3-90"><a href="#cb3-90"></a>    <span class="cf">return</span> diff_output</span>
<span id="cb3-91"><a href="#cb3-91"></a></span>
<span id="cb3-92"><a href="#cb3-92"></a><span class="kw">def</span> makeDepParsingMessage(m_, i_): </span>
<span id="cb3-93"><a href="#cb3-93"></a>    upper, lower  <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb3-94"><a href="#cb3-94"></a>    lower <span class="op">=</span> i_ <span class="op">-</span> constants.STR_LIST_BOUNDS</span>
<span id="cb3-95"><a href="#cb3-95"></a>    upper <span class="op">=</span> i_ <span class="op">+</span> constants.STR_LIST_BOUNDS </span>
<span id="cb3-96"><a href="#cb3-96"></a>    <span class="cf">if</span> upper <span class="op">&gt;</span> <span class="bu">len</span>(m_):</span>
<span id="cb3-97"><a href="#cb3-97"></a>      upper <span class="op">=</span> <span class="op">-</span> <span class="dv">1</span> </span>
<span id="cb3-98"><a href="#cb3-98"></a>    <span class="cf">if</span> lower <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb3-99"><a href="#cb3-99"></a>      lower <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-100"><a href="#cb3-100"></a>    <span class="cf">return</span> constants.WHITE_SPACE.join(m_[i_ <span class="op">-</span> constants.STR_LIST_BOUNDS : i_ <span class="op">+</span> constants.STR_LIST_BOUNDS])</span>
<span id="cb3-101"><a href="#cb3-101"></a></span>
<span id="cb3-102"><a href="#cb3-102"></a><span class="kw">def</span> processMessage(indi_comm_mess):</span>
<span id="cb3-103"><a href="#cb3-103"></a>    splitted_messages <span class="op">=</span> []</span>
<span id="cb3-104"><a href="#cb3-104"></a><span class="co">#   original</span></span>
<span id="cb3-105"><a href="#cb3-105"></a><span class="co">#    if (&#39;*&#39; in indi_comm_mess):</span></span>
<span id="cb3-106"><a href="#cb3-106"></a>    <span class="cf">if</span> (<span class="st">&#39;*&#39;</span> <span class="kw">in</span> indi_comm_mess) <span class="kw">or</span> (<span class="st">&#39;;&#39;</span> <span class="kw">in</span> indi_comm_mess):</span>
<span id="cb3-107"><a href="#cb3-107"></a>      splitted_messages <span class="op">=</span> indi_comm_mess.split(<span class="st">&#39;*&#39;</span>)</span>
<span id="cb3-108"><a href="#cb3-108"></a>      splitted_messages <span class="op">=</span> indi_comm_mess.split(<span class="st">&#39;;&#39;</span>)</span>
<span id="cb3-109"><a href="#cb3-109"></a>    <span class="cf">else</span>:</span>
<span id="cb3-110"><a href="#cb3-110"></a>      splitted_messages <span class="op">=</span> sent_tokenize(indi_comm_mess)</span>
<span id="cb3-111"><a href="#cb3-111"></a>    <span class="cf">return</span> splitted_messages </span>
<span id="cb3-112"><a href="#cb3-112"></a></span>
<span id="cb3-113"><a href="#cb3-113"></a><span class="kw">def</span> analyzeCommit(repo_path_param, iac_commits_mapping):</span>
<span id="cb3-114"><a href="#cb3-114"></a>  verbose <span class="op">=</span> <span class="va">False</span>   <span class="co"># For oracle dataset it is True (later), otherwise it is False </span></span>
<span id="cb3-115"><a href="#cb3-115"></a>  pupp_bug_list <span class="op">=</span> []</span>
<span id="cb3-116"><a href="#cb3-116"></a>  all_commit_file_dict  <span class="op">=</span> {}</span>
<span id="cb3-117"><a href="#cb3-117"></a>  all_defect_categ_list <span class="op">=</span> []</span>
<span id="cb3-118"><a href="#cb3-118"></a>  hash_tracker <span class="op">=</span> []</span>
<span id="cb3-119"><a href="#cb3-119"></a>  <span class="cf">for</span> tuple_ <span class="kw">in</span> iac_commits_mapping:</span>
<span id="cb3-120"><a href="#cb3-120"></a></span>
<span id="cb3-121"><a href="#cb3-121"></a>    file_ <span class="op">=</span> tuple_[<span class="dv">0</span>]</span>
<span id="cb3-122"><a href="#cb3-122"></a>    commit_ <span class="op">=</span> tuple_[<span class="dv">1</span>]</span>
<span id="cb3-123"><a href="#cb3-123"></a>    msg_commit <span class="op">=</span>  commit_.message </span>
<span id="cb3-124"><a href="#cb3-124"></a></span>
<span id="cb3-125"><a href="#cb3-125"></a>    msg_commit <span class="op">=</span> msg_commit.replace(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, constants.WHITE_SPACE)</span>
<span id="cb3-126"><a href="#cb3-126"></a>    msg_commit <span class="op">=</span> msg_commit.replace(<span class="st">&#39;,&#39;</span>,  <span class="st">&#39;;&#39;</span>)    </span>
<span id="cb3-127"><a href="#cb3-127"></a>    msg_commit <span class="op">=</span> msg_commit.replace(<span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>, constants.WHITE_SPACE)</span>
<span id="cb3-128"><a href="#cb3-128"></a>    msg_commit <span class="op">=</span> msg_commit.replace(<span class="st">&#39;&amp;&#39;</span>,  <span class="st">&#39;;&#39;</span>)  </span>
<span id="cb3-129"><a href="#cb3-129"></a>    msg_commit <span class="op">=</span> msg_commit.replace(<span class="st">&#39;#&#39;</span>,  constants.WHITE_SPACE)</span>
<span id="cb3-130"><a href="#cb3-130"></a>    msg_commit <span class="op">=</span> msg_commit.replace(<span class="st">&#39;=&#39;</span>,  constants.WHITE_SPACE)</span>
<span id="cb3-131"><a href="#cb3-131"></a>    </span>
<span id="cb3-132"><a href="#cb3-132"></a>    commit_hash <span class="op">=</span> commit_.hexsha</span>
<span id="cb3-133"><a href="#cb3-133"></a></span>
<span id="cb3-134"><a href="#cb3-134"></a>    <span class="co"># &#39;&#39;&#39;</span></span>
<span id="cb3-135"><a href="#cb3-135"></a>    <span class="co"># for testing purpose , uncomment only for tool accuracy purpose </span></span>
<span id="cb3-136"><a href="#cb3-136"></a>    <span class="co"># &#39;&#39;&#39;</span></span>
<span id="cb3-137"><a href="#cb3-137"></a>    <span class="co"># if commit_hash in constants.ORACLE_HASH_CHECKLIST:</span></span>
<span id="cb3-138"><a href="#cb3-138"></a>    <span class="co">#   verbose = True </span></span>
<span id="cb3-139"><a href="#cb3-139"></a>    <span class="co"># else:</span></span>
<span id="cb3-140"><a href="#cb3-140"></a>    <span class="co">#   verbose = False </span></span>
<span id="cb3-141"><a href="#cb3-141"></a>    <span class="co"># &#39;&#39;&#39;</span></span>
<span id="cb3-142"><a href="#cb3-142"></a>    <span class="co"># &#39;&#39;&#39; </span></span>
<span id="cb3-143"><a href="#cb3-143"></a></span>
<span id="cb3-144"><a href="#cb3-144"></a>    timestamp_commit <span class="op">=</span> commit_.committed_datetime</span>
<span id="cb3-145"><a href="#cb3-145"></a>    str_time_commit  <span class="op">=</span> timestamp_commit.strftime(constants.DATE_TIME_FORMAT) <span class="co">## date with time </span></span>
<span id="cb3-146"><a href="#cb3-146"></a></span>
<span id="cb3-147"><a href="#cb3-147"></a>    <span class="co">#### categorization zone </span></span>
<span id="cb3-148"><a href="#cb3-148"></a>    per_commit_defect_categ_list <span class="op">=</span> []</span>
<span id="cb3-149"><a href="#cb3-149"></a>    <span class="cf">if</span> (commit_hash <span class="kw">not</span> <span class="kw">in</span> hash_tracker):</span>
<span id="cb3-150"><a href="#cb3-150"></a>      bug_status, index_status <span class="op">=</span> classifier.detectBuggyCommit(msg_commit, verbose) </span>
<span id="cb3-151"><a href="#cb3-151"></a>      <span class="co"># print bug_status </span></span>
<span id="cb3-152"><a href="#cb3-152"></a>      <span class="co">#if commit_hash == &quot;1f03639bcddb66031b16ed6cfdf91f2bbdeca6c8&quot;:</span></span>
<span id="cb3-153"><a href="#cb3-153"></a>        <span class="co">#bug_status = True</span></span>
<span id="cb3-154"><a href="#cb3-154"></a>      <span class="cf">if</span> (bug_status) <span class="kw">or</span> (classifier.detectRevertedCommit(msg_commit) ):</span>
<span id="cb3-155"><a href="#cb3-155"></a>        processed_message <span class="op">=</span> processMessage(msg_commit)</span>
<span id="cb3-156"><a href="#cb3-156"></a>        <span class="co"># each commit has multiple messages, need to merge them together in one list here, not in classifier </span></span>
<span id="cb3-157"><a href="#cb3-157"></a>        <span class="cf">for</span> tokenized_msg <span class="kw">in</span> processed_message:</span>
<span id="cb3-158"><a href="#cb3-158"></a>            diff_content_str <span class="op">=</span> getDiffStr(repo_path_param, commit_hash, file_)</span>
<span id="cb3-159"><a href="#cb3-159"></a>            bug_categ <span class="op">=</span> classifier.detectCateg(tokenized_msg, diff_content_str, verbose)</span>
<span id="cb3-160"><a href="#cb3-160"></a>            <span class="co"># bug_categ = classifier.detectCategHashFounder(tokenized_msg, diff_content_str, verbose, hash=commit_hash)</span></span>
<span id="cb3-161"><a href="#cb3-161"></a>            <span class="cf">if</span> <span class="bu">len</span>(bug_categ) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-162"><a href="#cb3-162"></a>              per_commit_defect_categ_list.append(constants.BUGGY_COMMIT)</span>
<span id="cb3-163"><a href="#cb3-163"></a>            <span class="cf">else</span>:</span>
<span id="cb3-164"><a href="#cb3-164"></a>              per_commit_defect_categ_list <span class="op">+=</span> bug_categ</span>
<span id="cb3-165"><a href="#cb3-165"></a>      <span class="cf">else</span>:</span>
<span id="cb3-166"><a href="#cb3-166"></a>        per_commit_defect_categ_list  <span class="op">=</span> [constants.NO_DEFECT_CATEG]</span>
<span id="cb3-167"><a href="#cb3-167"></a></span>
<span id="cb3-168"><a href="#cb3-168"></a>      bug_categ_list <span class="op">=</span> np.unique(per_commit_defect_categ_list)</span>
<span id="cb3-169"><a href="#cb3-169"></a>      <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb3-170"><a href="#cb3-170"></a><span class="co">      for testing purpose , uncomment only for tool accuracy purpose </span></span>
<span id="cb3-171"><a href="#cb3-171"></a><span class="co">      &#39;&#39;&#39;</span></span>
<span id="cb3-172"><a href="#cb3-172"></a>      <span class="co"># if verbose:</span></span>
<span id="cb3-173"><a href="#cb3-173"></a>      <span class="co">#   print bug_categ_list</span></span>
<span id="cb3-174"><a href="#cb3-174"></a>      <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb3-175"><a href="#cb3-175"></a><span class="co">      &#39;&#39;&#39;</span></span>
<span id="cb3-176"><a href="#cb3-176"></a>      <span class="cf">if</span> (<span class="bu">len</span>(bug_categ_list) <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb3-177"><a href="#cb3-177"></a>        <span class="cf">for</span> bug_categ_ <span class="kw">in</span> bug_categ_list:      </span>
<span id="cb3-178"><a href="#cb3-178"></a>            tup_ <span class="op">=</span> (commit_hash, bug_categ_, file_, str_time_commit) </span>
<span id="cb3-179"><a href="#cb3-179"></a>            all_defect_categ_list.append(tup_)</span>
<span id="cb3-180"><a href="#cb3-180"></a>            <span class="co"># -- my debug</span></span>
<span id="cb3-181"><a href="#cb3-181"></a>            <span class="co">#if (tup_[1] != constants.NO_DEFECT_CATEG):</span></span>
<span id="cb3-182"><a href="#cb3-182"></a>            <span class="co">#  print(tup_[1])</span></span>
<span id="cb3-183"><a href="#cb3-183"></a>            <span class="co"># ---</span></span>
<span id="cb3-184"><a href="#cb3-184"></a>            <span class="co"># print tup_[0], tup_[1], tup_[2], tup_[3]</span></span>
<span id="cb3-185"><a href="#cb3-185"></a>            <span class="co"># print &#39;-&#39;*25</span></span>
<span id="cb3-186"><a href="#cb3-186"></a>      <span class="cf">else</span>:    </span>
<span id="cb3-187"><a href="#cb3-187"></a>        tup_ <span class="op">=</span> (commit_hash, constants.NO_DEFECT_CATEG, file_, str_time_commit) </span>
<span id="cb3-188"><a href="#cb3-188"></a>        all_defect_categ_list.append(tup_)  </span>
<span id="cb3-189"><a href="#cb3-189"></a>        </span>
<span id="cb3-190"><a href="#cb3-190"></a>      hash_tracker.append(commit_hash) </span>
<span id="cb3-191"><a href="#cb3-191"></a>    <span class="co">#### file to hash mapping zone </span></span>
<span id="cb3-192"><a href="#cb3-192"></a>    <span class="cf">if</span> commit_hash <span class="kw">not</span> <span class="kw">in</span> all_commit_file_dict:</span>
<span id="cb3-193"><a href="#cb3-193"></a>      all_commit_file_dict[commit_hash] <span class="op">=</span> [file_]</span>
<span id="cb3-194"><a href="#cb3-194"></a>    <span class="cf">else</span>:</span>
<span id="cb3-195"><a href="#cb3-195"></a>      all_commit_file_dict[commit_hash]  <span class="op">=</span> all_commit_file_dict[commit_hash] <span class="op">+</span> [file_]    </span>
<span id="cb3-196"><a href="#cb3-196"></a></span>
<span id="cb3-197"><a href="#cb3-197"></a>  <span class="cf">return</span> all_commit_file_dict, all_defect_categ_list </span>
<span id="cb3-198"><a href="#cb3-198"></a></span>
<span id="cb3-199"><a href="#cb3-199"></a><span class="kw">def</span> getIacFilesOfRepo(repo_id, csv_file_path <span class="op">=</span> constants.CSV_REPLICATION, csv_default <span class="op">=</span> constants.CSV_DEFAULT_PATH):</span>
<span id="cb3-200"><a href="#cb3-200"></a>    <span class="cf">with</span> <span class="bu">open</span>(csv_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> csv_file:</span>
<span id="cb3-201"><a href="#cb3-201"></a>        reader <span class="op">=</span> csv.DictReader(csv_file)</span>
<span id="cb3-202"><a href="#cb3-202"></a>        <span class="cf">for</span> row <span class="kw">in</span> reader:</span>
<span id="cb3-203"><a href="#cb3-203"></a>            <span class="cf">if</span> row[<span class="st">&#39;id&#39;</span>] <span class="op">==</span> <span class="bu">str</span>(repo_id):</span>
<span id="cb3-204"><a href="#cb3-204"></a>                <span class="co"># Converter strings de listas para listas reais</span></span>
<span id="cb3-205"><a href="#cb3-205"></a>                iac_paths <span class="op">=</span> ast.literal_eval(row[<span class="st">&#39;iac_paths&#39;</span>])</span>
<span id="cb3-206"><a href="#cb3-206"></a>                related_files <span class="op">=</span> ast.literal_eval(row[<span class="st">&#39;related_files&#39;</span>])</span>
<span id="cb3-207"><a href="#cb3-207"></a>                result <span class="op">=</span> iac_paths <span class="op">+</span> related_files</span>
<span id="cb3-208"><a href="#cb3-208"></a>                result <span class="op">=</span> [item.replace(csv_default <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> repo_id <span class="op">+</span> <span class="st">&#39;/&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> item <span class="kw">in</span> result]</span>
<span id="cb3-209"><a href="#cb3-209"></a>                <span class="cf">return</span> result</span>
<span id="cb3-210"><a href="#cb3-210"></a>    <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb3-211"><a href="#cb3-211"></a></span>
<span id="cb3-212"><a href="#cb3-212"></a><span class="kw">def</span> getId(path):</span>
<span id="cb3-213"><a href="#cb3-213"></a>  <span class="cf">return</span> path.split(<span class="st">&#39;/&#39;</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-214"><a href="#cb3-214"></a></span>
<span id="cb3-215"><a href="#cb3-215"></a><span class="kw">def</span> runMiner(orgParamName, repo_name_param, branchParam, csv_file_path <span class="op">=</span> <span class="va">None</span>, csv_default <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb3-216"><a href="#cb3-216"></a>  script_dir <span class="op">=</span> os.path.dirname(os.path.abspath(<span class="va">__file__</span>))</span>
<span id="cb3-217"><a href="#cb3-217"></a>  repo_path   <span class="op">=</span> script_dir <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> constants.DATASET_DIR <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> orgParamName <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> repo_name_param</span>
<span id="cb3-218"><a href="#cb3-218"></a>  repo_branch <span class="op">=</span> branchParam</span>
<span id="cb3-219"><a href="#cb3-219"></a></span>
<span id="cb3-220"><a href="#cb3-220"></a>  repo_id <span class="op">=</span> getId(repo_path)</span>
<span id="cb3-221"><a href="#cb3-221"></a>  all_iac_files_in_repo <span class="op">=</span> getIacFilesOfRepo(repo_id, csv_file_path, csv_default)</span>
<span id="cb3-222"><a href="#cb3-222"></a>  iac_commits_in_repo <span class="op">=</span> IacRelatedCommits(repo_path, all_iac_files_in_repo, repo_branch)</span>
<span id="cb3-223"><a href="#cb3-223"></a>  commit_file_dict, categ_defect_list <span class="op">=</span> analyzeCommit(repo_path, iac_commits_in_repo)</span>
<span id="cb3-224"><a href="#cb3-224"></a></span>
<span id="cb3-225"><a href="#cb3-225"></a>  <span class="cf">return</span> commit_file_dict, categ_defect_list</span>
<span id="cb3-226"><a href="#cb3-226"></a></span>
<span id="cb3-227"><a href="#cb3-227"></a>  </span>
<span id="cb3-228"><a href="#cb3-228"></a></span>
<span id="cb3-229"><a href="#cb3-229"></a><span class="kw">def</span> dumpContentIntoFile(strP, fileP):</span>
<span id="cb3-230"><a href="#cb3-230"></a>  fileToWrite <span class="op">=</span> <span class="bu">open</span>( fileP, constants.FILE_WRITE_MODE)</span>
<span id="cb3-231"><a href="#cb3-231"></a>  fileToWrite.write(strP )</span>
<span id="cb3-232"><a href="#cb3-232"></a>  fileToWrite.close()</span>
<span id="cb3-233"><a href="#cb3-233"></a>  <span class="cf">return</span> <span class="bu">str</span>(os.stat(fileP).st_size)</span>
<span id="cb3-234"><a href="#cb3-234"></a></span></code></pre></div>
<h3 id="difference-parser-code">Difference Parser Code</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#reff: https://github.com/cscorley/whatthepatch</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="im">import</span> whatthepatch</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="im">import</span> constants</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="im">from</span> fuzzywuzzy <span class="im">import</span> fuzz</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="im">import</span> re</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># [(1, None, &#39;# == Class cdh4::pig&#39;), (None, 1, &#39;# == Class cdh::pig&#39;), (2, 2, &#39;#&#39;), (3, None, &#39;# Installs and configures Apache Pig.&#39;), (None, 3, &#39;# Installs and configures Apache Pig and Pig DataFu.&#39;), (4, 4, &#39;#&#39;), (5, None, &#39;class cdh4::pig {&#39;), (6, None, &quot;  package { &#39;pig&#39;:&quot;), (7, None, &quot;    ensure =&gt; &#39;installed&#39;,&quot;), (8, None, &#39;  }&#39;), (None, 5, &#39;class cdh::pig(&#39;), (None, 6, &quot;    $pig_properties_template = &#39;cdh/pig/pig.properties.erb&#39;,&quot;), (None, 7, &quot;    $log4j_template          = &#39;cdh/pig/log4j.properties.erb&#39;,&quot;), (None, 8, &#39;)&#39;), (None, 9, &#39;{&#39;), (None, 10, &#39;    # cdh::pig requires hadoop client and configs are installed.&#39;), (None, 11, &quot;    Class[&#39;cdh::hadoop&#39;] -&gt; Class[&#39;cdh::pig&#39;]&quot;), (9, 12, &#39;&#39;), (10, None, &quot;  file { &#39;/etc/pig/conf/pig.properties&#39;:&quot;), (11, None, &quot;    content =&gt; template(&#39;cdh4/pig/pig.properties.erb&#39;),&quot;), (12, None, &quot;    require =&gt; Package[&#39;pig&#39;],&quot;), (13, None, &#39;  }&#39;), (None, 13, &quot;    package { &#39;pig&#39;:&quot;), (None, 14, &quot;        ensure =&gt; &#39;installed&#39;,&quot;), (None, 15, &#39;    }&#39;), (None, 16, &quot;    package { &#39;pig-udf-datafu&#39;:&quot;), (None, 17, &quot;        ensure =&gt; &#39;installed&#39;,&quot;), (None, 18, &#39;    }&#39;), (None, 19, &#39;&#39;), (None, 20, &#39;    $config_directory = &quot;/etc/pig/conf.${cdh::hadoop::cluster_name}&quot;&#39;), (None, 21, &#39;    # Create the $cluster_name based $config_directory.&#39;), (None, 22, &#39;    file { $config_directory:&#39;), (None, 23, &quot;        ensure  =&gt; &#39;directory&#39;,&quot;), (None, 24, &quot;        require =&gt; Package[&#39;pig&#39;],&quot;), (None, 25, &#39;    }&#39;), (None, 26, &quot;    cdh::alternative { &#39;pig-conf&#39;:&quot;), (None, 27, &quot;        link    =&gt; &#39;/etc/pig/conf&#39;,&quot;), (None, 28, &#39;        path    =&gt; $config_directory,&#39;), (None, 29, &#39;    }&#39;), (None, 30, &#39;&#39;), (None, 31, &#39;    file { &quot;${config_directory}/pig.properties&quot;:&#39;), (None, 32, &#39;        content =&gt; template($pig_properties_template),&#39;), (None, 33, &quot;        require =&gt; Package[&#39;pig&#39;],&quot;), (None, 34, &#39;    }&#39;), (None, 35, &#39;    file { &quot;${config_directory}/log4j.properties&quot;:&#39;), (None, 36, &#39;        content =&gt; template($log4j_template),&#39;), (None, 37, &quot;        require =&gt; Package[&#39;pig&#39;],&quot;), (None, 38, &#39;    }&#39;), (14, 39, &#39;}&#39;)]</span></span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="kw">def</span> parseTheDiff(diff_text):</span>
<span id="cb4-13"><a href="#cb4-13"></a>    parse_out_dict <span class="op">=</span> {}</span>
<span id="cb4-14"><a href="#cb4-14"></a>    diff_mess_str <span class="op">=</span> <span class="bu">str</span>(diff_text) <span class="co">## changes for Python 3 migration </span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="cf">for</span> diff_ <span class="kw">in</span> whatthepatch.parse_patch(diff_mess_str):</span>
<span id="cb4-16"><a href="#cb4-16"></a>        all_changes_line_by_line <span class="op">=</span> diff_[<span class="dv">1</span>] <span class="co">## diff_ is a tuple, changes is idnetified by the second index </span></span>
<span id="cb4-17"><a href="#cb4-17"></a>        line_numbers_added, line_numbers_deleted <span class="op">=</span> [], [] </span>
<span id="cb4-18"><a href="#cb4-18"></a>        add_dic, del_dic <span class="op">=</span> {}, {}</span>
<span id="cb4-19"><a href="#cb4-19"></a>        parse_out_dict   <span class="op">=</span> {}</span>
<span id="cb4-20"><a href="#cb4-20"></a>        <span class="cf">for</span> change_tuple <span class="kw">in</span> all_changes_line_by_line:</span>
<span id="cb4-21"><a href="#cb4-21"></a>            <span class="cf">if</span> (change_tuple[<span class="dv">0</span>] <span class="op">!=</span> <span class="va">None</span> ):</span>
<span id="cb4-22"><a href="#cb4-22"></a>                line_numbers_added.append(change_tuple[<span class="dv">0</span>])</span>
<span id="cb4-23"><a href="#cb4-23"></a>                add_dic[change_tuple[<span class="dv">0</span>]] <span class="op">=</span> change_tuple[<span class="dv">2</span>]</span>
<span id="cb4-24"><a href="#cb4-24"></a>            <span class="cf">if</span> (change_tuple[<span class="dv">1</span>] <span class="op">!=</span> <span class="va">None</span> ):</span>
<span id="cb4-25"><a href="#cb4-25"></a>                line_numbers_deleted.append(change_tuple[<span class="dv">1</span>])                </span>
<span id="cb4-26"><a href="#cb4-26"></a>                del_dic[change_tuple[<span class="dv">1</span>]] <span class="op">=</span> change_tuple[<span class="dv">2</span>]</span>
<span id="cb4-27"><a href="#cb4-27"></a>        lines_changed <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(line_numbers_added).intersection(line_numbers_deleted)) </span>
<span id="cb4-28"><a href="#cb4-28"></a>        <span class="cf">for</span> line_number <span class="kw">in</span> lines_changed:</span>
<span id="cb4-29"><a href="#cb4-29"></a>            <span class="cf">if</span> ((line_number <span class="kw">in</span> add_dic) <span class="kw">and</span> (line_number <span class="kw">in</span> del_dic)):</span>
<span id="cb4-30"><a href="#cb4-30"></a>                parse_out_dict[line_number] <span class="op">=</span> [ del_dic[line_number], add_dic[line_number]] <span class="co">## &lt;removed content, added cotnent&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31"></a>        <span class="co">#print parse_out_dict</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>    <span class="cf">return</span> parse_out_dict</span>
<span id="cb4-33"><a href="#cb4-33"></a></span>
<span id="cb4-34"><a href="#cb4-34"></a><span class="kw">def</span> filterTextList(txt_lis):</span>
<span id="cb4-35"><a href="#cb4-35"></a>    return_list <span class="op">=</span> []</span>
<span id="cb4-36"><a href="#cb4-36"></a>    return_list <span class="op">=</span> [x_.lower() <span class="cf">for</span> x_ <span class="kw">in</span> txt_lis <span class="cf">if</span>  constants.HASH_SYMBOL <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-37"><a href="#cb4-37"></a>    return_list <span class="op">=</span> [x_.replace(constants.TAB, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> return_list ]    </span>
<span id="cb4-38"><a href="#cb4-38"></a>    return_list <span class="op">=</span> [x_.replace(constants.NEWLINE, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> return_list ] </span>
<span id="cb4-39"><a href="#cb4-39"></a>    return_list <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> return_list <span class="cf">if</span> <span class="bu">len</span>(x_) <span class="op">&gt;</span> <span class="dv">1</span> ]        </span>
<span id="cb4-40"><a href="#cb4-40"></a>    <span class="cf">return</span> return_list</span>
<span id="cb4-41"><a href="#cb4-41"></a></span>
<span id="cb4-42"><a href="#cb4-42"></a><span class="kw">def</span> getAddDelLines(diff_mess):</span>
<span id="cb4-43"><a href="#cb4-43"></a>    added_text, deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-44"><a href="#cb4-44"></a>    diff_mess_str <span class="op">=</span> <span class="bu">str</span>(diff_mess)</span>
<span id="cb4-45"><a href="#cb4-45"></a>    <span class="cf">try</span>:</span>
<span id="cb4-46"><a href="#cb4-46"></a>        <span class="cf">for</span> diff_ <span class="kw">in</span> whatthepatch.parse_patch(diff_mess_str):</span>
<span id="cb4-47"><a href="#cb4-47"></a>            all_changes_line_by_line <span class="op">=</span> <span class="bu">getattr</span>(diff_, <span class="st">&quot;changes&quot;</span>, <span class="va">None</span>)</span>
<span id="cb4-48"><a href="#cb4-48"></a></span>
<span id="cb4-49"><a href="#cb4-49"></a>            <span class="cf">if</span> all_changes_line_by_line:</span>
<span id="cb4-50"><a href="#cb4-50"></a>                <span class="cf">for</span> change <span class="kw">in</span> all_changes_line_by_line:</span>
<span id="cb4-51"><a href="#cb4-51"></a>                    <span class="cf">if</span> change.new <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-52"><a href="#cb4-52"></a>                        added_text.append(change.line)</span>
<span id="cb4-53"><a href="#cb4-53"></a></span>
<span id="cb4-54"><a href="#cb4-54"></a>                    <span class="cf">if</span> change.old <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-55"><a href="#cb4-55"></a>                        deleted_text.append(change.line) </span>
<span id="cb4-56"><a href="#cb4-56"></a></span>
<span id="cb4-57"><a href="#cb4-57"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-58"><a href="#cb4-58"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] Error when processing diff: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-59"><a href="#cb4-59"></a></span>
<span id="cb4-60"><a href="#cb4-60"></a>    <span class="cf">return</span> added_text, deleted_text</span>
<span id="cb4-61"><a href="#cb4-61"></a></span>
<span id="cb4-62"><a href="#cb4-62"></a><span class="kw">def</span> getSpecialConfigDict(text_str_list, splitter):</span>
<span id="cb4-63"><a href="#cb4-63"></a>    dic2ret <span class="op">=</span> {}</span>
<span id="cb4-64"><a href="#cb4-64"></a>    <span class="cf">for</span> x_ <span class="kw">in</span> text_str_list:</span>
<span id="cb4-65"><a href="#cb4-65"></a>        <span class="cf">if</span> (splitter <span class="kw">in</span> x_):</span>
<span id="cb4-66"><a href="#cb4-66"></a>            _key_ <span class="op">=</span> x_.replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>).split(splitter)[<span class="dv">0</span>] </span>
<span id="cb4-67"><a href="#cb4-67"></a>            _val_ <span class="op">=</span> x_.replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>).split(splitter)[<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb4-68"><a href="#cb4-68"></a>            <span class="cf">if</span> _key_ <span class="kw">not</span> <span class="kw">in</span> dic2ret:</span>
<span id="cb4-69"><a href="#cb4-69"></a>                dic2ret[_key_] <span class="op">=</span> _val_</span>
<span id="cb4-70"><a href="#cb4-70"></a>    <span class="co"># print text_str_list</span></span>
<span id="cb4-71"><a href="#cb4-71"></a>    <span class="co"># print dic2ret</span></span>
<span id="cb4-72"><a href="#cb4-72"></a>    <span class="cf">return</span> dic2ret</span>
<span id="cb4-73"><a href="#cb4-73"></a></span>
<span id="cb4-74"><a href="#cb4-74"></a><span class="kw">def</span> filterConfig(oldValue):</span>
<span id="cb4-75"><a href="#cb4-75"></a>    oldValue <span class="op">=</span> oldValue.replace(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;&quot;</span>)</span>
<span id="cb4-76"><a href="#cb4-76"></a>    oldValue <span class="op">=</span> oldValue.replace(<span class="st">&quot;&#39;&quot;</span>,<span class="st">&quot;&quot;</span>)</span>
<span id="cb4-77"><a href="#cb4-77"></a>    oldValue <span class="op">=</span> oldValue.replace(<span class="st">&quot;;&quot;</span>,<span class="st">&quot;&quot;</span>)</span>
<span id="cb4-78"><a href="#cb4-78"></a>    val_     <span class="op">=</span> oldValue.replace(<span class="st">&quot;&gt;&quot;</span>,<span class="st">&quot;&quot;</span>)</span>
<span id="cb4-79"><a href="#cb4-79"></a></span>
<span id="cb4-80"><a href="#cb4-80"></a>    <span class="cf">return</span> val_ </span>
<span id="cb4-81"><a href="#cb4-81"></a></span>
<span id="cb4-82"><a href="#cb4-82"></a><span class="kw">def</span> getConfigChangeCnt(start_dict, end_dict):</span>
<span id="cb4-83"><a href="#cb4-83"></a>    tracker <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb4-84"><a href="#cb4-84"></a>    track_list <span class="op">=</span> []</span>
<span id="cb4-85"><a href="#cb4-85"></a>    val_track_list <span class="op">=</span> []</span>
<span id="cb4-86"><a href="#cb4-86"></a>    <span class="cf">for</span> k_, v_ <span class="kw">in</span> start_dict.items():</span>
<span id="cb4-87"><a href="#cb4-87"></a>        <span class="cf">if</span> (k_ <span class="kw">in</span> end_dict ) <span class="kw">and</span> (k_ <span class="kw">not</span> <span class="kw">in</span> track_list) <span class="kw">and</span> (v_ <span class="kw">not</span> <span class="kw">in</span> val_track_list) <span class="kw">and</span> (<span class="bu">len</span>(v_) <span class="op">&gt;</span> <span class="dv">1</span>): </span>
<span id="cb4-88"><a href="#cb4-88"></a>            oldValue     <span class="op">=</span> end_dict[k_] </span>
<span id="cb4-89"><a href="#cb4-89"></a>            newValue     <span class="op">=</span> v_ </span>
<span id="cb4-90"><a href="#cb4-90"></a>            <span class="co"># need more pre processign ugh </span></span>
<span id="cb4-91"><a href="#cb4-91"></a>            oldValue <span class="op">=</span> filterConfig(oldValue) </span>
<span id="cb4-92"><a href="#cb4-92"></a>            newValue <span class="op">=</span> filterConfig(newValue)</span>
<span id="cb4-93"><a href="#cb4-93"></a>            <span class="cf">if</span> newValue <span class="op">!=</span> oldValue:</span>
<span id="cb4-94"><a href="#cb4-94"></a>                <span class="co"># print k_</span></span>
<span id="cb4-95"><a href="#cb4-95"></a>                <span class="co"># print oldValue, newValue</span></span>
<span id="cb4-96"><a href="#cb4-96"></a>                tracker <span class="op">=</span> tracker <span class="op">+</span> <span class="dv">1</span> </span>
<span id="cb4-97"><a href="#cb4-97"></a>        track_list.append(k_)</span>
<span id="cb4-98"><a href="#cb4-98"></a>        val_track_list.append(v_) </span>
<span id="cb4-99"><a href="#cb4-99"></a>    <span class="co"># print &#39;&gt;&#39;*5</span></span>
<span id="cb4-100"><a href="#cb4-100"></a>    <span class="cf">return</span> tracker </span>
<span id="cb4-101"><a href="#cb4-101"></a></span>
<span id="cb4-102"><a href="#cb4-102"></a><span class="kw">def</span> checkDiffForConfigDefects(diff_text):</span>
<span id="cb4-103"><a href="#cb4-103"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-104"><a href="#cb4-104"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-105"><a href="#cb4-105"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-106"><a href="#cb4-106"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-107"><a href="#cb4-107"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-108"><a href="#cb4-108"></a>    config_change_tracker <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb4-109"><a href="#cb4-109"></a></span>
<span id="cb4-110"><a href="#cb4-110"></a>    valu_assi_dict_addi <span class="op">=</span> getSpecialConfigDict(added_text, constants.VAR_SIGN)</span>
<span id="cb4-111"><a href="#cb4-111"></a>    valu_assi_dict_deli <span class="op">=</span> getSpecialConfigDict(deleted_text, constants.VAR_SIGN)</span>
<span id="cb4-112"><a href="#cb4-112"></a> </span>
<span id="cb4-113"><a href="#cb4-113"></a>    attr_assi_dict_addi <span class="op">=</span> getSpecialConfigDict(added_text, constants.ATTR_SIGN)</span>
<span id="cb4-114"><a href="#cb4-114"></a>    attr_assi_dict_deli <span class="op">=</span> getSpecialConfigDict(deleted_text, constants.ATTR_SIGN)</span>
<span id="cb4-115"><a href="#cb4-115"></a></span>
<span id="cb4-116"><a href="#cb4-116"></a>    <span class="co"># config_change_tracker = getConfigChangeCnt(valu_assi_dict_addi, valu_assi_dict_deli) + getConfigChangeCnt(valu_assi_dict_deli, valu_assi_dict_addi) + getConfigChangeCnt(attr_assi_dict_addi, attr_assi_dict_deli) + getConfigChangeCnt( attr_assi_dict_deli, attr_assi_dict_addi)</span></span>
<span id="cb4-117"><a href="#cb4-117"></a>    config_change_tracker <span class="op">=</span> getConfigChangeCnt(valu_assi_dict_addi, valu_assi_dict_deli) <span class="op">+</span> getConfigChangeCnt(attr_assi_dict_addi, attr_assi_dict_deli)</span>
<span id="cb4-118"><a href="#cb4-118"></a></span>
<span id="cb4-119"><a href="#cb4-119"></a>    <span class="cf">if</span> config_change_tracker <span class="op">&gt;</span> <span class="dv">0</span> :</span>
<span id="cb4-120"><a href="#cb4-120"></a>        final_flag <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-121"><a href="#cb4-121"></a></span>
<span id="cb4-122"><a href="#cb4-122"></a></span>
<span id="cb4-123"><a href="#cb4-123"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-124"><a href="#cb4-124"></a></span>
<span id="cb4-125"><a href="#cb4-125"></a><span class="kw">def</span> checkDiffForDepDefects(diff_text):</span>
<span id="cb4-126"><a href="#cb4-126"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-127"><a href="#cb4-127"></a>    final_flag, final_flag_1, final_flag_2 <span class="op">=</span> <span class="va">False</span> , <span class="va">False</span>, <span class="va">False</span> </span>
<span id="cb4-128"><a href="#cb4-128"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-129"><a href="#cb4-129"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-130"><a href="#cb4-130"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-131"><a href="#cb4-131"></a>    added_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.VAR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-132"><a href="#cb4-132"></a>    added_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-133"><a href="#cb4-133"></a></span>
<span id="cb4-134"><a href="#cb4-134"></a>    deleted_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.VAR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-135"><a href="#cb4-135"></a>    deleted_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-136"><a href="#cb4-136"></a>    <span class="co"># print added_text, deleted_text</span></span>
<span id="cb4-137"><a href="#cb4-137"></a>    added_text   <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> added_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_depen_code_elems ) ]</span>
<span id="cb4-138"><a href="#cb4-138"></a>    deleted_text <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> deleted_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_depen_code_elems ) ] </span>
<span id="cb4-139"><a href="#cb4-139"></a></span>
<span id="cb4-140"><a href="#cb4-140"></a>    <span class="cf">if</span> (<span class="bu">len</span>(added_text) <span class="op">&gt;</span> <span class="dv">0</span> ) <span class="kw">and</span> (<span class="bu">len</span>(deleted_text) <span class="op">&gt;</span> <span class="dv">0</span> ) :</span>
<span id="cb4-141"><a href="#cb4-141"></a>       final_flag <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-142"><a href="#cb4-142"></a></span>
<span id="cb4-143"><a href="#cb4-143"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-144"><a href="#cb4-144"></a></span>
<span id="cb4-145"><a href="#cb4-145"></a><span class="im">import</span> re</span>
<span id="cb4-146"><a href="#cb4-146"></a></span>
<span id="cb4-147"><a href="#cb4-147"></a><span class="kw">def</span> has_comment(line):</span>
<span id="cb4-148"><a href="#cb4-148"></a>    <span class="co"># ignore if it&#39;s a string</span></span>
<span id="cb4-149"><a href="#cb4-149"></a>    <span class="cf">if</span> re.fullmatch(<span class="vs">r&#39;\s*[&quot;\&#39;].*[&quot;\&#39;]\s*&#39;</span>, line.strip()):</span>
<span id="cb4-150"><a href="#cb4-150"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb4-151"><a href="#cb4-151"></a></span>
<span id="cb4-152"><a href="#cb4-152"></a>    <span class="co"># line&#39;s entire comment</span></span>
<span id="cb4-153"><a href="#cb4-153"></a>    <span class="cf">if</span> re.search(<span class="vs">r&#39;^\s*(#|//).+&#39;</span>, line):</span>
<span id="cb4-154"><a href="#cb4-154"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb4-155"><a href="#cb4-155"></a>    </span>
<span id="cb4-156"><a href="#cb4-156"></a>    <span class="co"># inline comment</span></span>
<span id="cb4-157"><a href="#cb4-157"></a>    <span class="cf">if</span> re.search(<span class="vs">r&#39;[^&quot;\&#39;]*(#|//).+&#39;</span>, line):</span>
<span id="cb4-158"><a href="#cb4-158"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb4-159"><a href="#cb4-159"></a></span>
<span id="cb4-160"><a href="#cb4-160"></a>    <span class="co"># blocks comment</span></span>
<span id="cb4-161"><a href="#cb4-161"></a>    <span class="cf">if</span> re.search(<span class="vs">r&#39;/\*.*?\*/&#39;</span>, line, re.DOTALL):</span>
<span id="cb4-162"><a href="#cb4-162"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb4-163"><a href="#cb4-163"></a></span>
<span id="cb4-164"><a href="#cb4-164"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb4-165"><a href="#cb4-165"></a></span>
<span id="cb4-166"><a href="#cb4-166"></a><span class="kw">def</span> checkDiffForDocDefects(diff_text):</span>
<span id="cb4-167"><a href="#cb4-167"></a>    lines_changed <span class="op">=</span> []</span>
<span id="cb4-168"><a href="#cb4-168"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-169"><a href="#cb4-169"></a>    diff_mess_str <span class="op">=</span> <span class="bu">str</span>(diff_text) <span class="co">## changes for Python 3 migration </span></span>
<span id="cb4-170"><a href="#cb4-170"></a>    <span class="cf">for</span> diff_ <span class="kw">in</span> whatthepatch.parse_patch(diff_mess_str):</span>
<span id="cb4-171"><a href="#cb4-171"></a>        all_changes_line_by_line <span class="op">=</span> diff_[<span class="dv">1</span>] </span>
<span id="cb4-172"><a href="#cb4-172"></a>        line_numbers_added, line_numbers_deleted <span class="op">=</span> [], [] </span>
<span id="cb4-173"><a href="#cb4-173"></a>        <span class="cf">if</span> all_changes_line_by_line <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-174"><a href="#cb4-174"></a>            <span class="cf">for</span> change_tuple <span class="kw">in</span> all_changes_line_by_line:</span>
<span id="cb4-175"><a href="#cb4-175"></a>                content <span class="op">=</span> change_tuple[<span class="dv">2</span>] </span>
<span id="cb4-176"><a href="#cb4-176"></a>                content <span class="op">=</span> content.replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-177"><a href="#cb4-177"></a>                <span class="cf">if</span> change_tuple[<span class="dv">0</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> has_comment(content):</span>
<span id="cb4-178"><a href="#cb4-178"></a>                    line_numbers_added.append(content)</span>
<span id="cb4-179"><a href="#cb4-179"></a>                <span class="cf">if</span> change_tuple[<span class="dv">1</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> has_comment(content):</span>
<span id="cb4-180"><a href="#cb4-180"></a>                    line_numbers_deleted.append(content)                </span>
<span id="cb4-181"><a href="#cb4-181"></a>        lines_changed <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(line_numbers_added).intersection(line_numbers_deleted)) </span>
<span id="cb4-182"><a href="#cb4-182"></a>        <span class="co"># print lines_changed</span></span>
<span id="cb4-183"><a href="#cb4-183"></a>    lines_changed <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> lines_changed <span class="cf">if</span> <span class="bu">len</span>(x_) <span class="op">&gt;</span> <span class="dv">1</span> ]</span>
<span id="cb4-184"><a href="#cb4-184"></a>    <span class="cf">if</span> <span class="bu">len</span>(lines_changed) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-185"><a href="#cb4-185"></a>        final_flag <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-186"><a href="#cb4-186"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-187"><a href="#cb4-187"></a></span>
<span id="cb4-188"><a href="#cb4-188"></a><span class="kw">def</span> checkDiffForNetwork(diff_text):</span>
<span id="cb4-189"><a href="#cb4-189"></a>    added_text, deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-190"><a href="#cb4-190"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-191"><a href="#cb4-191"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-192"><a href="#cb4-192"></a></span>
<span id="cb4-193"><a href="#cb4-193"></a>    added_text <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-194"><a href="#cb4-194"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-195"><a href="#cb4-195"></a></span>
<span id="cb4-196"><a href="#cb4-196"></a>    added_text <span class="op">=</span> [line <span class="cf">for</span> line <span class="kw">in</span> added_text <span class="cf">if</span> <span class="bu">any</span>(keyword <span class="kw">in</span> line <span class="cf">for</span> keyword <span class="kw">in</span> constants.diff_network_elems)]</span>
<span id="cb4-197"><a href="#cb4-197"></a>    deleted_text <span class="op">=</span> [line <span class="cf">for</span> line <span class="kw">in</span> deleted_text <span class="cf">if</span> <span class="bu">any</span>(keyword <span class="kw">in</span> line <span class="cf">for</span> keyword <span class="kw">in</span> constants.diff_network_elems)]</span>
<span id="cb4-198"><a href="#cb4-198"></a></span>
<span id="cb4-199"><a href="#cb4-199"></a>    <span class="cf">if</span> added_text <span class="kw">or</span> deleted_text:</span>
<span id="cb4-200"><a href="#cb4-200"></a>        final_flag <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-201"><a href="#cb4-201"></a></span>
<span id="cb4-202"><a href="#cb4-202"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-203"><a href="#cb4-203"></a></span>
<span id="cb4-204"><a href="#cb4-204"></a><span class="kw">def</span> checkDiffForCredentials(diff_text):</span>
<span id="cb4-205"><a href="#cb4-205"></a>    added_text, deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-206"><a href="#cb4-206"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-207"><a href="#cb4-207"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-208"><a href="#cb4-208"></a></span>
<span id="cb4-209"><a href="#cb4-209"></a>    added_text <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-210"><a href="#cb4-210"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-211"><a href="#cb4-211"></a></span>
<span id="cb4-212"><a href="#cb4-212"></a>    added_text <span class="op">=</span> [line <span class="cf">for</span> line <span class="kw">in</span> added_text <span class="cf">if</span> <span class="bu">any</span>(keyword <span class="kw">in</span> line <span class="cf">for</span> keyword <span class="kw">in</span> constants.diff_credentials_kw_list)]</span>
<span id="cb4-213"><a href="#cb4-213"></a>    deleted_text <span class="op">=</span> [line <span class="cf">for</span> line <span class="kw">in</span> deleted_text <span class="cf">if</span> <span class="bu">any</span>(keyword <span class="kw">in</span> line <span class="cf">for</span> keyword <span class="kw">in</span> constants.diff_credentials_kw_list)]</span>
<span id="cb4-214"><a href="#cb4-214"></a></span>
<span id="cb4-215"><a href="#cb4-215"></a>    <span class="cf">if</span> added_text <span class="kw">or</span> deleted_text:</span>
<span id="cb4-216"><a href="#cb4-216"></a>        final_flag <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-217"><a href="#cb4-217"></a></span>
<span id="cb4-218"><a href="#cb4-218"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-219"><a href="#cb4-219"></a>    </span>
<span id="cb4-220"><a href="#cb4-220"></a><span class="kw">def</span> checkDiffForLogicDefects(diff_text):</span>
<span id="cb4-221"><a href="#cb4-221"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-222"><a href="#cb4-222"></a>    final_flag, final_flag_1, final_flag_2 <span class="op">=</span> <span class="va">False</span> , <span class="va">False</span>, <span class="va">False</span> </span>
<span id="cb4-223"><a href="#cb4-223"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-224"><a href="#cb4-224"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-225"><a href="#cb4-225"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-226"><a href="#cb4-226"></a>    added_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.VAR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-227"><a href="#cb4-227"></a>    added_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-228"><a href="#cb4-228"></a></span>
<span id="cb4-229"><a href="#cb4-229"></a>    deleted_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.VAR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-230"><a href="#cb4-230"></a>    deleted_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-231"><a href="#cb4-231"></a>    <span class="co"># print added_text, deleted_text</span></span>
<span id="cb4-232"><a href="#cb4-232"></a>    added_text   <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> added_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_logic_code_elems ) ]</span>
<span id="cb4-233"><a href="#cb4-233"></a>    deleted_text <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> deleted_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_logic_code_elems ) ] </span>
<span id="cb4-234"><a href="#cb4-234"></a></span>
<span id="cb4-235"><a href="#cb4-235"></a>    <span class="cf">if</span> (<span class="bu">len</span>(added_text) <span class="op">&gt;</span> <span class="dv">0</span> ) <span class="kw">or</span> (<span class="bu">len</span>(deleted_text) <span class="op">&gt;</span> <span class="dv">0</span> ) :</span>
<span id="cb4-236"><a href="#cb4-236"></a>       final_flag <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-237"><a href="#cb4-237"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-238"><a href="#cb4-238"></a>        </span>
<span id="cb4-239"><a href="#cb4-239"></a><span class="kw">def</span> checkDiffForSecurityDefects(diff_text):</span>
<span id="cb4-240"><a href="#cb4-240"></a>    final_flag <span class="op">=</span> <span class="va">False</span>     </span>
<span id="cb4-241"><a href="#cb4-241"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-242"><a href="#cb4-242"></a></span>
<span id="cb4-243"><a href="#cb4-243"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-244"><a href="#cb4-244"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-245"><a href="#cb4-245"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-246"><a href="#cb4-246"></a>    added_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.VAR_SIGN  <span class="kw">in</span> x_ ]</span>
<span id="cb4-247"><a href="#cb4-247"></a>    added_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.ATTR_SIGN  <span class="kw">in</span> x_ ]</span>
<span id="cb4-248"><a href="#cb4-248"></a></span>
<span id="cb4-249"><a href="#cb4-249"></a>    deleted_text <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.VAR_SIGN  <span class="kw">in</span> x_ ]</span>
<span id="cb4-250"><a href="#cb4-250"></a>    deleted_text <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.ATTR_SIGN  <span class="kw">in</span> x_ ]</span>
<span id="cb4-251"><a href="#cb4-251"></a></span>
<span id="cb4-252"><a href="#cb4-252"></a>    added_text   <span class="op">=</span> [x_.split(constants.VAR_SIGN)[<span class="dv">0</span>].replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> added_text]</span>
<span id="cb4-253"><a href="#cb4-253"></a>    added_text   <span class="op">=</span> [x_.split(constants.ATTR_SIGN )[<span class="dv">0</span>].replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> added_text] </span>
<span id="cb4-254"><a href="#cb4-254"></a></span>
<span id="cb4-255"><a href="#cb4-255"></a>    deleted_text   <span class="op">=</span> [x_.split(constants.VAR_SIGN)[<span class="dv">0</span>].replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text]</span>
<span id="cb4-256"><a href="#cb4-256"></a>    deleted_text   <span class="op">=</span> [x_.split(constants.ATTR_SIGN )[<span class="dv">0</span>].replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text]    </span>
<span id="cb4-257"><a href="#cb4-257"></a></span>
<span id="cb4-258"><a href="#cb4-258"></a>    added_text   <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> added_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_secu_code_elems ) ]</span>
<span id="cb4-259"><a href="#cb4-259"></a>    deleted_text <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> deleted_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_secu_code_elems ) ]    </span>
<span id="cb4-260"><a href="#cb4-260"></a>    <span class="co"># print added_text, deleted_text</span></span>
<span id="cb4-261"><a href="#cb4-261"></a>    <span class="cf">if</span> (<span class="bu">len</span>(added_text) <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">or</span> (<span class="bu">len</span>(deleted_text) <span class="op">&gt;</span> <span class="dv">0</span>): </span>
<span id="cb4-262"><a href="#cb4-262"></a>        final_flag <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-263"><a href="#cb4-263"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-264"><a href="#cb4-264"></a>            </span>
<span id="cb4-265"><a href="#cb4-265"></a><span class="kw">def</span> checkDiffForServiceDefects(diff_text):</span>
<span id="cb4-266"><a href="#cb4-266"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-267"><a href="#cb4-267"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-268"><a href="#cb4-268"></a></span>
<span id="cb4-269"><a href="#cb4-269"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-270"><a href="#cb4-270"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-271"><a href="#cb4-271"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-272"><a href="#cb4-272"></a>    added_text   <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.VAR_SIGN  <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-273"><a href="#cb4-273"></a>    added_text   <span class="op">=</span> [x_.lower() <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-274"><a href="#cb4-274"></a></span>
<span id="cb4-275"><a href="#cb4-275"></a>    deleted_text <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.VAR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-276"><a href="#cb4-276"></a>    deleted_text <span class="op">=</span> [x_.lower() <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">not</span> <span class="kw">in</span> x_ ]</span>
<span id="cb4-277"><a href="#cb4-277"></a></span>
<span id="cb4-278"><a href="#cb4-278"></a>    added_text   <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> added_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_service_code_elems) ]</span>
<span id="cb4-279"><a href="#cb4-279"></a>    deleted_text <span class="op">=</span> [z_ <span class="cf">for</span> z_ <span class="kw">in</span> deleted_text <span class="cf">if</span> <span class="bu">any</span>(x_ <span class="kw">in</span> z_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.diff_service_code_elems) ] </span>
<span id="cb4-280"><a href="#cb4-280"></a></span>
<span id="cb4-281"><a href="#cb4-281"></a>    <span class="cf">if</span> (<span class="bu">len</span>(added_text) <span class="op">&gt;</span> <span class="dv">0</span> ) <span class="kw">and</span> (<span class="bu">len</span>(deleted_text) <span class="op">&gt;</span> <span class="dv">0</span> ) :</span>
<span id="cb4-282"><a href="#cb4-282"></a>       final_flag <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-283"><a href="#cb4-283"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-284"><a href="#cb4-284"></a></span>
<span id="cb4-285"><a href="#cb4-285"></a><span class="kw">def</span> matchStringsFuzzily(add_str_lis, del_str_lis):</span>
<span id="cb4-286"><a href="#cb4-286"></a>    <span class="co"># takes two sring as input, returns levesjhteins&#39;s ratio, reff: https://www.datacamp.com/community/tutorials/fuzzy-string-python</span></span>
<span id="cb4-287"><a href="#cb4-287"></a>    add_str <span class="op">=</span> constants.WHITE_SPACE.join(add_str_lis)</span>
<span id="cb4-288"><a href="#cb4-288"></a>    del_str <span class="op">=</span> constants.WHITE_SPACE.join(del_str_lis) </span>
<span id="cb4-289"><a href="#cb4-289"></a>    lower_add_str <span class="op">=</span> add_str.lower() </span>
<span id="cb4-290"><a href="#cb4-290"></a>    lower_del_str <span class="op">=</span> del_str.lower()</span>
<span id="cb4-291"><a href="#cb4-291"></a>    lev_str_ratio <span class="op">=</span> fuzz.token_sort_ratio( lower_add_str, lower_del_str  ) <span class="co">## this is levenshteien ratio, in a sorted manner </span></span>
<span id="cb4-292"><a href="#cb4-292"></a>    <span class="cf">return</span> lev_str_ratio</span>
<span id="cb4-293"><a href="#cb4-293"></a></span>
<span id="cb4-294"><a href="#cb4-294"></a></span>
<span id="cb4-295"><a href="#cb4-295"></a><span class="kw">def</span> checkDiffForSyntaxDefects(diff_text):</span>
<span id="cb4-296"><a href="#cb4-296"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-297"><a href="#cb4-297"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-298"><a href="#cb4-298"></a>    attr_added_text , attr_deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-299"><a href="#cb4-299"></a>    var_added_text , var_deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-300"><a href="#cb4-300"></a></span>
<span id="cb4-301"><a href="#cb4-301"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-302"><a href="#cb4-302"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-303"><a href="#cb4-303"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-304"><a href="#cb4-304"></a></span>
<span id="cb4-305"><a href="#cb4-305"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb4-306"><a href="#cb4-306"></a><span class="co">    look for variable name change </span></span>
<span id="cb4-307"><a href="#cb4-307"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb4-308"><a href="#cb4-308"></a>    attr_added_text   <span class="op">=</span> [x_.lower() <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">in</span> x_ ]</span>
<span id="cb4-309"><a href="#cb4-309"></a>    var_added_text    <span class="op">=</span> [x_.lower().replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.VAR_SIGN <span class="kw">in</span> x_ ]</span>
<span id="cb4-310"><a href="#cb4-310"></a></span>
<span id="cb4-311"><a href="#cb4-311"></a>    attr_deleted_text <span class="op">=</span> [x_.lower() <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.ATTR_SIGN <span class="kw">in</span> x_ ]</span>
<span id="cb4-312"><a href="#cb4-312"></a>    var_deleted_text  <span class="op">=</span> [x_.lower().replace(constants.WHITE_SPACE, <span class="st">&#39;&#39;</span>) <span class="cf">for</span> x_ <span class="kw">in</span> deleted_text <span class="cf">if</span> constants.VAR_SIGN <span class="kw">in</span> x_ ]</span>
<span id="cb4-313"><a href="#cb4-313"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb4-314"><a href="#cb4-314"></a><span class="co">    Now compare </span></span>
<span id="cb4-315"><a href="#cb4-315"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb4-316"><a href="#cb4-316"></a></span>
<span id="cb4-317"><a href="#cb4-317"></a>    <span class="co"># if (len(added_text)) and (len(deleted_text)): ## wrong logic </span></span>
<span id="cb4-318"><a href="#cb4-318"></a>    <span class="cf">if</span> ((<span class="bu">len</span>(attr_added_text)) <span class="op">==</span> (<span class="bu">len</span>(attr_deleted_text))) <span class="kw">or</span> (<span class="bu">len</span>(var_added_text) <span class="op">==</span> <span class="bu">len</span>(var_deleted_text) ) : <span class="co">## right logic , same number of additions and deletiosn for variables </span></span>
<span id="cb4-319"><a href="#cb4-319"></a>        final_flag <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-320"><a href="#cb4-320"></a>    <span class="cf">elif</span> ( (matchStringsFuzzily(attr_added_text, attr_deleted_text) <span class="op">&gt;</span> constants.lev_cutoff ) <span class="kw">or</span> (matchStringsFuzzily(var_added_text, var_deleted_text) <span class="op">&gt;</span> constants.lev_cutoff ) ):</span>
<span id="cb4-321"><a href="#cb4-321"></a>        <span class="co"># Why does the original author uses minus?</span></span>
<span id="cb4-322"><a href="#cb4-322"></a>        <span class="co"># final_flag - True </span></span>
<span id="cb4-323"><a href="#cb4-323"></a>        final_flag <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-324"><a href="#cb4-324"></a></span>
<span id="cb4-325"><a href="#cb4-325"></a></span>
<span id="cb4-326"><a href="#cb4-326"></a>    <span class="cf">return</span> final_flag</span>
<span id="cb4-327"><a href="#cb4-327"></a></span>
<span id="cb4-328"><a href="#cb4-328"></a></span>
<span id="cb4-329"><a href="#cb4-329"></a></span>
<span id="cb4-330"><a href="#cb4-330"></a><span class="kw">def</span> checkDiffForIdempotenceDefects(diff_text):</span>
<span id="cb4-331"><a href="#cb4-331"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-332"><a href="#cb4-332"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-333"><a href="#cb4-333"></a></span>
<span id="cb4-334"><a href="#cb4-334"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-335"><a href="#cb4-335"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-336"><a href="#cb4-336"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-337"><a href="#cb4-337"></a></span>
<span id="cb4-338"><a href="#cb4-338"></a>    added_text <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> added_text <span class="cf">if</span> constants.diff_idem_code_elem <span class="kw">in</span> x_ ] </span>
<span id="cb4-339"><a href="#cb4-339"></a>    <span class="cf">if</span> (<span class="bu">len</span>(added_text) <span class="op">==</span> <span class="dv">1</span>) <span class="kw">or</span> (<span class="bu">len</span>(deleted_text) <span class="op">&gt;</span> constants.diff_idem_removal_cnt):</span>
<span id="cb4-340"><a href="#cb4-340"></a>       final_flag <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-341"><a href="#cb4-341"></a></span>
<span id="cb4-342"><a href="#cb4-342"></a>    <span class="cf">return</span> final_flag </span>
<span id="cb4-343"><a href="#cb4-343"></a></span>
<span id="cb4-344"><a href="#cb4-344"></a><span class="kw">def</span> checkDiffForIdemWithAttr(diff_text):</span>
<span id="cb4-345"><a href="#cb4-345"></a>    final_flag <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-346"><a href="#cb4-346"></a>    flag_list  <span class="op">=</span> []</span>
<span id="cb4-347"><a href="#cb4-347"></a>    added_text , deleted_text <span class="op">=</span> [], []</span>
<span id="cb4-348"><a href="#cb4-348"></a></span>
<span id="cb4-349"><a href="#cb4-349"></a>    added_text, deleted_text <span class="op">=</span> getAddDelLines(diff_text)</span>
<span id="cb4-350"><a href="#cb4-350"></a>    added_text   <span class="op">=</span> filterTextList(added_text)</span>
<span id="cb4-351"><a href="#cb4-351"></a>    deleted_text <span class="op">=</span> filterTextList(deleted_text)</span>
<span id="cb4-352"><a href="#cb4-352"></a></span>
<span id="cb4-353"><a href="#cb4-353"></a>    <span class="cf">if</span>(<span class="bu">len</span>(deleted_text) <span class="op">&lt;</span> <span class="bu">len</span>(added_text)):</span>
<span id="cb4-354"><a href="#cb4-354"></a>        <span class="cf">for</span> text_ <span class="kw">in</span> added_text:</span>
<span id="cb4-355"><a href="#cb4-355"></a>            <span class="cf">for</span> elem <span class="kw">in</span> constants.diff_extra_idem_elems:</span>
<span id="cb4-356"><a href="#cb4-356"></a>                <span class="cf">if</span> elem <span class="kw">in</span> text_:</span>
<span id="cb4-357"><a href="#cb4-357"></a>                    flag_list.append(<span class="va">True</span>) </span>
<span id="cb4-358"><a href="#cb4-358"></a>    <span class="cf">if</span> (<span class="bu">len</span>(flag_list) <span class="op">&gt;</span> <span class="dv">0</span>):    </span>
<span id="cb4-359"><a href="#cb4-359"></a>        final_flag <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-360"><a href="#cb4-360"></a>    <span class="cf">return</span> final_flag </span>
<span id="cb4-361"><a href="#cb4-361"></a>    </span></code></pre></div>
<h3 id="classifier-code">Classifier Code</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">import</span> constants </span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="im">import</span> diff_parser</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="im">import</span> re </span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="im">import</span> spacy </span>
<span id="cb5-5"><a href="#cb5-5"></a>spacy_engine <span class="op">=</span> spacy.load(constants.SPACY_ENG_DICT)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="im">from</span> nltk.stem.porter <span class="im">import</span> <span class="op">*</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>stemmerObj <span class="op">=</span> PorterStemmer()</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="kw">def</span> checkForNum(str_par):</span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="cf">return</span> <span class="bu">any</span>(char_.isdigit() <span class="cf">for</span> char_ <span class="kw">in</span> str_par)</span>
<span id="cb5-13"><a href="#cb5-13"></a></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="kw">def</span> filterCommitMessage(msg_par):</span>
<span id="cb5-15"><a href="#cb5-15"></a>    temp_msg_    <span class="op">=</span> msg_par.lower()</span>
<span id="cb5-16"><a href="#cb5-16"></a>    splitted_msg <span class="op">=</span> temp_msg_.split(constants.WHITE_SPACE)</span>
<span id="cb5-17"><a href="#cb5-17"></a>    splitted_msg <span class="op">=</span> [stemmerObj.stem(x_) <span class="cf">for</span> x_ <span class="kw">in</span> splitted_msg] <span class="co">##porter stemming , x_ is a string </span></span>
<span id="cb5-18"><a href="#cb5-18"></a>    splitted_msg <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> splitted_msg <span class="cf">if</span> <span class="bu">len</span>(x_) <span class="op">&gt;</span> <span class="dv">1</span> ]  <span class="co">## remove special characterers , x_ is a string </span></span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="co"># splitted_msg = [x_ for x_ in splitted_msg if x_.isalnum() ]  ## remove special characterers , x_ is a string </span></span>
<span id="cb5-20"><a href="#cb5-20"></a>    filtered_msg <span class="op">=</span> [x_ <span class="cf">for</span> x_ <span class="kw">in</span> splitted_msg <span class="cf">if</span> checkForNum(x_) <span class="op">==</span> <span class="va">False</span> ] <span class="co">## remove alphanumeric characters , x_ is a string     </span></span>
<span id="cb5-21"><a href="#cb5-21"></a></span>
<span id="cb5-22"><a href="#cb5-22"></a>    <span class="cf">return</span> filtered_msg </span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="kw">def</span> doDepAnalysis(msg_par):</span>
<span id="cb5-25"><a href="#cb5-25"></a>    msg_to_analyze <span class="op">=</span> []</span>
<span id="cb5-26"><a href="#cb5-26"></a>    filtered_msg <span class="op">=</span> filterCommitMessage(msg_par)</span>
<span id="cb5-27"><a href="#cb5-27"></a>    unicode_msg_ <span class="op">=</span> constants.WHITE_SPACE.join(filtered_msg)</span>
<span id="cb5-28"><a href="#cb5-28"></a>    <span class="cf">try</span>:</span>
<span id="cb5-29"><a href="#cb5-29"></a>        unicode_msg  <span class="op">=</span> <span class="bu">str</span>(unicode_msg_, constants.UTF_ENCODING)</span>
<span id="cb5-30"><a href="#cb5-30"></a>    <span class="cf">except</span>: </span>
<span id="cb5-31"><a href="#cb5-31"></a>        unicode_msg <span class="op">=</span> unicode_msg_</span>
<span id="cb5-32"><a href="#cb5-32"></a>    <span class="co"># print unicode_msg </span></span>
<span id="cb5-33"><a href="#cb5-33"></a>    spacy_doc <span class="op">=</span> spacy_engine(unicode_msg)</span>
<span id="cb5-34"><a href="#cb5-34"></a>    <span class="cf">for</span> token <span class="kw">in</span> spacy_doc:</span>
<span id="cb5-35"><a href="#cb5-35"></a>        <span class="cf">if</span> (token.dep_ <span class="op">==</span> constants.ROOT_TOKEN): </span>
<span id="cb5-36"><a href="#cb5-36"></a>            <span class="cf">for</span> x_ <span class="kw">in</span> token.children:</span>
<span id="cb5-37"><a href="#cb5-37"></a>                msg_to_analyze.append(x_.text)</span>
<span id="cb5-38"><a href="#cb5-38"></a>    <span class="cf">return</span> constants.WHITE_SPACE.join(msg_to_analyze) </span>
<span id="cb5-39"><a href="#cb5-39"></a></span>
<span id="cb5-40"><a href="#cb5-40"></a></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="kw">def</span> doTempCleanUp(msg_str):</span>
<span id="cb5-42"><a href="#cb5-42"></a>    msg_ <span class="op">=</span> msg_str.replace(constants.CLOSE_KW, constants.WHITE_SPACE)</span>
<span id="cb5-43"><a href="#cb5-43"></a>    msg_ <span class="op">=</span> msg_.replace(constants.MERGE_KW, constants.WHITE_SPACE)</span>
<span id="cb5-44"><a href="#cb5-44"></a>    msg_ <span class="op">=</span> msg_.replace(constants.DFLT_KW, constants.WHITE_SPACE)    </span>
<span id="cb5-45"><a href="#cb5-45"></a></span>
<span id="cb5-46"><a href="#cb5-46"></a>    <span class="cf">return</span> msg_</span>
<span id="cb5-47"><a href="#cb5-47"></a></span>
<span id="cb5-48"><a href="#cb5-48"></a><span class="kw">def</span> detectBuggyCommit(msg_, verboseFlag <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb5-49"><a href="#cb5-49"></a>    flag2ret  <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb5-50"><a href="#cb5-50"></a>    index2ret <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-51"><a href="#cb5-51"></a>    msg_ <span class="op">=</span> msg_.lower()</span>
<span id="cb5-52"><a href="#cb5-52"></a></span>
<span id="cb5-53"><a href="#cb5-53"></a>    <span class="cf">if</span> (constants.IDEM_XTRA_KW <span class="kw">in</span> msg_) <span class="kw">or</span> (constants.SYNTAX_XTRA_KW2 <span class="kw">in</span> msg_):</span>
<span id="cb5-54"><a href="#cb5-54"></a>        msg_ <span class="op">=</span> doTempCleanUp(msg_)</span>
<span id="cb5-55"><a href="#cb5-55"></a></span>
<span id="cb5-56"><a href="#cb5-56"></a>    <span class="cf">if</span>(<span class="bu">any</span>(x_ <span class="kw">in</span> msg_ <span class="cf">for</span> x_ <span class="kw">in</span> constants.prem_bug_kw_list)) <span class="kw">and</span> ( constants.DFLT_KW <span class="kw">not</span> <span class="kw">in</span> msg_) <span class="kw">and</span> (constants.MERGE_KW <span class="kw">not</span> <span class="kw">in</span> msg_) :    </span>
<span id="cb5-57"><a href="#cb5-57"></a>        str2see <span class="op">=</span> [y_ <span class="cf">for</span> y_ <span class="kw">in</span> constants.prem_bug_kw_list][<span class="dv">0</span>]</span>
<span id="cb5-58"><a href="#cb5-58"></a>        index2ret <span class="op">=</span> msg_.find( str2see  ) </span>
<span id="cb5-59"><a href="#cb5-59"></a>        flag2ret <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb5-60"><a href="#cb5-60"></a>    <span class="cf">return</span> flag2ret, index2ret</span>
<span id="cb5-61"><a href="#cb5-61"></a></span>
<span id="cb5-62"><a href="#cb5-62"></a><span class="kw">def</span> detectRevertedCommit(msg_):</span>
<span id="cb5-63"><a href="#cb5-63"></a>    flag2ret  <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb5-64"><a href="#cb5-64"></a>    msg_ <span class="op">=</span> msg_.lower()</span>
<span id="cb5-65"><a href="#cb5-65"></a>    revert_matches <span class="op">=</span> re.findall(constants.REVERT_REGEX, msg_)</span>
<span id="cb5-66"><a href="#cb5-66"></a>    <span class="cf">if</span>(<span class="bu">len</span>(revert_matches) <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb5-67"><a href="#cb5-67"></a>        flag2ret <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb5-68"><a href="#cb5-68"></a>    <span class="cf">return</span> flag2ret</span>
<span id="cb5-69"><a href="#cb5-69"></a></span>
<span id="cb5-70"><a href="#cb5-70"></a><span class="kw">def</span> categ_check(key_words<span class="op">=</span>[], msg<span class="op">=</span><span class="va">None</span>, diff_function<span class="op">=</span><span class="va">None</span>, diff<span class="op">=</span><span class="va">None</span>, classification<span class="op">=</span>constants.NO_DEFECT_CATEG):</span>
<span id="cb5-71"><a href="#cb5-71"></a>    <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> msg <span class="cf">for</span> kw <span class="kw">in</span> key_words) <span class="kw">or</span> (diff_function <span class="op">!=</span> <span class="va">None</span> <span class="kw">and</span> diff_function(diff)):</span>
<span id="cb5-72"><a href="#cb5-72"></a>        <span class="cf">return</span> classification</span>
<span id="cb5-73"><a href="#cb5-73"></a>    <span class="cf">return</span> constants.NO_DEFECT_CATEG</span>
<span id="cb5-74"><a href="#cb5-74"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb5-75"><a href="#cb5-75"></a><span class="co">detectCateg takes a sentence and a diff from a commit message as input , and return a defect category (single value)</span></span>
<span id="cb5-76"><a href="#cb5-76"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb5-77"><a href="#cb5-77"></a><span class="kw">def</span> detectCateg(msg_, diff_, verboseFlag<span class="op">=</span><span class="va">False</span>,<span class="bu">hash</span><span class="op">=</span><span class="va">None</span>): </span>
<span id="cb5-78"><a href="#cb5-78"></a>    temp_msg_ <span class="op">=</span> <span class="st">&#39;&#39;</span> <span class="co">## for oracle dataset </span></span>
<span id="cb5-79"><a href="#cb5-79"></a>    defect_categ_to_ret <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb5-80"><a href="#cb5-80"></a>    </span>
<span id="cb5-81"><a href="#cb5-81"></a>    <span class="cf">if</span> (<span class="bu">len</span>(diff_) <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb5-82"><a href="#cb5-82"></a>        temp_msg_list   <span class="op">=</span> filterCommitMessage(msg_) <span class="co"># for extra false negative rules </span></span>
<span id="cb5-83"><a href="#cb5-83"></a>        temp_msg_       <span class="op">=</span> constants.WHITE_SPACE.join(temp_msg_list) <span class="co"># for extra false negative rules </span></span>
<span id="cb5-84"><a href="#cb5-84"></a>        msg_            <span class="op">=</span> doDepAnalysis(msg_) <span class="co">## depnding on results, this extra step of dependnecy parsing may change                            </span></span>
<span id="cb5-85"><a href="#cb5-85"></a>        </span>
<span id="cb5-86"><a href="#cb5-86"></a>        <span class="cf">for</span> classification, key_words, diff_function <span class="kw">in</span> constants.CLASSIFICATION_PARSE:</span>
<span id="cb5-87"><a href="#cb5-87"></a>            categ_check_classification <span class="op">=</span> categ_check(msg<span class="op">=</span>msg_, diff<span class="op">=</span>diff_, key_words<span class="op">=</span>key_words, diff_function<span class="op">=</span>diff_function, classification<span class="op">=</span>classification)</span>
<span id="cb5-88"><a href="#cb5-88"></a>            <span class="cf">if</span> categ_check_classification <span class="op">!=</span> constants.NO_DEFECT_CATEG <span class="kw">and</span> categ_check_classification <span class="op">!=</span> constants.BUGGY_COMMIT:</span>
<span id="cb5-89"><a href="#cb5-89"></a>                defect_categ_to_ret.add(categ_check_classification)</span>
<span id="cb5-90"><a href="#cb5-90"></a>        </span>
<span id="cb5-91"><a href="#cb5-91"></a>        <span class="co"># These are the extra rules that the author selected</span></span>
<span id="cb5-92"><a href="#cb5-92"></a>        </span>
<span id="cb5-93"><a href="#cb5-93"></a>        <span class="co"># extra rule for idempotence </span></span>
<span id="cb5-94"><a href="#cb5-94"></a>        <span class="cf">if</span> ( constants.IDEM_XTRA_KW <span class="kw">in</span> temp_msg_ ) <span class="kw">and</span> ( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ ) <span class="kw">or</span> <span class="bu">any</span>(_ <span class="kw">in</span> temp_msg_ <span class="cf">for</span> _ <span class="kw">in</span> constants.idem_defect_kw_list):</span>
<span id="cb5-95"><a href="#cb5-95"></a>            defect_categ_to_ret.add(constants.IDEM_DEFECT_CATEG)</span>
<span id="cb5-96"><a href="#cb5-96"></a></span>
<span id="cb5-97"><a href="#cb5-97"></a>        <span class="co"># extra rule for conditional </span></span>
<span id="cb5-98"><a href="#cb5-98"></a>        <span class="cf">if</span> (( constants.LOGIC_XTRA_KW1 <span class="kw">in</span> temp_msg_ ) <span class="kw">or</span> ( constants.LOGIC_XTRA_KW2 <span class="kw">in</span> temp_msg_ ) <span class="kw">or</span> ( constants.LOGIC_XTRA_KW3 <span class="kw">in</span> temp_msg_ ) ) <span class="kw">and</span> ( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ ):</span>
<span id="cb5-99"><a href="#cb5-99"></a>            defect_categ_to_ret.add(constants.CONDI_DEFECT_CATEG )</span>
<span id="cb5-100"><a href="#cb5-100"></a></span>
<span id="cb5-101"><a href="#cb5-101"></a>        <span class="co"># extra rule for syntax </span></span>
<span id="cb5-102"><a href="#cb5-102"></a>        <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> temp_msg_ <span class="cf">for</span> kw <span class="kw">in</span> constants.syxtax_xtra_kw_list) <span class="kw">and</span> (( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ )  ):</span>
<span id="cb5-103"><a href="#cb5-103"></a>            defect_categ_to_ret.add(constants.SYNTAX_DEFECT_CATEG)</span>
<span id="cb5-104"><a href="#cb5-104"></a></span>
<span id="cb5-105"><a href="#cb5-105"></a>        <span class="co"># extra rule for doc </span></span>
<span id="cb5-106"><a href="#cb5-106"></a>        <span class="cf">if</span> ( constants.DOC_XTRA_KW <span class="kw">in</span> temp_msg_  ) <span class="kw">and</span> ( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ ):</span>
<span id="cb5-107"><a href="#cb5-107"></a>            defect_categ_to_ret.add(constants.DOC_DEFECT_CATEG)</span>
<span id="cb5-108"><a href="#cb5-108"></a></span>
<span id="cb5-109"><a href="#cb5-109"></a>        <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> temp_msg_ <span class="cf">for</span> kw <span class="kw">in</span> constants.dep_xtra_kw_list) <span class="kw">and</span> (( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ )  ):</span>
<span id="cb5-110"><a href="#cb5-110"></a>            defect_categ_to_ret.add(constants.DEP_DEFECT_CATEG)</span>
<span id="cb5-111"><a href="#cb5-111"></a>            </span>
<span id="cb5-112"><a href="#cb5-112"></a>        <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> temp_msg_ <span class="cf">for</span> kw <span class="kw">in</span> constants.resource_xtra_kw_list) <span class="kw">and</span> (( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ )  ):</span>
<span id="cb5-113"><a href="#cb5-113"></a>            defect_categ_to_ret.add(constants.SERVICE_RESOURCE_DEFECT_CATEG)</span>
<span id="cb5-114"><a href="#cb5-114"></a>            </span>
<span id="cb5-115"><a href="#cb5-115"></a>        <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> temp_msg_ <span class="cf">for</span> kw <span class="kw">in</span> constants.network_extra_kw_list) <span class="kw">and</span> (( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ )  ):</span>
<span id="cb5-116"><a href="#cb5-116"></a>            defect_categ_to_ret.add(constants.NETWORK_DEFECT_CATEG)</span>
<span id="cb5-117"><a href="#cb5-117"></a>            </span>
<span id="cb5-118"><a href="#cb5-118"></a>        <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> temp_msg_ <span class="cf">for</span> kw <span class="kw">in</span> constants.storage_extra_kw_list) <span class="kw">and</span> (( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ )  ):</span>
<span id="cb5-119"><a href="#cb5-119"></a>            defect_categ_to_ret.add(constants.STORAGE_DEFECT_CATEG)</span>
<span id="cb5-120"><a href="#cb5-120"></a>            </span>
<span id="cb5-121"><a href="#cb5-121"></a>        <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> temp_msg_ <span class="cf">for</span> kw <span class="kw">in</span> constants.credentials_extra_kw_list) <span class="kw">and</span> (( constants.EXTRA_FIX_KEYWORD <span class="kw">in</span> temp_msg_ )  ):</span>
<span id="cb5-122"><a href="#cb5-122"></a>            defect_categ_to_ret.add(constants.CREDENTIALS_DEFECT_CATEG)</span>
<span id="cb5-123"><a href="#cb5-123"></a>        </span>
<span id="cb5-124"><a href="#cb5-124"></a>    <span class="cf">return</span> <span class="bu">list</span>(defect_categ_to_ret)</span></code></pre></div>
<h3 id="constants-code">Constants Code</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">import</span> diff_parser</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>DATASET_DIR  <span class="op">=</span> <span class="st">&#39;dataset&#39;</span> </span>
<span id="cb6-4"><a href="#cb6-4"></a>REPO_FILE_LIST <span class="op">=</span> <span class="st">&#39;eligible_repos.csv&#39;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>MASTER_BRANCH  <span class="op">=</span> <span class="st">&#39;main&#39;</span> </span>
<span id="cb6-6"><a href="#cb6-6"></a>FILE_READ_MODE <span class="op">=</span> <span class="st">&#39;r&#39;</span> </span>
<span id="cb6-7"><a href="#cb6-7"></a>AST_PATH <span class="op">=</span> <span class="st">&#39;EXTRA_AST&#39;</span> </span>
<span id="cb6-8"><a href="#cb6-8"></a>PP_EXTENSION <span class="op">=</span> <span class="st">&#39;.pp&#39;</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>IAC_FILES <span class="op">=</span> [</span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="st">&quot;Pulumi.yaml&quot;</span>, <span class="st">&quot;Pulumi.yml&quot;</span>, <span class="st">&quot;cdk.json&quot;</span>, <span class="st">&quot;cdktf.json&quot;</span>,</span>
<span id="cb6-11"><a href="#cb6-11"></a>    <span class="st">&quot;.py&quot;</span>, <span class="st">&quot;.go&quot;</span>, <span class="st">&quot;.js&quot;</span>, <span class="st">&quot;.ts&quot;</span>, <span class="st">&quot;.java&quot;</span>, <span class="st">&quot;.tf&quot;</span>,</span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="st">&quot;.cs&quot;</span>, <span class="st">&quot;.fs&quot;</span>, <span class="st">&quot;.vb&quot;</span>, <span class="st">&quot;.cpp&quot;</span>, <span class="st">&quot;.kt&quot;</span>, <span class="st">&quot;.php&quot;</span>, <span class="st">&quot;.rb&quot;</span>, <span class="st">&quot;.swift&quot;</span>, <span class="st">&quot;.abap&quot;</span>, <span class="st">&quot;.edn&quot;</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>]</span>
<span id="cb6-14"><a href="#cb6-14"></a>DATE_TIME_FORMAT <span class="op">=</span> <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st">T%H-%M-%S&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>WHITE_SPACE  <span class="op">=</span> <span class="st">&#39; &#39;</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>TAB <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>NEWLINE <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>HASH_SYMBOL <span class="op">=</span> <span class="st">&#39;#&#39;</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>comments_elems <span class="op">=</span> [<span class="st">&#39;#&#39;</span>, <span class="st">&#39;//&#39;</span>, <span class="st">&#39;/*&#39;</span>, <span class="st">&#39;*/&#39;</span>]</span>
<span id="cb6-20"><a href="#cb6-20"></a>CSV_REPLICATION <span class="op">=</span> <span class="st">&#39;/home/aluno/ACID-dataset/ARTIFACT/IaC_Defect_Categ_Revamp/replication/iac_time_period.csv&#39;</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>CSV_DEFAULT_PATH <span class="op">=</span> <span class="st">&#39;/home/aluno/filtered-repositories-iac-criteria/criteria4/&#39;</span></span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a>CHANGE_DIR_CMD <span class="op">=</span> <span class="st">&#39;cd &#39;</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>GIT_COMM_CMD_1 <span class="op">=</span> <span class="st">&quot;git show --name-status &quot;</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>GIT_COMM_CMD_2 <span class="op">=</span> <span class="st">&quot; | awk &#39;/(Pulumi</span><span class="ch">\\</span><span class="st">.yaml|Pulumi</span><span class="ch">\\</span><span class="st">.yml|cdk</span><span class="ch">\\</span><span class="st">.json|cdktf</span><span class="ch">\\</span><span class="st">.json|</span><span class="ch">\\</span><span class="st">.py|</span><span class="ch">\\</span><span class="st">.go|</span><span class="ch">\\</span><span class="st">.js|</span><span class="ch">\\</span><span class="st">.ts|</span><span class="ch">\\</span><span class="st">.java|</span><span class="ch">\\</span><span class="st">.tf|</span><span class="ch">\\</span><span class="st">.cs|</span><span class="ch">\\</span><span class="st">.fs|</span><span class="ch">\\</span><span class="st">.vb|</span><span class="ch">\\</span><span class="st">.cpp|</span><span class="ch">\\</span><span class="st">.kt|</span><span class="ch">\\</span><span class="st">.php|</span><span class="ch">\\</span><span class="st">.rb|</span><span class="ch">\\</span><span class="st">.swift|</span><span class="ch">\\</span><span class="st">.abap|</span><span class="ch">\\</span><span class="st">.edn)/ {print $2}&#39;&quot;</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>BASH_CMD <span class="op">=</span> <span class="st">&#39;bash&#39;</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>BASH_FLAG <span class="op">=</span> <span class="st">&#39;-c&#39;</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>GIT_SHOW_CMD <span class="op">=</span> <span class="st">&quot;git show&quot;</span></span>
<span id="cb6-29"><a href="#cb6-29"></a>GIT_DIFF_CMD <span class="op">=</span> <span class="st">&quot; git diff&quot;</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>HG_REV_SPECL_CMD   <span class="op">=</span> <span class="st">&quot; ; hg log -p -r &quot;</span> </span>
<span id="cb6-31"><a href="#cb6-31"></a></span>
<span id="cb6-32"><a href="#cb6-32"></a>ENCODING <span class="op">=</span> <span class="st">&#39;utf8&#39;</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>UTF_ENCODING <span class="op">=</span> <span class="st">&#39;utf-8&#39;</span></span>
<span id="cb6-34"><a href="#cb6-34"></a>FILE_WRITE_MODE <span class="op">=</span> <span class="st">&#39;w&#39;</span></span>
<span id="cb6-35"><a href="#cb6-35"></a>SPACY_ENG_DICT  <span class="op">=</span> <span class="st">&#39;en_core_web_sm&#39;</span></span>
<span id="cb6-36"><a href="#cb6-36"></a>ROOT_TOKEN <span class="op">=</span> <span class="st">&#39;ROOT&#39;</span></span>
<span id="cb6-37"><a href="#cb6-37"></a></span>
<span id="cb6-38"><a href="#cb6-38"></a>STR_LIST_BOUNDS  <span class="op">=</span> <span class="dv">3</span> <span class="co"># tri-grams </span></span>
<span id="cb6-39"><a href="#cb6-39"></a>NO_DEFECT_CATEG        <span class="op">=</span> <span class="st">&#39;NO_DEFECT&#39;</span></span>
<span id="cb6-40"><a href="#cb6-40"></a>BUGGY_COMMIT           <span class="op">=</span> <span class="st">&#39;BUGGY_COMMIT&#39;</span></span>
<span id="cb6-41"><a href="#cb6-41"></a>prem_bug_kw_list      <span class="op">=</span> [<span class="st">&#39;error&#39;</span>, <span class="st">&#39;bug&#39;</span>, <span class="st">&#39;fix&#39;</span>, <span class="st">&#39;issu&#39;</span>, <span class="st">&#39;mistake&#39;</span>, <span class="st">&#39;incorrect&#39;</span>, <span class="st">&#39;fault&#39;</span>, <span class="st">&#39;defect&#39;</span>, <span class="st">&#39;flaw&#39;</span>, <span class="st">&#39;solve&#39;</span> ]</span>
<span id="cb6-42"><a href="#cb6-42"></a></span>
<span id="cb6-43"><a href="#cb6-43"></a>CONFIG_DEFECT_CATEG    <span class="op">=</span> <span class="st">&#39;CONFIG_DATA_DEFECT&#39;</span></span>
<span id="cb6-44"><a href="#cb6-44"></a>config_defect_kw_list       <span class="op">=</span> [<span class="st">&#39;value&#39;</span>, <span class="st">&#39;config&#39;</span>, <span class="st">&#39;option&#39;</span>,  <span class="st">&#39;setting&#39;</span>, <span class="st">&#39;hiera&#39;</span>, <span class="st">&#39;data&#39;</span>]</span>
<span id="cb6-45"><a href="#cb6-45"></a></span>
<span id="cb6-46"><a href="#cb6-46"></a>DEP_DEFECT_CATEG       <span class="op">=</span> <span class="st">&#39;DEP_DEFECT&#39;</span></span>
<span id="cb6-47"><a href="#cb6-47"></a>dep_defect_kw_list    <span class="op">=</span>     [<span class="st">&#39;requir&#39;</span>, <span class="st">&#39;depend&#39;</span>, <span class="st">&#39;relation&#39;</span>, <span class="st">&#39;order&#39;</span>, <span class="st">&#39;sync&#39;</span>, <span class="st">&#39;compatibil&#39;</span>, <span class="st">&#39;ensur&#39;</span>,  <span class="st">&#39;inherit&#39;</span>]</span>
<span id="cb6-48"><a href="#cb6-48"></a>dep_defect_kw_list    <span class="op">+=</span>    [<span class="st">&#39;version&#39;</span>, <span class="st">&#39;deprecat&#39;</span>, <span class="st">&#39;packag&#39;</span>, <span class="st">&#39;path&#39;</span>, <span class="st">&#39;modul&#39;</span>, <span class="st">&#39;upgrad&#39;</span>, <span class="st">&#39;updat&#39;</span>]</span>
<span id="cb6-49"><a href="#cb6-49"></a>dep_xtra_kw_list       <span class="op">=</span> [<span class="st">&#39;module&#39;</span>]</span>
<span id="cb6-50"><a href="#cb6-50"></a></span>
<span id="cb6-51"><a href="#cb6-51"></a><span class="co"># Retirado import por causa de port em network</span></span>
<span id="cb6-52"><a href="#cb6-52"></a><span class="co"># These are used on diff_parser</span></span>
<span id="cb6-53"><a href="#cb6-53"></a>VAR_SIGN <span class="op">=</span> <span class="st">&#39;=&#39;</span></span>
<span id="cb6-54"><a href="#cb6-54"></a>ATTR_SIGN <span class="op">=</span> <span class="st">&#39;=&gt;&#39;</span></span>
<span id="cb6-55"><a href="#cb6-55"></a>diff_depen_code_elems <span class="op">=</span> [<span class="st">&#39;~&gt;&#39;</span> , <span class="st">&#39;::&#39;</span>, <span class="st">&#39;include&#39;</span>, <span class="st">&#39;packag&#39;</span>, <span class="st">&#39;exec&#39;</span>, <span class="st">&#39;require&#39;</span>, <span class="st">&#39;import&#39;</span>, <span class="st">&#39;version&#39;</span>]</span>
<span id="cb6-56"><a href="#cb6-56"></a></span>
<span id="cb6-57"><a href="#cb6-57"></a>DOC_DEFECT_CATEG      <span class="op">=</span> <span class="st">&#39;DOC_DEFECT&#39;</span></span>
<span id="cb6-58"><a href="#cb6-58"></a><span class="co"># origal author doc_defect_kw_list    =     [&#39;doc&#39;, &#39;comment&#39;, &#39;spec&#39;, &#39;license&#39;, &#39;copyright&#39;, &#39;notice&#39;, &#39;header&#39;, &#39;readme&#39;] </span></span>
<span id="cb6-59"><a href="#cb6-59"></a><span class="co"># changed made removing &#39;spec&#39; and header</span></span>
<span id="cb6-60"><a href="#cb6-60"></a>doc_defect_kw_list    <span class="op">=</span>     [<span class="st">&#39;doc&#39;</span>, <span class="st">&#39;comment&#39;</span>, <span class="st">&#39;licens&#39;</span>, <span class="st">&#39;copyright&#39;</span>, <span class="st">&#39;notic&#39;</span>, <span class="st">&#39;readm&#39;</span>] </span>
<span id="cb6-61"><a href="#cb6-61"></a>doc_defect_kw_list    <span class="op">+=</span>    [<span class="st">&#39;descript&#39;</span>]</span>
<span id="cb6-62"><a href="#cb6-62"></a></span>
<span id="cb6-63"><a href="#cb6-63"></a>IDEM_DEFECT_CATEG     <span class="op">=</span> <span class="st">&#39;IDEM_DEFECT&#39;</span></span>
<span id="cb6-64"><a href="#cb6-64"></a>idem_defect_kw_list   <span class="op">=</span>     [<span class="st">&#39;idempot&#39;</span>]</span>
<span id="cb6-65"><a href="#cb6-65"></a>idem_defect_kw_list   <span class="op">+=</span>    [<span class="st">&#39;determin&#39;</span>]</span>
<span id="cb6-66"><a href="#cb6-66"></a></span>
<span id="cb6-67"><a href="#cb6-67"></a>diff_idem_code_elem    <span class="op">=</span> <span class="st">&#39;class&#39;</span> </span>
<span id="cb6-68"><a href="#cb6-68"></a>diff_idem_removal_cnt  <span class="op">=</span> <span class="dv">10</span> </span>
<span id="cb6-69"><a href="#cb6-69"></a></span>
<span id="cb6-70"><a href="#cb6-70"></a>CONDI_DEFECT_CATEG     <span class="op">=</span> <span class="st">&#39;CONDITIONAL_DEFECT&#39;</span></span>
<span id="cb6-71"><a href="#cb6-71"></a>logic_defect_kw_list  <span class="op">=</span>     [<span class="st">&#39;logic&#39;</span>, <span class="st">&#39;condition&#39;</span>, <span class="st">&#39;bool&#39;</span>]</span>
<span id="cb6-72"><a href="#cb6-72"></a></span>
<span id="cb6-73"><a href="#cb6-73"></a>diff_logic_code_elems <span class="op">=</span> [<span class="st">&#39;if&#39;</span> , <span class="st">&#39;unless&#39;</span>, <span class="st">&#39;els&#39;</span>, <span class="st">&#39;case&#39;</span>]</span>
<span id="cb6-74"><a href="#cb6-74"></a>diff_logic_code_elems<span class="op">+=</span> [<span class="st">&#39;while&#39;</span>, <span class="st">&#39;elif&#39;</span>]</span>
<span id="cb6-75"><a href="#cb6-75"></a></span>
<span id="cb6-76"><a href="#cb6-76"></a>SECU_DEFECT_CATEG           <span class="op">=</span> <span class="st">&#39;SECURITY_DEFECT&#39;</span></span>
<span id="cb6-77"><a href="#cb6-77"></a>secu_defect_kw_list         <span class="op">=</span>     [<span class="st">&#39;vulner&#39;</span>, <span class="st">&#39;ssl&#39;</span>, <span class="st">&#39;secr&#39;</span>, <span class="st">&#39;authent&#39;</span>, <span class="st">&#39;password&#39;</span>, <span class="st">&#39;security&#39;</span>, <span class="st">&#39;cve&#39;</span>]</span>
<span id="cb6-78"><a href="#cb6-78"></a><span class="co"># secu_defect_kw_list         +=    [&#39;cert&#39;, &#39;firewall&#39;, &#39;encrypt&#39;, &#39;protect&#39;]</span></span>
<span id="cb6-79"><a href="#cb6-79"></a><span class="co"># adding access to control</span></span>
<span id="cb6-80"><a href="#cb6-80"></a>secu_defect_kw_list         <span class="op">+=</span>    [<span class="st">&#39;cert&#39;</span>, <span class="st">&#39;firewall&#39;</span>, <span class="st">&#39;encrypt&#39;</span>, <span class="st">&#39;protect&#39;</span>, <span class="st">&#39;access&#39;</span>]</span>
<span id="cb6-81"><a href="#cb6-81"></a></span>
<span id="cb6-82"><a href="#cb6-82"></a>diff_secu_code_elems        <span class="op">=</span> [<span class="st">&#39;tls&#39;</span>, <span class="st">&#39;cert&#39;</span>, <span class="st">&#39;cred&#39;</span>, <span class="st">&#39;ssl&#39;</span>, <span class="st">&#39;password&#39;</span>, <span class="st">&#39;pass&#39;</span>, <span class="st">&#39;pwd&#39;</span>] </span>
<span id="cb6-83"><a href="#cb6-83"></a></span>
<span id="cb6-84"><a href="#cb6-84"></a>NETWORK_DEFECT_CATEG        <span class="op">=</span> <span class="st">&#39;CD_NETWORK_DEFECT&#39;</span></span>
<span id="cb6-85"><a href="#cb6-85"></a><span class="co"># removing address that was from the original author</span></span>
<span id="cb6-86"><a href="#cb6-86"></a><span class="co"># network_defect_kw_list      = [&#39;network&#39;, &#39;address&#39;, &#39;port&#39;, &#39;tcp&#39;, &#39;dhcp&#39;, &#39;ssh&#39;, &#39;gateway&#39;, &#39;connect&#39;]</span></span>
<span id="cb6-87"><a href="#cb6-87"></a>network_defect_kw_list      <span class="op">=</span> [<span class="st">&#39;network&#39;</span>, <span class="st">&#39;port&#39;</span>, <span class="st">&#39;tcp&#39;</span>, <span class="st">&#39;dhcp&#39;</span>, <span class="st">&#39;ssh&#39;</span>, <span class="st">&#39;gateway&#39;</span>, <span class="st">&#39;connect&#39;</span>]</span>
<span id="cb6-88"><a href="#cb6-88"></a>network_defect_kw_list     <span class="op">+=</span> [<span class="st">&#39;rout&#39;</span>]</span>
<span id="cb6-89"><a href="#cb6-89"></a>diff_network_elems          <span class="op">=</span> [<span class="st">&#39;url&#39;</span>, <span class="st">&#39;vpc&#39;</span>, <span class="st">&#39;subnet&#39;</span>, <span class="st">&#39;endpoint&#39;</span>]</span>
<span id="cb6-90"><a href="#cb6-90"></a>network_extra_kw_list       <span class="op">=</span> [<span class="st">&#39;gateway&#39;</span>]</span>
<span id="cb6-91"><a href="#cb6-91"></a><span class="co"># ip tem que sair por causa de descrIPt em doc</span></span>
<span id="cb6-92"><a href="#cb6-92"></a></span>
<span id="cb6-93"><a href="#cb6-93"></a>STORAGE_DEFECT_CATEG        <span class="op">=</span> <span class="st">&#39;CD_STORAGE_DEFECT&#39;</span></span>
<span id="cb6-94"><a href="#cb6-94"></a>storage_defect_kw_list      <span class="op">=</span> [<span class="st">&#39;sql&#39;</span>, <span class="st">&#39;db&#39;</span>, <span class="st">&#39;databas&#39;</span>, <span class="st">&#39;disk&#39;</span>]</span>
<span id="cb6-95"><a href="#cb6-95"></a>storage_extra_kw_list       <span class="op">=</span> [<span class="st">&#39;disk&#39;</span>]</span>
<span id="cb6-96"><a href="#cb6-96"></a><span class="co"># retirar database por causa de data em configuration</span></span>
<span id="cb6-97"><a href="#cb6-97"></a></span>
<span id="cb6-98"><a href="#cb6-98"></a>CACHE_DEFECT_CATEG          <span class="op">=</span> <span class="st">&#39;CD_CACHE_DEFECT&#39;</span></span>
<span id="cb6-99"><a href="#cb6-99"></a>cache_defect_kw_list        <span class="op">=</span> [<span class="st">&#39;cach&#39;</span>, <span class="st">&#39;memory&#39;</span>, <span class="st">&#39;buffer&#39;</span>, <span class="st">&#39;evict&#39;</span>, <span class="st">&#39;ttl&#39;</span>]</span>
<span id="cb6-100"><a href="#cb6-100"></a></span>
<span id="cb6-101"><a href="#cb6-101"></a>CREDENTIALS_DEFECT_CATEG    <span class="op">=</span> <span class="st">&#39;CD_CREDENTIAL_DEFECT&#39;</span></span>
<span id="cb6-102"><a href="#cb6-102"></a>credentials_defect_kw_list  <span class="op">=</span> [<span class="st">&#39;polic&#39;</span>, <span class="st">&#39;credential&#39;</span>, <span class="st">&#39;iam&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;token&#39;</span>, <span class="st">&#39;user&#39;</span>, <span class="st">&#39;usernam&#39;</span>, <span class="st">&#39;password&#39;</span>]</span>
<span id="cb6-103"><a href="#cb6-103"></a>credentials_extra_kw_list   <span class="op">=</span> [<span class="st">&#39;polic&#39;</span>]</span>
<span id="cb6-104"><a href="#cb6-104"></a>diff_credentials_kw_list    <span class="op">=</span> [<span class="st">&#39;polic&#39;</span>, <span class="st">&#39;credential&#39;</span>]</span>
<span id="cb6-105"><a href="#cb6-105"></a></span>
<span id="cb6-106"><a href="#cb6-106"></a>FILE_SYSTEM_DEFECT_CATEG    <span class="op">=</span> <span class="st">&#39;CD_FILE_SYSTEM_DEFECT&#39;</span></span>
<span id="cb6-107"><a href="#cb6-107"></a>file_system_defect_kw_list  <span class="op">=</span> [<span class="st">&#39;file&#39;</span>, <span class="st">&#39;permiss&#39;</span>]</span>
<span id="cb6-108"><a href="#cb6-108"></a></span>
<span id="cb6-109"><a href="#cb6-109"></a>SYNTAX_DEFECT_CATEG    <span class="op">=</span> <span class="st">&#39;SYNTAX_DEFECT&#39;</span></span>
<span id="cb6-110"><a href="#cb6-110"></a>syntax_defect_kw_list    <span class="op">=</span> [<span class="st">&#39;compil&#39;</span>, <span class="st">&#39;lint&#39;</span>, <span class="st">&#39;warn&#39;</span>, <span class="st">&#39;typo&#39;</span>, <span class="st">&#39;spell&#39;</span>, <span class="st">&#39;indent&#39;</span>, <span class="st">&#39;regex&#39;</span>, <span class="st">&#39;duplicat&#39;</span>, <span class="st">&#39;variabl&#39;</span>, <span class="st">&#39;whitespac&#39;</span>]</span>
<span id="cb6-111"><a href="#cb6-111"></a>syntax_defect_kw_list   <span class="op">+=</span> [<span class="st">&#39;type&#39;</span>, <span class="st">&#39;format&#39;</span>, <span class="st">&#39;naming&#39;</span>, <span class="st">&#39;casing&#39;</span>, <span class="st">&#39;styl&#39;</span>, <span class="st">&#39;comma&#39;</span>, <span class="st">&#39;pattern&#39;</span>, <span class="st">&#39;quot&#39;</span>]</span>
<span id="cb6-112"><a href="#cb6-112"></a><span class="co"># retirar name por causa de username</span></span>
<span id="cb6-113"><a href="#cb6-113"></a></span>
<span id="cb6-114"><a href="#cb6-114"></a>SERVICE_RESOURCE_DEFECT_CATEG        <span class="op">=</span> <span class="st">&#39;SERVICE_RESOURCE_DEFECT&#39;</span></span>
<span id="cb6-115"><a href="#cb6-115"></a>resource_defect_kw_list     <span class="op">=</span> [<span class="st">&#39;servic&#39;</span>, <span class="st">&#39;server&#39;</span>, <span class="st">&#39;location&#39;</span>, <span class="st">&#39;resourc&#39;</span>, <span class="st">&#39;provi&#39;</span>, <span class="st">&#39;cluster&#39;</span>]</span>
<span id="cb6-116"><a href="#cb6-116"></a>resource_xtra_kw_list       <span class="op">=</span> [<span class="st">&#39;kube&#39;</span>,<span class="st">&#39;cloud&#39;</span>]</span>
<span id="cb6-117"><a href="#cb6-117"></a>diff_service_code_elems     <span class="op">=</span> [<span class="st">&#39;service&#39;</span>] </span>
<span id="cb6-118"><a href="#cb6-118"></a></span>
<span id="cb6-119"><a href="#cb6-119"></a>SERVICE_PANIC_DEFECT_CATEG          <span class="op">=</span> <span class="st">&#39;SERVICE_PANIC_DEFECT&#39;</span></span>
<span id="cb6-120"><a href="#cb6-120"></a>panic_defect_kw_list <span class="op">=</span> [<span class="st">&#39;check&#39;</span>, <span class="st">&#39;deploy&#39;</span>, <span class="st">&#39;reboot&#39;</span>, <span class="st">&#39;build&#39;</span>, <span class="st">&#39;mount&#39;</span>, <span class="st">&#39;kernel&#39;</span>, <span class="st">&#39;extran&#39;</span>, <span class="st">&#39;bypass&#39;</span>]</span>
<span id="cb6-121"><a href="#cb6-121"></a></span>
<span id="cb6-122"><a href="#cb6-122"></a>CLASSIFICATION_PARSE <span class="op">=</span> [</span>
<span id="cb6-123"><a href="#cb6-123"></a>    (CONDI_DEFECT_CATEG,            logic_defect_kw_list,       diff_parser.checkDiffForLogicDefects),</span>
<span id="cb6-124"><a href="#cb6-124"></a>    (IDEM_DEFECT_CATEG,             idem_defect_kw_list,        <span class="va">None</span>),</span>
<span id="cb6-125"><a href="#cb6-125"></a>    (DOC_DEFECT_CATEG,              doc_defect_kw_list,         diff_parser.checkDiffForDocDefects),</span>
<span id="cb6-126"><a href="#cb6-126"></a>    (SYNTAX_DEFECT_CATEG,           syntax_defect_kw_list,      <span class="va">None</span>),</span>
<span id="cb6-127"><a href="#cb6-127"></a>    (SECU_DEFECT_CATEG,             secu_defect_kw_list,        diff_parser.checkDiffForSecurityDefects),</span>
<span id="cb6-128"><a href="#cb6-128"></a>    (DEP_DEFECT_CATEG,              dep_defect_kw_list,         diff_parser.checkDiffForDepDefects),</span>
<span id="cb6-129"><a href="#cb6-129"></a>    (CONFIG_DEFECT_CATEG,           config_defect_kw_list,      diff_parser.checkDiffForConfigDefects),</span>
<span id="cb6-130"><a href="#cb6-130"></a>    (NETWORK_DEFECT_CATEG,          network_defect_kw_list,     diff_parser.checkDiffForNetwork),</span>
<span id="cb6-131"><a href="#cb6-131"></a>    (STORAGE_DEFECT_CATEG,          storage_defect_kw_list,     <span class="va">None</span>),</span>
<span id="cb6-132"><a href="#cb6-132"></a>    (CACHE_DEFECT_CATEG,            cache_defect_kw_list,       <span class="va">None</span>),</span>
<span id="cb6-133"><a href="#cb6-133"></a>    (FILE_SYSTEM_DEFECT_CATEG,      file_system_defect_kw_list, <span class="va">None</span>),</span>
<span id="cb6-134"><a href="#cb6-134"></a>    (CREDENTIALS_DEFECT_CATEG,      credentials_defect_kw_list, diff_parser.checkDiffForCredentials),</span>
<span id="cb6-135"><a href="#cb6-135"></a>    (SERVICE_RESOURCE_DEFECT_CATEG, resource_defect_kw_list,    diff_parser.checkDiffForServiceDefects),</span>
<span id="cb6-136"><a href="#cb6-136"></a>    (SERVICE_PANIC_DEFECT_CATEG,    panic_defect_kw_list,       <span class="va">None</span>)</span>
<span id="cb6-137"><a href="#cb6-137"></a>]</span>
<span id="cb6-138"><a href="#cb6-138"></a></span>
<span id="cb6-139"><a href="#cb6-139"></a>EXTRA_FIX_KEYWORD     <span class="op">=</span> <span class="st">&#39;fix&#39;</span>   </span>
<span id="cb6-140"><a href="#cb6-140"></a>EXTRA_BUG_KEYWORD     <span class="op">=</span> <span class="st">&#39;bug&#39;</span>   </span>
<span id="cb6-141"><a href="#cb6-141"></a></span>
<span id="cb6-142"><a href="#cb6-142"></a>DFLT_KW         <span class="op">=</span> <span class="st">&#39;default&#39;</span></span>
<span id="cb6-143"><a href="#cb6-143"></a>CLOSE_KW        <span class="op">=</span> <span class="st">&#39;closes-bug&#39;</span></span>
<span id="cb6-144"><a href="#cb6-144"></a>MERGE_KW        <span class="op">=</span> <span class="st">&#39;merge&#39;</span> </span>
<span id="cb6-145"><a href="#cb6-145"></a>REVERT_KW       <span class="op">=</span> <span class="st">&#39;revert&#39;</span></span>
<span id="cb6-146"><a href="#cb6-146"></a>REVERT_REGEX    <span class="op">=</span> <span class="vs">r&#39;^revert.*\&quot;.*\&quot;&#39;</span></span>
<span id="cb6-147"><a href="#cb6-147"></a></span>
<span id="cb6-148"><a href="#cb6-148"></a>IDEM_XTRA_KW    <span class="op">=</span> <span class="st">&#39;idempot&#39;</span> <span class="co"># for detectBuggyCommit() </span></span>
<span id="cb6-149"><a href="#cb6-149"></a></span>
<span id="cb6-150"><a href="#cb6-150"></a>LOGIC_XTRA_KW1  <span class="op">=</span> <span class="st">&#39;condit&#39;</span></span>
<span id="cb6-151"><a href="#cb6-151"></a>LOGIC_XTRA_KW2  <span class="op">=</span> <span class="st">&#39;logic&#39;</span></span>
<span id="cb6-152"><a href="#cb6-152"></a>LOGIC_XTRA_KW3  <span class="op">=</span> <span class="st">&#39;bool&#39;</span> </span>
<span id="cb6-153"><a href="#cb6-153"></a></span>
<span id="cb6-154"><a href="#cb6-154"></a>SYNTAX_XTRA_KW1 <span class="op">=</span> <span class="st">&#39;lint&#39;</span></span>
<span id="cb6-155"><a href="#cb6-155"></a>SYNTAX_XTRA_KW2 <span class="op">=</span> <span class="st">&#39;typo&#39;</span> </span>
<span id="cb6-156"><a href="#cb6-156"></a>SYNTAX_XTRA_KW4 <span class="op">=</span> <span class="st">&#39;syntax&#39;</span></span>
<span id="cb6-157"><a href="#cb6-157"></a>syxtax_xtra_kw_list <span class="op">=</span> [<span class="st">&#39;lint&#39;</span>, <span class="st">&#39;typo&#39;</span>, <span class="st">&#39;syntax&#39;</span>,<span class="st">&#39;type&#39;</span>]</span>
<span id="cb6-158"><a href="#cb6-158"></a>DOC_XTRA_KW     <span class="op">=</span> <span class="st">&#39;notice&#39;</span> </span>
<span id="cb6-159"><a href="#cb6-159"></a><span class="co"># DEPEND_XTRA_KW  = &#39;override&#39; </span></span>
<span id="cb6-160"><a href="#cb6-160"></a><span class="co"># NETWORK_XTRA_KW = &#39;provis&#39;</span></span>
<span id="cb6-161"><a href="#cb6-161"></a></span>
<span id="cb6-162"><a href="#cb6-162"></a>diff_config_code_elems <span class="op">=</span> [<span class="st">&#39;hiera&#39;</span> , <span class="st">&#39;hash&#39;</span>, <span class="st">&#39;parameter&#39;</span>]</span>
<span id="cb6-163"><a href="#cb6-163"></a></span>
<span id="cb6-164"><a href="#cb6-164"></a>diff_extra_idem_elems  <span class="op">=</span> [<span class="st">&#39;ensure&#39;</span>, <span class="st">&#39;unless&#39;</span>, <span class="st">&#39;creates&#39;</span>, <span class="st">&#39;replace&#39;</span>] </span>
<span id="cb6-165"><a href="#cb6-165"></a></span>
<span id="cb6-166"><a href="#cb6-166"></a>lev_cutoff <span class="op">=</span> <span class="dv">75</span></span>
<span id="cb6-167"><a href="#cb6-167"></a></span>
<span id="cb6-168"><a href="#cb6-168"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb6-169"><a href="#cb6-169"></a><span class="co">Oracle dataset work </span></span>
<span id="cb6-170"><a href="#cb6-170"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb6-171"><a href="#cb6-171"></a>ORACLE_HASH_CHECKLIST <span class="op">=</span> [<span class="st">&#39;75e460ab929a76e9e4a8d42740a529b3a476e952&#39;</span>, </span>
<span id="cb6-172"><a href="#cb6-172"></a>                         <span class="st">&#39;9a5a540738f887f87886ae4f9f52d5ade1b26bc7&#39;</span>, </span>
<span id="cb6-173"><a href="#cb6-173"></a>                         <span class="st">&#39;0d834093814b3d184eff36b2835530a847ee6421&#39;</span>, </span>
<span id="cb6-174"><a href="#cb6-174"></a>                         <span class="st">&#39;854e0e7b9fc339dc56bf3e2b3de7107c3f35b835&#39;</span>, </span>
<span id="cb6-175"><a href="#cb6-175"></a>                         <span class="st">&#39;a7dedf197a24bf8a3fad00d1d1f58eede2f43057&#39;</span>,</span>
<span id="cb6-176"><a href="#cb6-176"></a>                         <span class="st">&#39;114536ef2e7c569300019844e0ca57d278e27791&#39;</span></span>
<span id="cb6-177"><a href="#cb6-177"></a>                        ]</span></code></pre></div>
<h3 id="criteria-code">Criteria Code</h3>
<div class="sourceCode" id="cb7"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="im">import</span> os</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="im">import</span> sys</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="im">import</span> subprocess</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="im">from</span> concurrent.futures <span class="im">import</span> ThreadPoolExecutor</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a>iac_extensions <span class="op">=</span> [<span class="st">&quot;.tf&quot;</span>, <span class="st">&quot;Pulumi.yaml&quot;</span>, <span class="st">&quot;Pulumi.yml&quot;</span>, <span class="st">&quot;cdk.json&quot;</span>, <span class="st">&quot;cdktf.json&quot;</span>, <span class="st">&quot;.edn&quot;</span>]</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="kw">def</span> is_not_fork(repo_path):</span>
<span id="cb7-10"><a href="#cb7-10"></a>    config_file <span class="op">=</span> os.path.join(repo_path, <span class="st">&quot;.git&quot;</span>, <span class="st">&quot;config&quot;</span>)</span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(config_file):</span>
<span id="cb7-12"><a href="#cb7-12"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[WARNING] </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">: .git/config no encontrado.&quot;</span>)</span>
<span id="cb7-13"><a href="#cb7-13"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>    <span class="cf">with</span> <span class="bu">open</span>(config_file, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb7-15"><a href="#cb7-15"></a>        is_fork <span class="op">=</span> <span class="st">&quot;fork = true&quot;</span> <span class="kw">not</span> <span class="kw">in</span> f.read()</span>
<span id="cb7-16"><a href="#cb7-16"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">: Fork? </span><span class="sc">{</span><span class="st">&#39;No&#39;</span> <span class="cf">if</span> is_fork <span class="cf">else</span> <span class="st">&#39;Sim&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-17"><a href="#cb7-17"></a>        <span class="cf">return</span> is_fork</span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="kw">def</span> iac_percentage(repo_path):</span>
<span id="cb7-20"><a href="#cb7-20"></a>    total_files <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>    iac_files <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>    iac_directories <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb7-23"><a href="#cb7-23"></a>    <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(repo_path):</span>
<span id="cb7-24"><a href="#cb7-24"></a>        has_iac <span class="op">=</span> <span class="bu">any</span>(file_.endswith(ext) <span class="cf">for</span> file_ <span class="kw">in</span> files <span class="cf">for</span> ext <span class="kw">in</span> iac_extensions)</span>
<span id="cb7-25"><a href="#cb7-25"></a>        <span class="cf">if</span> has_iac:</span>
<span id="cb7-26"><a href="#cb7-26"></a>            iac_directories.add(root)</span>
<span id="cb7-27"><a href="#cb7-27"></a>        total_files <span class="op">+=</span> <span class="bu">len</span>(files)</span>
<span id="cb7-28"><a href="#cb7-28"></a>    <span class="cf">for</span> iac_dir <span class="kw">in</span> iac_directories:</span>
<span id="cb7-29"><a href="#cb7-29"></a>        iac_files <span class="op">+=</span> <span class="bu">sum</span>(<span class="bu">len</span>(files) <span class="cf">for</span> _, _, files <span class="kw">in</span> os.walk(iac_dir))</span>
<span id="cb7-30"><a href="#cb7-30"></a>    percentage <span class="op">=</span> (iac_files <span class="op">/</span> total_files) <span class="op">*</span> <span class="dv">100</span> <span class="cf">if</span> total_files <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">: IaC = </span><span class="sc">{</span>iac_files<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>total_files<span class="sc">}</span><span class="ss"> arquivos (</span><span class="sc">{</span>percentage<span class="sc">:.2f}</span><span class="ss">%)&quot;</span>)</span>
<span id="cb7-32"><a href="#cb7-32"></a>    <span class="cf">return</span> percentage</span>
<span id="cb7-33"><a href="#cb7-33"></a></span>
<span id="cb7-34"><a href="#cb7-34"></a><span class="kw">def</span> commits_per_month(repo_path):</span>
<span id="cb7-35"><a href="#cb7-35"></a>    result <span class="op">=</span> subprocess.run(</span>
<span id="cb7-36"><a href="#cb7-36"></a>        [<span class="st">&quot;git&quot;</span>, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;--date=format:%Y-%m&quot;</span>, <span class="st">&quot;--pretty=format:%ad&quot;</span>],</span>
<span id="cb7-37"><a href="#cb7-37"></a>        cwd<span class="op">=</span>repo_path,</span>
<span id="cb7-38"><a href="#cb7-38"></a>        stdout<span class="op">=</span>subprocess.PIPE,</span>
<span id="cb7-39"><a href="#cb7-39"></a>        text<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-40"><a href="#cb7-40"></a>    )</span>
<span id="cb7-41"><a href="#cb7-41"></a>    dates <span class="op">=</span> result.stdout.splitlines()</span>
<span id="cb7-42"><a href="#cb7-42"></a>    unique_months <span class="op">=</span> <span class="bu">set</span>(dates)</span>
<span id="cb7-43"><a href="#cb7-43"></a>    cpm <span class="op">=</span> <span class="bu">len</span>(dates) <span class="op">/</span> <span class="bu">len</span>(unique_months) <span class="cf">if</span> unique_months <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb7-44"><a href="#cb7-44"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(dates)<span class="sc">}</span><span class="ss"> commits em </span><span class="sc">{</span><span class="bu">len</span>(unique_months)<span class="sc">}</span><span class="ss"> meses = </span><span class="sc">{</span>cpm<span class="sc">:.2f}</span><span class="ss"> commits/ms&quot;</span>)</span>
<span id="cb7-45"><a href="#cb7-45"></a>    <span class="cf">return</span> cpm</span>
<span id="cb7-46"><a href="#cb7-46"></a></span>
<span id="cb7-47"><a href="#cb7-47"></a><span class="kw">def</span> num_contributors(repo_path):</span>
<span id="cb7-48"><a href="#cb7-48"></a>    result <span class="op">=</span> subprocess.run(</span>
<span id="cb7-49"><a href="#cb7-49"></a>        [<span class="st">&quot;git&quot;</span>, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;--pretty=format:%ae&quot;</span>],</span>
<span id="cb7-50"><a href="#cb7-50"></a>        cwd<span class="op">=</span>repo_path,</span>
<span id="cb7-51"><a href="#cb7-51"></a>        stdout<span class="op">=</span>subprocess.PIPE,</span>
<span id="cb7-52"><a href="#cb7-52"></a>        text<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-53"><a href="#cb7-53"></a>    )</span>
<span id="cb7-54"><a href="#cb7-54"></a>    all_emails <span class="op">=</span> <span class="bu">set</span>(result.stdout.splitlines())</span>
<span id="cb7-55"><a href="#cb7-55"></a>    filtered <span class="op">=</span> {email <span class="cf">for</span> email <span class="kw">in</span> all_emails <span class="cf">if</span> <span class="kw">not</span> email.endswith(<span class="st">&quot;@github.com&quot;</span>)}</span>
<span id="cb7-56"><a href="#cb7-56"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(filtered)<span class="sc">}</span><span class="ss"> contribuidores (sem bots/github)&quot;</span>)</span>
<span id="cb7-57"><a href="#cb7-57"></a>    <span class="cf">return</span> <span class="bu">len</span>(filtered)</span>
<span id="cb7-58"><a href="#cb7-58"></a></span>
<span id="cb7-59"><a href="#cb7-59"></a><span class="kw">def</span> analyze_repo(repo, dataset_dir, input_dir, output_dir, filters):</span>
<span id="cb7-60"><a href="#cb7-60"></a>    repo_path <span class="op">=</span> os.path.join(dataset_dir, repo)</span>
<span id="cb7-61"><a href="#cb7-61"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isdir(os.path.join(repo_path, <span class="st">&quot;.git&quot;</span>)):</span>
<span id="cb7-62"><a href="#cb7-62"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[WARNING] </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss"> no  um repositrio Git vlido. Ignorando.&quot;</span>)</span>
<span id="cb7-63"><a href="#cb7-63"></a>        <span class="cf">return</span> {<span class="st">&quot;repo&quot;</span>: repo, <span class="st">&quot;status&quot;</span>: <span class="st">&quot;Not a Git repo&quot;</span>}</span>
<span id="cb7-64"><a href="#cb7-64"></a></span>
<span id="cb7-65"><a href="#cb7-65"></a>    input_repos <span class="op">=</span> os.listdir(input_dir) <span class="cf">if</span> input_dir <span class="cf">else</span> []</span>
<span id="cb7-66"><a href="#cb7-66"></a>    is_input <span class="op">=</span> repo <span class="kw">in</span> input_repos</span>
<span id="cb7-67"><a href="#cb7-67"></a></span>
<span id="cb7-68"><a href="#cb7-68"></a>    results <span class="op">=</span> {<span class="st">&quot;repo&quot;</span>: repo}</span>
<span id="cb7-69"><a href="#cb7-69"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Analisando repositrio: </span><span class="sc">{</span>repo<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-70"><a href="#cb7-70"></a></span>
<span id="cb7-71"><a href="#cb7-71"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--fork&quot;</span>]:</span>
<span id="cb7-72"><a href="#cb7-72"></a>        results[<span class="st">&quot;is_not_fork&quot;</span>] <span class="op">=</span> is_not_fork(repo_path)</span>
<span id="cb7-73"><a href="#cb7-73"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--iac-percentage&quot;</span>]:</span>
<span id="cb7-74"><a href="#cb7-74"></a>        results[<span class="st">&quot;iac_percentage&quot;</span>] <span class="op">=</span> iac_percentage(repo_path)</span>
<span id="cb7-75"><a href="#cb7-75"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--commits-per-month&quot;</span>]:</span>
<span id="cb7-76"><a href="#cb7-76"></a>        results[<span class="st">&quot;commits_per_month&quot;</span>] <span class="op">=</span> commits_per_month(repo_path)</span>
<span id="cb7-77"><a href="#cb7-77"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--num-contributors&quot;</span>]:</span>
<span id="cb7-78"><a href="#cb7-78"></a>        results[<span class="st">&quot;num_contributors&quot;</span>] <span class="op">=</span> num_contributors(repo_path)</span>
<span id="cb7-79"><a href="#cb7-79"></a></span>
<span id="cb7-80"><a href="#cb7-80"></a>    passed <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-81"><a href="#cb7-81"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--fork&quot;</span>] <span class="kw">and</span> <span class="kw">not</span> results.get(<span class="st">&quot;is_not_fork&quot;</span>, <span class="va">False</span>):</span>
<span id="cb7-82"><a href="#cb7-82"></a>        passed <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-83"><a href="#cb7-83"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--iac-percentage&quot;</span>] <span class="kw">and</span> (results.get(<span class="st">&quot;iac_percentage&quot;</span>) <span class="kw">or</span> <span class="dv">0</span>) <span class="op">&lt;</span> <span class="dv">11</span>:</span>
<span id="cb7-84"><a href="#cb7-84"></a>        passed <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-85"><a href="#cb7-85"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--commits-per-month&quot;</span>] <span class="kw">and</span> (results.get(<span class="st">&quot;commits_per_month&quot;</span>) <span class="kw">or</span> <span class="dv">0</span>) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb7-86"><a href="#cb7-86"></a>        passed <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-87"><a href="#cb7-87"></a>    <span class="cf">if</span> filters[<span class="st">&quot;--num-contributors&quot;</span>] <span class="kw">and</span> (results.get(<span class="st">&quot;num_contributors&quot;</span>) <span class="kw">or</span> <span class="dv">0</span>) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb7-88"><a href="#cb7-88"></a>        passed <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-89"><a href="#cb7-89"></a></span>
<span id="cb7-90"><a href="#cb7-90"></a>    results[<span class="st">&quot;passed&quot;</span>] <span class="op">=</span> passed</span>
<span id="cb7-91"><a href="#cb7-91"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>repo<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="st">&#39;PASSOU&#39;</span> <span class="cf">if</span> passed <span class="cf">else</span> <span class="st">&#39;NO passou&#39;</span><span class="sc">}</span><span class="ss"> nos filtros.&quot;</span>)</span>
<span id="cb7-92"><a href="#cb7-92"></a></span>
<span id="cb7-93"><a href="#cb7-93"></a>    <span class="cf">if</span> passed <span class="kw">and</span> is_input:</span>
<span id="cb7-94"><a href="#cb7-94"></a>        target_path <span class="op">=</span> os.path.join(output_dir, repo)</span>
<span id="cb7-95"><a href="#cb7-95"></a>        <span class="cf">try</span>:</span>
<span id="cb7-96"><a href="#cb7-96"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(target_path):</span>
<span id="cb7-97"><a href="#cb7-97"></a>                os.symlink(os.path.abspath(repo_path), target_path, target_is_directory<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-98"><a href="#cb7-98"></a>                results[<span class="st">&quot;link_created&quot;</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-99"><a href="#cb7-99"></a>                <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Link simblico criado para </span><span class="sc">{</span>repo<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-100"><a href="#cb7-100"></a>            <span class="cf">else</span>:</span>
<span id="cb7-101"><a href="#cb7-101"></a>                results[<span class="st">&quot;link_created&quot;</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-102"><a href="#cb7-102"></a>                <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Link simblico j existia para </span><span class="sc">{</span>repo<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-103"><a href="#cb7-103"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-104"><a href="#cb7-104"></a>            results[<span class="st">&quot;link_created&quot;</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-105"><a href="#cb7-105"></a>            results[<span class="st">&quot;error&quot;</span>] <span class="op">=</span> <span class="bu">str</span>(e)</span>
<span id="cb7-106"><a href="#cb7-106"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] Falha ao criar link para </span><span class="sc">{</span>repo<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-107"><a href="#cb7-107"></a>    <span class="cf">return</span> results</span>
<span id="cb7-108"><a href="#cb7-108"></a></span>
<span id="cb7-109"><a href="#cb7-109"></a><span class="cf">if</span> <span class="va">__name__</span><span class="op">==</span><span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb7-110"><a href="#cb7-110"></a>    <span class="cf">if</span> <span class="st">&quot;--dataset&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="st">&quot;--output&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb7-111"><a href="#cb7-111"></a>        <span class="bu">print</span>(<span class="st">&quot;Usage: python3 criterias.py --dataset path --input path --output path [--fork] [--iac-percentage] [--commits-per-month] [--num-contributors] [--csv path/to/file.csv]&quot;</span>)</span>
<span id="cb7-112"><a href="#cb7-112"></a>        sys.exit(<span class="dv">1</span>)</span>
<span id="cb7-113"><a href="#cb7-113"></a></span>
<span id="cb7-114"><a href="#cb7-114"></a>    dataset_dir <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--dataset&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb7-115"><a href="#cb7-115"></a>    output_dir <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--output&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb7-116"><a href="#cb7-116"></a>    input_dir <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--input&quot;</span>) <span class="op">+</span> <span class="dv">1</span>]) <span class="cf">if</span> <span class="st">&quot;--input&quot;</span> <span class="kw">in</span> sys.argv <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb7-117"><a href="#cb7-117"></a>    os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-118"><a href="#cb7-118"></a></span>
<span id="cb7-119"><a href="#cb7-119"></a>    <span class="co"># Define caminho do CSV</span></span>
<span id="cb7-120"><a href="#cb7-120"></a>    <span class="cf">if</span> <span class="st">&quot;--csv&quot;</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb7-121"><a href="#cb7-121"></a>        csv_path <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--csv&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb7-122"><a href="#cb7-122"></a>    <span class="cf">else</span>:</span>
<span id="cb7-123"><a href="#cb7-123"></a>        csv_path <span class="op">=</span> os.path.join(output_dir, <span class="st">&quot;criterias_results.csv&quot;</span>)</span>
<span id="cb7-124"><a href="#cb7-124"></a></span>
<span id="cb7-125"><a href="#cb7-125"></a>    filters <span class="op">=</span> {</span>
<span id="cb7-126"><a href="#cb7-126"></a>        <span class="st">&quot;--fork&quot;</span>: <span class="st">&quot;--fork&quot;</span> <span class="kw">in</span> sys.argv,</span>
<span id="cb7-127"><a href="#cb7-127"></a>        <span class="st">&quot;--iac-percentage&quot;</span>: <span class="st">&quot;--iac-percentage&quot;</span> <span class="kw">in</span> sys.argv,</span>
<span id="cb7-128"><a href="#cb7-128"></a>        <span class="st">&quot;--commits-per-month&quot;</span>: <span class="st">&quot;--commits-per-month&quot;</span> <span class="kw">in</span> sys.argv,</span>
<span id="cb7-129"><a href="#cb7-129"></a>        <span class="st">&quot;--num-contributors&quot;</span>: <span class="st">&quot;--num-contributors&quot;</span> <span class="kw">in</span> sys.argv</span>
<span id="cb7-130"><a href="#cb7-130"></a>    }</span>
<span id="cb7-131"><a href="#cb7-131"></a></span>
<span id="cb7-132"><a href="#cb7-132"></a>    repos <span class="op">=</span> os.listdir(dataset_dir)</span>
<span id="cb7-133"><a href="#cb7-133"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Iniciando anlise de </span><span class="sc">{</span><span class="bu">len</span>(repos)<span class="sc">}</span><span class="ss"> repositrios...&quot;</span>)</span>
<span id="cb7-134"><a href="#cb7-134"></a></span>
<span id="cb7-135"><a href="#cb7-135"></a>    results <span class="op">=</span> []</span>
<span id="cb7-136"><a href="#cb7-136"></a>    <span class="cf">with</span> ThreadPoolExecutor() <span class="im">as</span> executor:</span>
<span id="cb7-137"><a href="#cb7-137"></a>        futures <span class="op">=</span> [executor.submit(analyze_repo, repo, dataset_dir, input_dir, output_dir, filters) <span class="cf">for</span> repo <span class="kw">in</span> repos]</span>
<span id="cb7-138"><a href="#cb7-138"></a>        <span class="cf">for</span> i, future <span class="kw">in</span> <span class="bu">enumerate</span>(futures, <span class="dv">1</span>):</span>
<span id="cb7-139"><a href="#cb7-139"></a>            result <span class="op">=</span> future.result()</span>
<span id="cb7-140"><a href="#cb7-140"></a>            results.append(result)</span>
<span id="cb7-141"><a href="#cb7-141"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(repos)<span class="sc">}</span><span class="ss"> repositrios processados&quot;</span>)</span>
<span id="cb7-142"><a href="#cb7-142"></a></span>
<span id="cb7-143"><a href="#cb7-143"></a>    <span class="co"># Salva CSV</span></span>
<span id="cb7-144"><a href="#cb7-144"></a>    fieldnames <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb7-145"><a href="#cb7-145"></a>    new_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb7-146"><a href="#cb7-146"></a></span>
<span id="cb7-147"><a href="#cb7-147"></a>    <span class="cf">if</span> os.path.exists(csv_path):</span>
<span id="cb7-148"><a href="#cb7-148"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[INFO] CSV j existe, atualizando resultados: </span><span class="sc">{</span>csv_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-149"><a href="#cb7-149"></a>        </span>
<span id="cb7-150"><a href="#cb7-150"></a>        <span class="co"># Carrega CSV existente</span></span>
<span id="cb7-151"><a href="#cb7-151"></a>        existing_df <span class="op">=</span> pd.read_csv(csv_path)</span>
<span id="cb7-152"><a href="#cb7-152"></a>        <span class="co"># Junta com base na coluna &quot;repo&quot;, mantendo dados anteriores e atualizando os novos</span></span>
<span id="cb7-153"><a href="#cb7-153"></a>        existing_df[<span class="st">&quot;repo&quot;</span>] <span class="op">=</span> existing_df[<span class="st">&quot;repo&quot;</span>].astype(<span class="bu">str</span>)</span>
<span id="cb7-154"><a href="#cb7-154"></a>        new_df[<span class="st">&quot;repo&quot;</span>] <span class="op">=</span> new_df[<span class="st">&quot;repo&quot;</span>].astype(<span class="bu">str</span>)</span>
<span id="cb7-155"><a href="#cb7-155"></a>        merged_df <span class="op">=</span> pd.merge(existing_df, new_df, on<span class="op">=</span><span class="st">&quot;repo&quot;</span>, how<span class="op">=</span><span class="st">&quot;outer&quot;</span>, suffixes<span class="op">=</span>(<span class="st">&#39;&#39;</span>, <span class="st">&#39;_new&#39;</span>))</span>
<span id="cb7-156"><a href="#cb7-156"></a></span>
<span id="cb7-157"><a href="#cb7-157"></a>        <span class="co"># Atualiza os campos com os dados novos (colunas *_new), se existirem</span></span>
<span id="cb7-158"><a href="#cb7-158"></a>        <span class="cf">for</span> col <span class="kw">in</span> new_df.columns:</span>
<span id="cb7-159"><a href="#cb7-159"></a>            <span class="cf">if</span> col <span class="op">!=</span> <span class="st">&quot;repo&quot;</span>:</span>
<span id="cb7-160"><a href="#cb7-160"></a>                new_col <span class="op">=</span> col <span class="op">+</span> <span class="st">&quot;_new&quot;</span></span>
<span id="cb7-161"><a href="#cb7-161"></a>                <span class="cf">if</span> new_col <span class="kw">in</span> merged_df.columns:</span>
<span id="cb7-162"><a href="#cb7-162"></a>                    merged_df[col] <span class="op">=</span> merged_df[new_col].combine_first(merged_df[col])</span>
<span id="cb7-163"><a href="#cb7-163"></a>                    merged_df.drop(columns<span class="op">=</span>[new_col], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-164"><a href="#cb7-164"></a></span>
<span id="cb7-165"><a href="#cb7-165"></a>        <span class="co"># Salva de volta no CSV</span></span>
<span id="cb7-166"><a href="#cb7-166"></a>        merged_df.to_csv(csv_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-167"><a href="#cb7-167"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Resultados atualizados no CSV.&quot;</span>)</span>
<span id="cb7-168"><a href="#cb7-168"></a>    <span class="cf">else</span>:</span>
<span id="cb7-169"><a href="#cb7-169"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Criando novo CSV em: </span><span class="sc">{</span>csv_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-170"><a href="#cb7-170"></a>        new_df.to_csv(csv_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-171"><a href="#cb7-171"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span><span class="bu">len</span>(results)<span class="sc">}</span><span class="ss"> repositrios registrados no novo CSV.&quot;</span>)</span></code></pre></div>
<h3 id="criteria-frequency-code">Criteria Frequency Code</h3>
<div class="sourceCode" id="cb8"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="im">import</span> os</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="im">import</span> csv</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="im">from</span> concurrent.futures <span class="im">import</span> ThreadPoolExecutor</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="im">import</span> sys</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw">def</span> classify_technology_in_directory(repo_path):</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">    Classify the technology based on files in the repository directory.</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">    Priority: Pulumi &gt; Terraform &gt; AWS CDK</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(repo_path):</span>
<span id="cb8-13"><a href="#cb8-13"></a>        <span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb8-14"><a href="#cb8-14"></a>            <span class="cf">if</span> f.endswith(<span class="st">&quot;Pulumi.yaml&quot;</span>) <span class="kw">or</span> f.endswith(<span class="st">&quot;Pulumi.yml&quot;</span>):</span>
<span id="cb8-15"><a href="#cb8-15"></a>                <span class="cf">return</span> <span class="st">&quot;Pulumi&quot;</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>            <span class="cf">elif</span> f.endswith(<span class="st">&quot;cdktf.json&quot;</span>) <span class="kw">or</span> f.endswith(<span class="st">&quot;.tf&quot;</span>):</span>
<span id="cb8-17"><a href="#cb8-17"></a>                <span class="cf">return</span> <span class="st">&quot;Terraform&quot;</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>            <span class="cf">elif</span> f.endswith(<span class="st">&quot;cdk.json&quot;</span>):</span>
<span id="cb8-19"><a href="#cb8-19"></a>                <span class="cf">return</span> <span class="st">&quot;AWS CDK&quot;</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>            <span class="cf">elif</span> f.endswith(<span class="st">&quot;.edn&quot;</span>):</span>
<span id="cb8-21"><a href="#cb8-21"></a>                <span class="cf">return</span> <span class="st">&quot;NUBANK&quot;</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>    <span class="cf">return</span> <span class="st">&quot;NOTFOUND&quot;</span></span>
<span id="cb8-23"><a href="#cb8-23"></a></span>
<span id="cb8-24"><a href="#cb8-24"></a></span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="kw">def</span> process_criteria(criteria_dir, output_dir):</span>
<span id="cb8-26"><a href="#cb8-26"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-27"><a href="#cb8-27"></a><span class="co">    Process a single criteria directory to classify technologies.</span></span>
<span id="cb8-28"><a href="#cb8-28"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb8-29"><a href="#cb8-29"></a>    technology_counts <span class="op">=</span> {<span class="st">&quot;Pulumi&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;Terraform&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;AWS CDK&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;NUBANK&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;NOTFOUND&quot;</span>: <span class="dv">0</span>}</span>
<span id="cb8-30"><a href="#cb8-30"></a>    results <span class="op">=</span> []</span>
<span id="cb8-31"><a href="#cb8-31"></a></span>
<span id="cb8-32"><a href="#cb8-32"></a>    <span class="co"># Iterate over the subdirectories in the criteria directory</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>    <span class="cf">for</span> repo_id <span class="kw">in</span> os.listdir(criteria_dir):</span>
<span id="cb8-34"><a href="#cb8-34"></a>        repo_path <span class="op">=</span> os.path.join(criteria_dir, repo_id)</span>
<span id="cb8-35"><a href="#cb8-35"></a></span>
<span id="cb8-36"><a href="#cb8-36"></a>        <span class="co"># Only process if it&#39;s a directory</span></span>
<span id="cb8-37"><a href="#cb8-37"></a>        <span class="cf">if</span> os.path.isdir(repo_path):</span>
<span id="cb8-38"><a href="#cb8-38"></a>            tech_classification <span class="op">=</span> classify_technology_in_directory(repo_path)</span>
<span id="cb8-39"><a href="#cb8-39"></a>            technology_counts[tech_classification] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-40"><a href="#cb8-40"></a>            results.append([repo_id, tech_classification])</span>
<span id="cb8-41"><a href="#cb8-41"></a></span>
<span id="cb8-42"><a href="#cb8-42"></a>    <span class="co"># Write results to a CSV</span></span>
<span id="cb8-43"><a href="#cb8-43"></a>    output_csv <span class="op">=</span> os.path.join(output_dir, <span class="ss">f&quot;</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>basename(criteria_dir.rstrip(<span class="st">&#39;/&#39;</span>))<span class="sc">}</span><span class="ss">_output.csv&quot;</span>)</span>
<span id="cb8-44"><a href="#cb8-44"></a>    os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-45"><a href="#cb8-45"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_csv, <span class="st">&quot;w&quot;</span>, newline<span class="op">=</span><span class="st">&quot;&quot;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb8-46"><a href="#cb8-46"></a>        writer <span class="op">=</span> csv.writer(<span class="bu">file</span>)</span>
<span id="cb8-47"><a href="#cb8-47"></a>        writer.writerow([<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Technology&quot;</span>])</span>
<span id="cb8-48"><a href="#cb8-48"></a>        writer.writerows(results)</span>
<span id="cb8-49"><a href="#cb8-49"></a></span>
<span id="cb8-50"><a href="#cb8-50"></a>    <span class="co"># Print counts</span></span>
<span id="cb8-51"><a href="#cb8-51"></a>    string <span class="op">=</span> <span class="ss">f&quot;Counts for </span><span class="sc">{</span>criteria_dir<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb8-52"><a href="#cb8-52"></a>    <span class="cf">for</span> tech, count <span class="kw">in</span> technology_counts.items():</span>
<span id="cb8-53"><a href="#cb8-53"></a>        string <span class="op">+=</span> <span class="ss">f&quot;</span><span class="sc">{</span>tech<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb8-54"><a href="#cb8-54"></a>    <span class="bu">print</span>(string)</span>
<span id="cb8-55"><a href="#cb8-55"></a>    </span>
<span id="cb8-56"><a href="#cb8-56"></a>    <span class="cf">return</span> output_csv</span>
<span id="cb8-57"><a href="#cb8-57"></a></span>
<span id="cb8-58"><a href="#cb8-58"></a></span>
<span id="cb8-59"><a href="#cb8-59"></a><span class="kw">def</span> process_directories_in_parallel(criteria_dirs, output_dir):</span>
<span id="cb8-60"><a href="#cb8-60"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-61"><a href="#cb8-61"></a><span class="co">    Process all criteria directories in parallel.</span></span>
<span id="cb8-62"><a href="#cb8-62"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb8-63"><a href="#cb8-63"></a>    <span class="cf">with</span> ThreadPoolExecutor() <span class="im">as</span> executor:</span>
<span id="cb8-64"><a href="#cb8-64"></a>        futures <span class="op">=</span> [</span>
<span id="cb8-65"><a href="#cb8-65"></a>            executor.submit(process_criteria, criteria_dir, output_dir)</span>
<span id="cb8-66"><a href="#cb8-66"></a>            <span class="cf">for</span> criteria_dir <span class="kw">in</span> criteria_dirs</span>
<span id="cb8-67"><a href="#cb8-67"></a>        ]</span>
<span id="cb8-68"><a href="#cb8-68"></a>        <span class="cf">for</span> future <span class="kw">in</span> futures:</span>
<span id="cb8-69"><a href="#cb8-69"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Output CSV generated: </span><span class="sc">{</span>future<span class="sc">.</span>result()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-70"><a href="#cb8-70"></a></span>
<span id="cb8-71"><a href="#cb8-71"></a></span>
<span id="cb8-72"><a href="#cb8-72"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb8-73"><a href="#cb8-73"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="st">&#39;--input&#39;</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="kw">not</span> <span class="st">&#39;--output&#39;</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb8-74"><a href="#cb8-74"></a>        <span class="bu">print</span>(<span class="st">&quot;Usage: python3 criterias-frequency.py --input path1,path2,path3,path4 --output path&quot;</span>)</span>
<span id="cb8-75"><a href="#cb8-75"></a>        sys.exit(<span class="dv">1</span>)</span>
<span id="cb8-76"><a href="#cb8-76"></a></span>
<span id="cb8-77"><a href="#cb8-77"></a>    criteria_dirs <span class="op">=</span> [os.path.abspath(path) <span class="cf">for</span> path <span class="kw">in</span> sys.argv[sys.argv.index(<span class="st">&#39;--input&#39;</span>) <span class="op">+</span> <span class="dv">1</span>].split(<span class="st">&#39;,&#39;</span>)]</span>
<span id="cb8-78"><a href="#cb8-78"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Executing the frequency of the following paths: </span><span class="sc">{</span>criteria_dirs<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-79"><a href="#cb8-79"></a>    output_dir <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&#39;--output&#39;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb8-80"><a href="#cb8-80"></a></span>
<span id="cb8-81"><a href="#cb8-81"></a>    process_directories_in_parallel(criteria_dirs, output_dir)</span></code></pre></div>
<h3 id="related-files-finder-code">Related Files Finder Code</h3>
<div class="sourceCode" id="cb9"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">import</span> os</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="im">import</span> csv</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="im">import</span> json</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="im">from</span> concurrent.futures <span class="im">import</span> ThreadPoolExecutor</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="im">import</span> sys</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a>csv.field_size_limit(sys.maxsize)</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co"># Definio dos arquivos e extenses permitidas por tecnologia</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>IAC_FILES <span class="op">=</span> {</span>
<span id="cb9-11"><a href="#cb9-11"></a>    <span class="st">&quot;Pulumi&quot;</span>: {</span>
<span id="cb9-12"><a href="#cb9-12"></a>        <span class="st">&quot;patterns&quot;</span>: [<span class="st">&quot;Pulumi.yaml&quot;</span>, <span class="st">&quot;Pulumi.yml&quot;</span>],</span>
<span id="cb9-13"><a href="#cb9-13"></a>        <span class="st">&quot;extensions&quot;</span>: [<span class="st">&quot;.js&quot;</span>, <span class="st">&quot;.ts&quot;</span>, <span class="st">&quot;.py&quot;</span>, <span class="st">&quot;.go&quot;</span>, <span class="st">&quot;.cs&quot;</span>, <span class="st">&quot;.fs&quot;</span>, <span class="st">&quot;.vb&quot;</span>, <span class="st">&quot;.java&quot;</span>]</span>
<span id="cb9-14"><a href="#cb9-14"></a>    },</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="st">&quot;Terraform&quot;</span>: {</span>
<span id="cb9-16"><a href="#cb9-16"></a>        <span class="st">&quot;patterns&quot;</span>: [<span class="st">&quot;cdktf.json&quot;</span>, <span class="st">&quot;.tf&quot;</span>],</span>
<span id="cb9-17"><a href="#cb9-17"></a>        <span class="st">&quot;extensions&quot;</span>: [<span class="st">&quot;.ts&quot;</span>, <span class="st">&quot;.py&quot;</span>, <span class="st">&quot;.java&quot;</span>, <span class="st">&quot;.cs&quot;</span>, <span class="st">&quot;.go&quot;</span>]</span>
<span id="cb9-18"><a href="#cb9-18"></a>    },</span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="st">&quot;AWS CDK&quot;</span>: {</span>
<span id="cb9-20"><a href="#cb9-20"></a>        <span class="st">&quot;patterns&quot;</span>: [<span class="st">&quot;cdk.json&quot;</span>],</span>
<span id="cb9-21"><a href="#cb9-21"></a>        <span class="st">&quot;extensions&quot;</span>: [<span class="st">&quot;.cpp&quot;</span>, <span class="st">&quot;.go&quot;</span>, <span class="st">&quot;.java&quot;</span>, <span class="st">&quot;.js&quot;</span>, <span class="st">&quot;.kt&quot;</span>, <span class="st">&quot;.cs&quot;</span>, <span class="st">&quot;.ts&quot;</span>, <span class="st">&quot;.php&quot;</span>, <span class="st">&quot;.py&quot;</span>, <span class="st">&quot;.rb&quot;</span>, <span class="st">&quot;.rs&quot;</span>, <span class="st">&quot;.swift&quot;</span>, <span class="st">&quot;.abap&quot;</span>]</span>
<span id="cb9-22"><a href="#cb9-22"></a>    },</span>
<span id="cb9-23"><a href="#cb9-23"></a>    <span class="st">&quot;NUBANK&quot;</span>:   {</span>
<span id="cb9-24"><a href="#cb9-24"></a>        <span class="st">&quot;patterns&quot;</span>: [<span class="st">&quot;.edn&quot;</span>],</span>
<span id="cb9-25"><a href="#cb9-25"></a>        <span class="st">&quot;extensions&quot;</span>: [<span class="st">&quot;.edn&quot;</span>]</span>
<span id="cb9-26"><a href="#cb9-26"></a>    }</span>
<span id="cb9-27"><a href="#cb9-27"></a>}</span>
<span id="cb9-28"><a href="#cb9-28"></a></span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="kw">def</span> process_directory(parent_dir, subdir_name):</span>
<span id="cb9-30"><a href="#cb9-30"></a>    <span class="co">&quot;&quot;&quot;Processa um diretrio pai e identifica os arquivos IaC e vizinhos compatveis.&quot;&quot;&quot;</span></span>
<span id="cb9-31"><a href="#cb9-31"></a>    subdir_path <span class="op">=</span> os.path.join(parent_dir, subdir_name)</span>
<span id="cb9-32"><a href="#cb9-32"></a>    iac_data <span class="op">=</span> {</span>
<span id="cb9-33"><a href="#cb9-33"></a>        <span class="st">&quot;id&quot;</span>: subdir_name,</span>
<span id="cb9-34"><a href="#cb9-34"></a>        <span class="st">&quot;iac_type&quot;</span>: <span class="va">None</span>,</span>
<span id="cb9-35"><a href="#cb9-35"></a>        <span class="st">&quot;iac_paths&quot;</span>: [],</span>
<span id="cb9-36"><a href="#cb9-36"></a>        <span class="st">&quot;related_files&quot;</span>: []</span>
<span id="cb9-37"><a href="#cb9-37"></a>    }</span>
<span id="cb9-38"><a href="#cb9-38"></a></span>
<span id="cb9-39"><a href="#cb9-39"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DEBUG] Processando diretrio: </span><span class="sc">{</span>subdir_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-40"><a href="#cb9-40"></a></span>
<span id="cb9-41"><a href="#cb9-41"></a>    <span class="co"># Percorre arquivos no diretrio pai</span></span>
<span id="cb9-42"><a href="#cb9-42"></a>    <span class="cf">for</span> dirpath, _, filenames <span class="kw">in</span> os.walk(subdir_path):</span>
<span id="cb9-43"><a href="#cb9-43"></a>        <span class="cf">for</span> iac_type, details <span class="kw">in</span> IAC_FILES.items():</span>
<span id="cb9-44"><a href="#cb9-44"></a>            found_iac_files <span class="op">=</span> [</span>
<span id="cb9-45"><a href="#cb9-45"></a>                f <span class="cf">for</span> f <span class="kw">in</span> filenames</span>
<span id="cb9-46"><a href="#cb9-46"></a>                <span class="cf">if</span> <span class="bu">any</span>(f <span class="op">==</span> pattern <span class="kw">or</span> f.endswith(pattern) <span class="cf">for</span> pattern <span class="kw">in</span> details[<span class="st">&quot;patterns&quot;</span>])</span>
<span id="cb9-47"><a href="#cb9-47"></a>            ]</span>
<span id="cb9-48"><a href="#cb9-48"></a>            <span class="cf">if</span> found_iac_files:</span>
<span id="cb9-49"><a href="#cb9-49"></a>                <span class="co"># Define o tipo de IaC identificado e adiciona seus arquivos</span></span>
<span id="cb9-50"><a href="#cb9-50"></a>                iac_data[<span class="st">&quot;iac_type&quot;</span>] <span class="op">=</span> iac_type</span>
<span id="cb9-51"><a href="#cb9-51"></a>                iac_data[<span class="st">&quot;iac_paths&quot;</span>].extend(</span>
<span id="cb9-52"><a href="#cb9-52"></a>                    [os.path.join(dirpath, f) <span class="cf">for</span> f <span class="kw">in</span> found_iac_files]</span>
<span id="cb9-53"><a href="#cb9-53"></a>                )</span>
<span id="cb9-54"><a href="#cb9-54"></a></span>
<span id="cb9-55"><a href="#cb9-55"></a>                <span class="co"># Captura arquivos vizinhos compatveis apenas com a tecnologia correspondente</span></span>
<span id="cb9-56"><a href="#cb9-56"></a>                allowed_extensions <span class="op">=</span> details[<span class="st">&quot;extensions&quot;</span>]</span>
<span id="cb9-57"><a href="#cb9-57"></a>                neighbor_files <span class="op">=</span> [</span>
<span id="cb9-58"><a href="#cb9-58"></a>                    os.path.join(dirpath, f)</span>
<span id="cb9-59"><a href="#cb9-59"></a>                    <span class="cf">for</span> f <span class="kw">in</span> filenames</span>
<span id="cb9-60"><a href="#cb9-60"></a>                    <span class="cf">if</span> os.path.splitext(f)[<span class="dv">1</span>] <span class="kw">in</span> allowed_extensions</span>
<span id="cb9-61"><a href="#cb9-61"></a>                ]</span>
<span id="cb9-62"><a href="#cb9-62"></a>                iac_data[<span class="st">&quot;related_files&quot;</span>].extend(neighbor_files)</span>
<span id="cb9-63"><a href="#cb9-63"></a></span>
<span id="cb9-64"><a href="#cb9-64"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DEBUG] Resultados para ID &#39;</span><span class="sc">{</span>subdir_name<span class="sc">}</span><span class="ss">&#39;: </span><span class="sc">{</span>iac_data<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-65"><a href="#cb9-65"></a>    <span class="cf">return</span> iac_data</span>
<span id="cb9-66"><a href="#cb9-66"></a></span>
<span id="cb9-67"><a href="#cb9-67"></a><span class="kw">def</span> find_iac_files_with_neighbors_parallel(root_dir, MAX_THREADS<span class="op">=</span><span class="dv">8</span>):</span>
<span id="cb9-68"><a href="#cb9-68"></a>    <span class="co">&quot;&quot;&quot;Procura arquivos IaC e seus vizinhos usando paralelizao.&quot;&quot;&quot;</span></span>
<span id="cb9-69"><a href="#cb9-69"></a>    iac_results <span class="op">=</span> []</span>
<span id="cb9-70"><a href="#cb9-70"></a>    parent_dirs <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> os.listdir(root_dir) <span class="cf">if</span> os.path.isdir(os.path.join(root_dir, d))]</span>
<span id="cb9-71"><a href="#cb9-71"></a></span>
<span id="cb9-72"><a href="#cb9-72"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DEBUG] Diretrios identificados: </span><span class="sc">{</span>parent_dirs<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-73"><a href="#cb9-73"></a></span>
<span id="cb9-74"><a href="#cb9-74"></a>    <span class="cf">with</span> ThreadPoolExecutor(max_workers<span class="op">=</span>MAX_THREADS) <span class="im">as</span> executor:</span>
<span id="cb9-75"><a href="#cb9-75"></a>        tasks <span class="op">=</span> [executor.submit(process_directory, root_dir, subdir) <span class="cf">for</span> subdir <span class="kw">in</span> parent_dirs]</span>
<span id="cb9-76"><a href="#cb9-76"></a></span>
<span id="cb9-77"><a href="#cb9-77"></a>        <span class="cf">for</span> future <span class="kw">in</span> tasks:</span>
<span id="cb9-78"><a href="#cb9-78"></a>            iac_results.append(future.result())</span>
<span id="cb9-79"><a href="#cb9-79"></a></span>
<span id="cb9-80"><a href="#cb9-80"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DEBUG] Total de diretrios processados: </span><span class="sc">{</span><span class="bu">len</span>(iac_results)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-81"><a href="#cb9-81"></a>    <span class="cf">return</span> iac_results</span>
<span id="cb9-82"><a href="#cb9-82"></a></span>
<span id="cb9-83"><a href="#cb9-83"></a><span class="kw">def</span> save_to_csv(data, output_file):</span>
<span id="cb9-84"><a href="#cb9-84"></a>    <span class="co">&quot;&quot;&quot;Salva os resultados em um arquivo CSV.&quot;&quot;&quot;</span></span>
<span id="cb9-85"><a href="#cb9-85"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DEBUG] Salvando resultados no arquivo: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-86"><a href="#cb9-86"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, mode<span class="op">=</span><span class="st">&quot;w&quot;</span>, newline<span class="op">=</span><span class="st">&quot;&quot;</span>, encoding<span class="op">=</span><span class="st">&quot;utf-8&quot;</span>) <span class="im">as</span> csvfile:</span>
<span id="cb9-87"><a href="#cb9-87"></a>        writer <span class="op">=</span> csv.DictWriter(csvfile, fieldnames<span class="op">=</span>[<span class="st">&quot;id&quot;</span>, <span class="st">&quot;iac_type&quot;</span>, <span class="st">&quot;iac_paths&quot;</span>, <span class="st">&quot;related_files&quot;</span>])</span>
<span id="cb9-88"><a href="#cb9-88"></a>        writer.writeheader()</span>
<span id="cb9-89"><a href="#cb9-89"></a>        <span class="cf">for</span> entry <span class="kw">in</span> data:</span>
<span id="cb9-90"><a href="#cb9-90"></a>            writer.writerow({</span>
<span id="cb9-91"><a href="#cb9-91"></a>                <span class="st">&quot;id&quot;</span>: entry[<span class="st">&quot;id&quot;</span>],</span>
<span id="cb9-92"><a href="#cb9-92"></a>                <span class="st">&quot;iac_type&quot;</span>: entry[<span class="st">&quot;iac_type&quot;</span>] <span class="cf">if</span> entry[<span class="st">&quot;iac_type&quot;</span>] <span class="cf">else</span> <span class="st">&quot;None&quot;</span>,</span>
<span id="cb9-93"><a href="#cb9-93"></a>                <span class="st">&quot;iac_paths&quot;</span>: json.dumps(entry[<span class="st">&quot;iac_paths&quot;</span>]),</span>
<span id="cb9-94"><a href="#cb9-94"></a>                <span class="st">&quot;related_files&quot;</span>: json.dumps(entry[<span class="st">&quot;related_files&quot;</span>])</span>
<span id="cb9-95"><a href="#cb9-95"></a>            })</span>
<span id="cb9-96"><a href="#cb9-96"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DEBUG] Resultados salvos com sucesso em </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-97"><a href="#cb9-97"></a></span>
<span id="cb9-98"><a href="#cb9-98"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb9-99"><a href="#cb9-99"></a>    <span class="cf">if</span> <span class="st">&quot;--input&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="st">&quot;--output&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb9-100"><a href="#cb9-100"></a>        <span class="bu">print</span>(<span class="st">&quot;Usage: python3 1-related-files-generator.py --input path --output path -t number_threads&quot;</span>)</span>
<span id="cb9-101"><a href="#cb9-101"></a>        sys.exit(<span class="dv">1</span>)</span>
<span id="cb9-102"><a href="#cb9-102"></a>    </span>
<span id="cb9-103"><a href="#cb9-103"></a>    root_dir <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--input&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb9-104"><a href="#cb9-104"></a>    output <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--output&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb9-105"><a href="#cb9-105"></a></span>
<span id="cb9-106"><a href="#cb9-106"></a>    <span class="cf">if</span> <span class="st">&quot;-t&quot;</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb9-107"><a href="#cb9-107"></a>        n_threads <span class="op">=</span> <span class="bu">int</span>(sys.argv[sys.argv.index(<span class="st">&quot;-t&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb9-108"><a href="#cb9-108"></a>        iac_data <span class="op">=</span> find_iac_files_with_neighbors_parallel(root_dir, n_threads)</span>
<span id="cb9-109"><a href="#cb9-109"></a>    <span class="cf">else</span>:</span>
<span id="cb9-110"><a href="#cb9-110"></a>        iac_data <span class="op">=</span> find_iac_files_with_neighbors_parallel(root_dir)</span>
<span id="cb9-111"><a href="#cb9-111"></a>    </span>
<span id="cb9-112"><a href="#cb9-112"></a>    save_to_csv(iac_data, output)</span></code></pre></div>
<h3 id="commits-counter-code">Commits Counter Code</h3>
<div class="sourceCode" id="cb10"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="im">import</span> os</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="im">import</span> subprocess</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="im">import</span> csv</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="im">import</span> sys</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="im">from</span> concurrent.futures <span class="im">import</span> ThreadPoolExecutor, as_completed</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>csv.field_size_limit(sys.maxsize)</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="kw">def</span> is_git_repo(path):</span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="cf">return</span> os.path.exists(os.path.join(path, <span class="st">&quot;.git&quot;</span>))</span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="kw">def</span> count_commits_for_files(repo_path, file_paths):</span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">    Conta o nmero de commits relacionados a uma lista de arquivos em um repositrio Git.</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    unique_commits <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb10-17"><a href="#cb10-17"></a>    <span class="cf">for</span> file_path <span class="kw">in</span> file_paths:</span>
<span id="cb10-18"><a href="#cb10-18"></a>        relative_path <span class="op">=</span> os.path.relpath(file_path, repo_path)</span>
<span id="cb10-19"><a href="#cb10-19"></a>        cmd <span class="op">=</span> [<span class="st">&quot;git&quot;</span>, <span class="st">&quot;-C&quot;</span>, repo_path, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;--pretty=%H&quot;</span>, <span class="st">&quot;--&quot;</span>, relative_path]</span>
<span id="cb10-20"><a href="#cb10-20"></a>        <span class="cf">try</span>:</span>
<span id="cb10-21"><a href="#cb10-21"></a>            result <span class="op">=</span> subprocess.run(cmd, capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-22"><a href="#cb10-22"></a>            commits <span class="op">=</span> result.stdout.strip().split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-23"><a href="#cb10-23"></a>            unique_commits.update(commits)</span>
<span id="cb10-24"><a href="#cb10-24"></a>        <span class="cf">except</span> subprocess.CalledProcessError:</span>
<span id="cb10-25"><a href="#cb10-25"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] Falha ao executar git log para arquivo </span><span class="sc">{</span>relative_path<span class="sc">}</span><span class="ss"> em </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-26"><a href="#cb10-26"></a>            <span class="cf">continue</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>    <span class="cf">return</span> <span class="bu">len</span>(unique_commits)</span>
<span id="cb10-28"><a href="#cb10-28"></a></span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="kw">def</span> count_total_commits(repo_path):</span>
<span id="cb10-30"><a href="#cb10-30"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-31"><a href="#cb10-31"></a><span class="co">    Conta o total de commits do repositrio.</span></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb10-33"><a href="#cb10-33"></a>    cmd <span class="op">=</span> [<span class="st">&quot;git&quot;</span>, <span class="st">&quot;-C&quot;</span>, repo_path, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;--pretty=%H&quot;</span>]</span>
<span id="cb10-34"><a href="#cb10-34"></a>    <span class="cf">try</span>:</span>
<span id="cb10-35"><a href="#cb10-35"></a>        result <span class="op">=</span> subprocess.run(cmd, capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-36"><a href="#cb10-36"></a>        <span class="cf">return</span> <span class="bu">len</span>(result.stdout.strip().split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</span>
<span id="cb10-37"><a href="#cb10-37"></a>    <span class="cf">except</span> subprocess.CalledProcessError:</span>
<span id="cb10-38"><a href="#cb10-38"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] Falha ao executar git log no repositrio </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-39"><a href="#cb10-39"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb10-40"><a href="#cb10-40"></a></span>
<span id="cb10-41"><a href="#cb10-41"></a><span class="kw">def</span> process_repository_row(row, dataset_dir):</span>
<span id="cb10-42"><a href="#cb10-42"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-43"><a href="#cb10-43"></a><span class="co">    Processa uma linha do CSV (um repositrio) e retorna a linha com os campos de commits preenchidos.</span></span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb10-45"><a href="#cb10-45"></a>    repo_id <span class="op">=</span> row[<span class="st">&quot;id&quot;</span>]</span>
<span id="cb10-46"><a href="#cb10-46"></a>    <span class="cf">try</span>:</span>
<span id="cb10-47"><a href="#cb10-47"></a>        iac_paths <span class="op">=</span> <span class="bu">eval</span>(row[<span class="st">&quot;iac_paths&quot;</span>])</span>
<span id="cb10-48"><a href="#cb10-48"></a>        related_files <span class="op">=</span> <span class="bu">eval</span>(row[<span class="st">&quot;related_files&quot;</span>])</span>
<span id="cb10-49"><a href="#cb10-49"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-50"><a href="#cb10-50"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] Erro ao processar paths do repositrio </span><span class="sc">{</span>repo_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-51"><a href="#cb10-51"></a>        row[<span class="st">&quot;commit_count&quot;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-52"><a href="#cb10-52"></a>        row[<span class="st">&quot;total_commit_count&quot;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-53"><a href="#cb10-53"></a>        <span class="cf">return</span> row</span>
<span id="cb10-54"><a href="#cb10-54"></a></span>
<span id="cb10-55"><a href="#cb10-55"></a>    iac_paths <span class="op">=</span> [path <span class="cf">for</span> path <span class="kw">in</span> iac_paths <span class="cf">if</span> path]</span>
<span id="cb10-56"><a href="#cb10-56"></a>    related_files <span class="op">=</span> [path <span class="cf">for</span> path <span class="kw">in</span> related_files <span class="cf">if</span> path]</span>
<span id="cb10-57"><a href="#cb10-57"></a></span>
<span id="cb10-58"><a href="#cb10-58"></a>    <span class="cf">if</span> <span class="kw">not</span> iac_paths <span class="kw">and</span> <span class="kw">not</span> related_files:</span>
<span id="cb10-59"><a href="#cb10-59"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Ignorando repositrio </span><span class="sc">{</span>repo_id<span class="sc">}</span><span class="ss"> porque no h arquivos vlidos.&quot;</span>)</span>
<span id="cb10-60"><a href="#cb10-60"></a>        row[<span class="st">&quot;commit_count&quot;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-61"><a href="#cb10-61"></a>        row[<span class="st">&quot;total_commit_count&quot;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-62"><a href="#cb10-62"></a>        <span class="cf">return</span> row</span>
<span id="cb10-63"><a href="#cb10-63"></a></span>
<span id="cb10-64"><a href="#cb10-64"></a>    repo_path <span class="op">=</span> os.path.join(dataset_dir, repo_id)</span>
<span id="cb10-65"><a href="#cb10-65"></a></span>
<span id="cb10-66"><a href="#cb10-66"></a>    <span class="cf">if</span> <span class="kw">not</span> is_git_repo(repo_path):</span>
<span id="cb10-67"><a href="#cb10-67"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[WARNING] Diretrio &#39;</span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">&#39; no  um repositrio Git.&quot;</span>)</span>
<span id="cb10-68"><a href="#cb10-68"></a>        row[<span class="st">&quot;commit_count&quot;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-69"><a href="#cb10-69"></a>        row[<span class="st">&quot;total_commit_count&quot;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-70"><a href="#cb10-70"></a>        <span class="cf">return</span> row</span>
<span id="cb10-71"><a href="#cb10-71"></a></span>
<span id="cb10-72"><a href="#cb10-72"></a>    file_paths <span class="op">=</span> iac_paths <span class="op">+</span> related_files</span>
<span id="cb10-73"><a href="#cb10-73"></a>    commit_count <span class="op">=</span> count_commits_for_files(repo_path, file_paths)</span>
<span id="cb10-74"><a href="#cb10-74"></a>    total_commits <span class="op">=</span> count_total_commits(repo_path)</span>
<span id="cb10-75"><a href="#cb10-75"></a></span>
<span id="cb10-76"><a href="#cb10-76"></a>    row[<span class="st">&quot;commit_count&quot;</span>] <span class="op">=</span> commit_count</span>
<span id="cb10-77"><a href="#cb10-77"></a>    row[<span class="st">&quot;total_commit_count&quot;</span>] <span class="op">=</span> total_commits <span class="cf">if</span> total_commits <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-78"><a href="#cb10-78"></a>    <span class="cf">return</span> row</span>
<span id="cb10-79"><a href="#cb10-79"></a></span>
<span id="cb10-80"><a href="#cb10-80"></a><span class="kw">def</span> process_repositories_and_commits(input_csv, output_csv, dataset_dir):</span>
<span id="cb10-81"><a href="#cb10-81"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-82"><a href="#cb10-82"></a><span class="co">    Processa o CSV de entrada de forma concorrente, contando commits relacionados aos arquivos IaC</span></span>
<span id="cb10-83"><a href="#cb10-83"></a><span class="co">    e salvando o resultado em um CSV de sada.</span></span>
<span id="cb10-84"><a href="#cb10-84"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb10-85"><a href="#cb10-85"></a>    <span class="cf">with</span> <span class="bu">open</span>(input_csv, mode<span class="op">=</span><span class="st">&quot;r&quot;</span>) <span class="im">as</span> infile, <span class="bu">open</span>(output_csv, mode<span class="op">=</span><span class="st">&quot;w&quot;</span>, newline<span class="op">=</span><span class="st">&quot;&quot;</span>) <span class="im">as</span> outfile:</span>
<span id="cb10-86"><a href="#cb10-86"></a>        reader <span class="op">=</span> csv.DictReader(infile)</span>
<span id="cb10-87"><a href="#cb10-87"></a>        fieldnames <span class="op">=</span> reader.fieldnames <span class="op">+</span> [<span class="st">&quot;commit_count&quot;</span>, <span class="st">&quot;total_commit_count&quot;</span>]</span>
<span id="cb10-88"><a href="#cb10-88"></a>        writer <span class="op">=</span> csv.DictWriter(outfile, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb10-89"><a href="#cb10-89"></a>        writer.writeheader()</span>
<span id="cb10-90"><a href="#cb10-90"></a></span>
<span id="cb10-91"><a href="#cb10-91"></a>        rows <span class="op">=</span> <span class="bu">list</span>(reader)</span>
<span id="cb10-92"><a href="#cb10-92"></a></span>
<span id="cb10-93"><a href="#cb10-93"></a>        <span class="cf">with</span> ThreadPoolExecutor(max_workers<span class="op">=</span><span class="dv">8</span>) <span class="im">as</span> executor:</span>
<span id="cb10-94"><a href="#cb10-94"></a>            futures <span class="op">=</span> {executor.submit(process_repository_row, row, dataset_dir): row <span class="cf">for</span> row <span class="kw">in</span> rows}</span>
<span id="cb10-95"><a href="#cb10-95"></a></span>
<span id="cb10-96"><a href="#cb10-96"></a>            <span class="cf">for</span> future <span class="kw">in</span> as_completed(futures):</span>
<span id="cb10-97"><a href="#cb10-97"></a>                result_row <span class="op">=</span> future.result()</span>
<span id="cb10-98"><a href="#cb10-98"></a>                writer.writerow(result_row)</span>
<span id="cb10-99"><a href="#cb10-99"></a></span>
<span id="cb10-100"><a href="#cb10-100"></a><span class="co"># Entry point</span></span>
<span id="cb10-101"><a href="#cb10-101"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb10-102"><a href="#cb10-102"></a>    <span class="cf">if</span> <span class="st">&quot;--input&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="st">&quot;--output&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="st">&quot;--dataset-dir&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb10-103"><a href="#cb10-103"></a>        <span class="bu">print</span>(<span class="st">&quot;Usage: python3 2-commits-count.py --input path --output path --dataset-dir path&quot;</span>)</span>
<span id="cb10-104"><a href="#cb10-104"></a>        sys.exit(<span class="dv">1</span>)</span>
<span id="cb10-105"><a href="#cb10-105"></a></span>
<span id="cb10-106"><a href="#cb10-106"></a>    input_path <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--input&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb10-107"><a href="#cb10-107"></a>    output <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--output&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb10-108"><a href="#cb10-108"></a>    dataset_dir <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--dataset-dir&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb10-109"><a href="#cb10-109"></a>    process_repositories_and_commits(input_path, output, dataset_dir)</span></code></pre></div>
<h3 id="time-period-code">Time Period Code</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> os</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="im">import</span> subprocess</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="im">import</span> csv</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="im">import</span> sys</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="im">from</span> concurrent.futures <span class="im">import</span> ThreadPoolExecutor, as_completed</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>csv.field_size_limit(sys.maxsize)</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="kw">def</span> get_commit_time_period(repo_path, file_paths):</span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(os.path.join(repo_path, <span class="st">&quot;.git&quot;</span>)):</span>
<span id="cb11-12"><a href="#cb11-12"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[WARNING] Diretrio &#39;</span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">&#39; no  um repositrio Git. Ignorando.&quot;</span>)</span>
<span id="cb11-13"><a href="#cb11-13"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a>    commit_dates <span class="op">=</span> []</span>
<span id="cb11-16"><a href="#cb11-16"></a>    <span class="cf">for</span> file_path <span class="kw">in</span> file_paths:</span>
<span id="cb11-17"><a href="#cb11-17"></a>        relative_path <span class="op">=</span> os.path.relpath(file_path, repo_path)</span>
<span id="cb11-18"><a href="#cb11-18"></a>        cmd <span class="op">=</span> [<span class="st">&quot;git&quot;</span>, <span class="st">&quot;-C&quot;</span>, repo_path, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;--pretty=</span><span class="sc">%c</span><span class="st">i&quot;</span>, <span class="st">&quot;--&quot;</span>, relative_path]</span>
<span id="cb11-19"><a href="#cb11-19"></a>        <span class="cf">try</span>:</span>
<span id="cb11-20"><a href="#cb11-20"></a>            result <span class="op">=</span> subprocess.run(cmd, capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-21"><a href="#cb11-21"></a>            dates <span class="op">=</span> result.stdout.strip().split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-22"><a href="#cb11-22"></a>            commit_dates.extend(dates)</span>
<span id="cb11-23"><a href="#cb11-23"></a>        <span class="cf">except</span> subprocess.CalledProcessError <span class="im">as</span> e:</span>
<span id="cb11-24"><a href="#cb11-24"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] git log falhou para &#39;</span><span class="sc">{</span>relative_path<span class="sc">}</span><span class="ss">&#39; em &#39;</span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">&#39;: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb11-25"><a href="#cb11-25"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb11-26"><a href="#cb11-26"></a></span>
<span id="cb11-27"><a href="#cb11-27"></a>    valid_dates <span class="op">=</span> []</span>
<span id="cb11-28"><a href="#cb11-28"></a>    <span class="cf">for</span> date <span class="kw">in</span> commit_dates:</span>
<span id="cb11-29"><a href="#cb11-29"></a>        <span class="cf">try</span>:</span>
<span id="cb11-30"><a href="#cb11-30"></a>            valid_dates.append(datetime.strptime(date, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S %z&quot;</span>))</span>
<span id="cb11-31"><a href="#cb11-31"></a>        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb11-32"><a href="#cb11-32"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[WARNING] Data invlida &#39;</span><span class="sc">{</span>date<span class="sc">}</span><span class="ss">&#39; em </span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb11-33"><a href="#cb11-33"></a>            <span class="cf">continue</span></span>
<span id="cb11-34"><a href="#cb11-34"></a></span>
<span id="cb11-35"><a href="#cb11-35"></a>    <span class="cf">if</span> <span class="kw">not</span> valid_dates:</span>
<span id="cb11-36"><a href="#cb11-36"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[WARNING] Nenhuma data vlida em &#39;</span><span class="sc">{</span>repo_path<span class="sc">}</span><span class="ss">&#39;.&quot;</span>)</span>
<span id="cb11-37"><a href="#cb11-37"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb11-38"><a href="#cb11-38"></a></span>
<span id="cb11-39"><a href="#cb11-39"></a>    <span class="cf">return</span> <span class="bu">min</span>(valid_dates), <span class="bu">max</span>(valid_dates)</span>
<span id="cb11-40"><a href="#cb11-40"></a></span>
<span id="cb11-41"><a href="#cb11-41"></a></span>
<span id="cb11-42"><a href="#cb11-42"></a><span class="kw">def</span> process_row(row, dataset_dir):</span>
<span id="cb11-43"><a href="#cb11-43"></a>    repo_id <span class="op">=</span> row[<span class="st">&quot;id&quot;</span>]</span>
<span id="cb11-44"><a href="#cb11-44"></a>    iac_paths <span class="op">=</span> <span class="bu">eval</span>(row[<span class="st">&quot;iac_paths&quot;</span>])</span>
<span id="cb11-45"><a href="#cb11-45"></a>    repo_path <span class="op">=</span> os.path.join(dataset_dir, repo_id)</span>
<span id="cb11-46"><a href="#cb11-46"></a></span>
<span id="cb11-47"><a href="#cb11-47"></a>    <span class="cf">try</span>:</span>
<span id="cb11-48"><a href="#cb11-48"></a>        oldest_commit, newest_commit <span class="op">=</span> get_commit_time_period(repo_path, iac_paths)</span>
<span id="cb11-49"><a href="#cb11-49"></a></span>
<span id="cb11-50"><a href="#cb11-50"></a>        <span class="cf">if</span> oldest_commit <span class="kw">and</span> newest_commit:</span>
<span id="cb11-51"><a href="#cb11-51"></a>            commit_time_period <span class="op">=</span> (newest_commit <span class="op">-</span> oldest_commit).days</span>
<span id="cb11-52"><a href="#cb11-52"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>repo_id<span class="sc">}</span><span class="ss">: Perodo de commits = </span><span class="sc">{</span>commit_time_period<span class="sc">}</span><span class="ss"> dias&quot;</span>)</span>
<span id="cb11-53"><a href="#cb11-53"></a>        <span class="cf">else</span>:</span>
<span id="cb11-54"><a href="#cb11-54"></a>            commit_time_period <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-55"><a href="#cb11-55"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[INFO] </span><span class="sc">{</span>repo_id<span class="sc">}</span><span class="ss">: Sem dados de commit vlidos.&quot;</span>)</span>
<span id="cb11-56"><a href="#cb11-56"></a></span>
<span id="cb11-57"><a href="#cb11-57"></a>        row[<span class="st">&quot;oldest_commit&quot;</span>] <span class="op">=</span> oldest_commit.strftime(<span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S %z&quot;</span>) <span class="cf">if</span> oldest_commit <span class="cf">else</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb11-58"><a href="#cb11-58"></a>        row[<span class="st">&quot;newest_commit&quot;</span>] <span class="op">=</span> newest_commit.strftime(<span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S %z&quot;</span>) <span class="cf">if</span> newest_commit <span class="cf">else</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb11-59"><a href="#cb11-59"></a>        row[<span class="st">&quot;commit_time_period&quot;</span>] <span class="op">=</span> commit_time_period</span>
<span id="cb11-60"><a href="#cb11-60"></a></span>
<span id="cb11-61"><a href="#cb11-61"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb11-62"><a href="#cb11-62"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] Erro ao processar &#39;</span><span class="sc">{</span>repo_id<span class="sc">}</span><span class="ss">&#39;: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb11-63"><a href="#cb11-63"></a>        row[<span class="st">&quot;oldest_commit&quot;</span>] <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb11-64"><a href="#cb11-64"></a>        row[<span class="st">&quot;newest_commit&quot;</span>] <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb11-65"><a href="#cb11-65"></a>        row[<span class="st">&quot;commit_time_period&quot;</span>] <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb11-66"><a href="#cb11-66"></a></span>
<span id="cb11-67"><a href="#cb11-67"></a>    <span class="cf">return</span> row</span>
<span id="cb11-68"><a href="#cb11-68"></a></span>
<span id="cb11-69"><a href="#cb11-69"></a></span>
<span id="cb11-70"><a href="#cb11-70"></a><span class="kw">def</span> process_time_period(input_csv, output_csv, dataset_dir):</span>
<span id="cb11-71"><a href="#cb11-71"></a>    <span class="cf">with</span> <span class="bu">open</span>(input_csv, mode<span class="op">=</span><span class="st">&quot;r&quot;</span>) <span class="im">as</span> infile:</span>
<span id="cb11-72"><a href="#cb11-72"></a>        reader <span class="op">=</span> csv.DictReader(infile)</span>
<span id="cb11-73"><a href="#cb11-73"></a>        fieldnames <span class="op">=</span> reader.fieldnames <span class="op">+</span> [<span class="st">&quot;oldest_commit&quot;</span>, <span class="st">&quot;newest_commit&quot;</span>, <span class="st">&quot;commit_time_period&quot;</span>]</span>
<span id="cb11-74"><a href="#cb11-74"></a>        rows <span class="op">=</span> <span class="bu">list</span>(reader)</span>
<span id="cb11-75"><a href="#cb11-75"></a></span>
<span id="cb11-76"><a href="#cb11-76"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Iniciando processamento de </span><span class="sc">{</span><span class="bu">len</span>(rows)<span class="sc">}</span><span class="ss"> repositrios...&quot;</span>)</span>
<span id="cb11-77"><a href="#cb11-77"></a></span>
<span id="cb11-78"><a href="#cb11-78"></a>    results <span class="op">=</span> []</span>
<span id="cb11-79"><a href="#cb11-79"></a>    <span class="cf">with</span> ThreadPoolExecutor() <span class="im">as</span> executor:</span>
<span id="cb11-80"><a href="#cb11-80"></a>        future_to_row <span class="op">=</span> {executor.submit(process_row, row, dataset_dir): row <span class="cf">for</span> row <span class="kw">in</span> rows}</span>
<span id="cb11-81"><a href="#cb11-81"></a>        <span class="cf">for</span> i, future <span class="kw">in</span> <span class="bu">enumerate</span>(as_completed(future_to_row), <span class="dv">1</span>):</span>
<span id="cb11-82"><a href="#cb11-82"></a>            result <span class="op">=</span> future.result()</span>
<span id="cb11-83"><a href="#cb11-83"></a>            results.append(result)</span>
<span id="cb11-84"><a href="#cb11-84"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Processados </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(rows)<span class="sc">}</span><span class="ss"> repositrios&quot;</span>)</span>
<span id="cb11-85"><a href="#cb11-85"></a></span>
<span id="cb11-86"><a href="#cb11-86"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_csv, mode<span class="op">=</span><span class="st">&quot;w&quot;</span>, newline<span class="op">=</span><span class="st">&quot;&quot;</span>) <span class="im">as</span> outfile:</span>
<span id="cb11-87"><a href="#cb11-87"></a>        writer <span class="op">=</span> csv.DictWriter(outfile, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb11-88"><a href="#cb11-88"></a>        writer.writeheader()</span>
<span id="cb11-89"><a href="#cb11-89"></a>        writer.writerows(results)</span>
<span id="cb11-90"><a href="#cb11-90"></a></span>
<span id="cb11-91"><a href="#cb11-91"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DONE] Todos os repositrios foram processados com sucesso.&quot;</span>)</span>
<span id="cb11-92"><a href="#cb11-92"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[DONE] Resultados salvos em: </span><span class="sc">{</span>output_csv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb11-93"><a href="#cb11-93"></a></span>
<span id="cb11-94"><a href="#cb11-94"></a></span>
<span id="cb11-95"><a href="#cb11-95"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb11-96"><a href="#cb11-96"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="st">&quot;--input&quot;</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="kw">not</span> <span class="st">&quot;--output&quot;</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="kw">not</span> <span class="st">&quot;--dataset-dir&quot;</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb11-97"><a href="#cb11-97"></a>        <span class="bu">print</span>(<span class="st">&quot;Usage: python3 3-time-period.py --input path --output path --dataset-dir path&quot;</span>)</span>
<span id="cb11-98"><a href="#cb11-98"></a>        sys.exit(<span class="dv">1</span>)</span>
<span id="cb11-99"><a href="#cb11-99"></a>    </span>
<span id="cb11-100"><a href="#cb11-100"></a>    input_path <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--input&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb11-101"><a href="#cb11-101"></a>    output <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--output&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb11-102"><a href="#cb11-102"></a>    dataset_dir <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--dataset-dir&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb11-103"><a href="#cb11-103"></a>    process_time_period(input_path, output, dataset_dir)</span></code></pre></div>
<h3 id="analyzer-code">Analyzer Code</h3>
<div class="sourceCode" id="cb12"><pre
class="sourceCode numberSource py numberLines"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="im">import</span> csv</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="im">import</span> os</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="im">import</span> sys</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="im">import</span> traceback</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a>csv.field_size_limit(sys.maxsize)</span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="kw">def</span> analyze_csv(file_path, output_csv):</span>
<span id="cb12-10"><a href="#cb12-10"></a>    results <span class="op">=</span> {</span>
<span id="cb12-11"><a href="#cb12-11"></a>        <span class="st">&quot;TOTAL&quot;</span>: {<span class="st">&quot;repos&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_files&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;time_period&quot;</span>: <span class="va">None</span>},</span>
<span id="cb12-12"><a href="#cb12-12"></a>        <span class="st">&quot;Terraform&quot;</span>: {<span class="st">&quot;repos&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_files&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;time_period&quot;</span>: <span class="va">None</span>},</span>
<span id="cb12-13"><a href="#cb12-13"></a>        <span class="st">&quot;Pulumi&quot;</span>: {<span class="st">&quot;repos&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_files&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;time_period&quot;</span>: <span class="va">None</span>},</span>
<span id="cb12-14"><a href="#cb12-14"></a>        <span class="st">&quot;AWS CDK&quot;</span>: {<span class="st">&quot;repos&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_files&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;time_period&quot;</span>: <span class="va">None</span>},</span>
<span id="cb12-15"><a href="#cb12-15"></a>        <span class="st">&quot;NUBANK&quot;</span>: {<span class="st">&quot;repos&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_files&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;iac_commits&quot;</span>: <span class="dv">0</span>, <span class="st">&quot;time_period&quot;</span>: <span class="va">None</span>}</span>
<span id="cb12-16"><a href="#cb12-16"></a>    }</span>
<span id="cb12-17"><a href="#cb12-17"></a></span>
<span id="cb12-18"><a href="#cb12-18"></a>    time_periods <span class="op">=</span> {<span class="st">&quot;TOTAL&quot;</span>: [], <span class="st">&quot;Terraform&quot;</span>: [], <span class="st">&quot;Pulumi&quot;</span>: [], <span class="st">&quot;AWS CDK&quot;</span>: [], <span class="st">&quot;NUBANK&quot;</span>: []}</span>
<span id="cb12-19"><a href="#cb12-19"></a></span>
<span id="cb12-20"><a href="#cb12-20"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_path, newline<span class="op">=</span><span class="st">&#39;&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> csvfile:</span>
<span id="cb12-21"><a href="#cb12-21"></a>        reader <span class="op">=</span> csv.DictReader(csvfile)</span>
<span id="cb12-22"><a href="#cb12-22"></a>        <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(reader, <span class="dv">1</span>):</span>
<span id="cb12-23"><a href="#cb12-23"></a>            <span class="cf">try</span>:</span>
<span id="cb12-24"><a href="#cb12-24"></a>                iac_paths <span class="op">=</span> row[<span class="st">&quot;iac_paths&quot;</span>].strip(<span class="st">&quot;[]&quot;</span>).split(<span class="st">&quot;, &quot;</span>)</span>
<span id="cb12-25"><a href="#cb12-25"></a>                related_files <span class="op">=</span> row[<span class="st">&quot;related_files&quot;</span>].strip(<span class="st">&quot;[]&quot;</span>).split(<span class="st">&quot;, &quot;</span>)</span>
<span id="cb12-26"><a href="#cb12-26"></a></span>
<span id="cb12-27"><a href="#cb12-27"></a>                iac_files_count <span class="op">=</span> <span class="bu">len</span>(iac_paths) <span class="cf">if</span> iac_paths[<span class="dv">0</span>] <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb12-28"><a href="#cb12-28"></a>                related_commits_count <span class="op">=</span> <span class="bu">len</span>(related_files) <span class="cf">if</span> related_files[<span class="dv">0</span>] <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb12-29"><a href="#cb12-29"></a></span>
<span id="cb12-30"><a href="#cb12-30"></a>                total_commits <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">&quot;total_commit_count&quot;</span>])</span>
<span id="cb12-31"><a href="#cb12-31"></a>                repo_name <span class="op">=</span> row[<span class="st">&quot;iac_type&quot;</span>]</span>
<span id="cb12-32"><a href="#cb12-32"></a>                first_commit_date <span class="op">=</span> datetime.strptime(row[<span class="st">&quot;oldest_commit&quot;</span>], <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S %z&quot;</span>)</span>
<span id="cb12-33"><a href="#cb12-33"></a>                last_commit_date <span class="op">=</span> datetime.strptime(row[<span class="st">&quot;newest_commit&quot;</span>], <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S %z&quot;</span>)</span>
<span id="cb12-34"><a href="#cb12-34"></a></span>
<span id="cb12-35"><a href="#cb12-35"></a>                category <span class="op">=</span> <span class="st">&quot;TOTAL&quot;</span></span>
<span id="cb12-36"><a href="#cb12-36"></a>                <span class="cf">if</span> <span class="st">&quot;terraform&quot;</span> <span class="op">==</span> repo_name.lower():</span>
<span id="cb12-37"><a href="#cb12-37"></a>                    category <span class="op">=</span> <span class="st">&quot;Terraform&quot;</span></span>
<span id="cb12-38"><a href="#cb12-38"></a>                <span class="cf">elif</span> <span class="st">&quot;pulumi&quot;</span> <span class="op">==</span> repo_name.lower():</span>
<span id="cb12-39"><a href="#cb12-39"></a>                    category <span class="op">=</span> <span class="st">&quot;Pulumi&quot;</span></span>
<span id="cb12-40"><a href="#cb12-40"></a>                <span class="cf">elif</span> <span class="st">&quot;aws cdk&quot;</span> <span class="op">==</span> repo_name.lower():</span>
<span id="cb12-41"><a href="#cb12-41"></a>                    category <span class="op">=</span> <span class="st">&quot;AWS CDK&quot;</span></span>
<span id="cb12-42"><a href="#cb12-42"></a>                <span class="cf">elif</span> <span class="st">&quot;nubank&quot;</span> <span class="op">==</span> repo_name.lower():</span>
<span id="cb12-43"><a href="#cb12-43"></a>                    category <span class="op">=</span> <span class="st">&quot;NUBANK&quot;</span></span>
<span id="cb12-44"><a href="#cb12-44"></a></span>
<span id="cb12-45"><a href="#cb12-45"></a>                <span class="bu">print</span>(<span class="ss">f&quot;[INFO] Linha </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>repo_name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb12-46"><a href="#cb12-46"></a></span>
<span id="cb12-47"><a href="#cb12-47"></a>                <span class="co"># Atualizar mtricas</span></span>
<span id="cb12-48"><a href="#cb12-48"></a>                results[category][<span class="st">&quot;repos&quot;</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb12-49"><a href="#cb12-49"></a>                results[category][<span class="st">&quot;commits&quot;</span>] <span class="op">+=</span> total_commits</span>
<span id="cb12-50"><a href="#cb12-50"></a>                results[category][<span class="st">&quot;iac_files&quot;</span>] <span class="op">+=</span> iac_files_count</span>
<span id="cb12-51"><a href="#cb12-51"></a>                results[category][<span class="st">&quot;iac_commits&quot;</span>] <span class="op">+=</span> related_commits_count</span>
<span id="cb12-52"><a href="#cb12-52"></a>                time_periods[category].append(first_commit_date)</span>
<span id="cb12-53"><a href="#cb12-53"></a>                time_periods[category].append(last_commit_date)</span>
<span id="cb12-54"><a href="#cb12-54"></a></span>
<span id="cb12-55"><a href="#cb12-55"></a>                <span class="co"># Atualizar TOTAL</span></span>
<span id="cb12-56"><a href="#cb12-56"></a>                results[<span class="st">&quot;TOTAL&quot;</span>][<span class="st">&quot;repos&quot;</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb12-57"><a href="#cb12-57"></a>                results[<span class="st">&quot;TOTAL&quot;</span>][<span class="st">&quot;commits&quot;</span>] <span class="op">+=</span> total_commits</span>
<span id="cb12-58"><a href="#cb12-58"></a>                results[<span class="st">&quot;TOTAL&quot;</span>][<span class="st">&quot;iac_files&quot;</span>] <span class="op">+=</span> iac_files_count</span>
<span id="cb12-59"><a href="#cb12-59"></a>                results[<span class="st">&quot;TOTAL&quot;</span>][<span class="st">&quot;iac_commits&quot;</span>] <span class="op">+=</span> related_commits_count</span>
<span id="cb12-60"><a href="#cb12-60"></a>                time_periods[<span class="st">&quot;TOTAL&quot;</span>].append(first_commit_date)</span>
<span id="cb12-61"><a href="#cb12-61"></a>                time_periods[<span class="st">&quot;TOTAL&quot;</span>].append(last_commit_date)</span>
<span id="cb12-62"><a href="#cb12-62"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb12-63"><a href="#cb12-63"></a>                <span class="bu">print</span>(<span class="ss">f&quot;[ERROR] Erro na linha </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb12-64"><a href="#cb12-64"></a>                traceback.print_exc()</span>
<span id="cb12-65"><a href="#cb12-65"></a>                <span class="cf">continue</span></span>
<span id="cb12-66"><a href="#cb12-66"></a></span>
<span id="cb12-67"><a href="#cb12-67"></a>    <span class="co"># Calcular o perodo de tempo para cada categoria</span></span>
<span id="cb12-68"><a href="#cb12-68"></a>    <span class="cf">for</span> category, times <span class="kw">in</span> time_periods.items():</span>
<span id="cb12-69"><a href="#cb12-69"></a>        <span class="cf">if</span> times:</span>
<span id="cb12-70"><a href="#cb12-70"></a>            results[category][<span class="st">&quot;time_period&quot;</span>] <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span><span class="bu">min</span>(times)<span class="sc">.</span>strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st">&#39;</span>)<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(times)<span class="sc">.</span>strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st">&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb12-71"><a href="#cb12-71"></a></span>
<span id="cb12-72"><a href="#cb12-72"></a>    <span class="co"># Escrever resultados no CSV</span></span>
<span id="cb12-73"><a href="#cb12-73"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_csv, mode<span class="op">=</span><span class="st">&#39;w&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> csvfile:</span>
<span id="cb12-74"><a href="#cb12-74"></a>        fieldnames <span class="op">=</span> [<span class="st">&quot;category&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;repos&quot;</span>, <span class="st">&quot;total_commits&quot;</span>, <span class="st">&quot;iac_files&quot;</span>, <span class="st">&quot;iac_commits&quot;</span>, <span class="st">&quot;time_period&quot;</span>]</span>
<span id="cb12-75"><a href="#cb12-75"></a>        writer <span class="op">=</span> csv.DictWriter(csvfile, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb12-76"><a href="#cb12-76"></a></span>
<span id="cb12-77"><a href="#cb12-77"></a>        writer.writeheader()</span>
<span id="cb12-78"><a href="#cb12-78"></a>        <span class="cf">for</span> category, data <span class="kw">in</span> results.items():</span>
<span id="cb12-79"><a href="#cb12-79"></a>            writer.writerow({</span>
<span id="cb12-80"><a href="#cb12-80"></a>                <span class="st">&quot;category&quot;</span>: category,</span>
<span id="cb12-81"><a href="#cb12-81"></a>                <span class="st">&quot;type&quot;</span>: <span class="st">&quot;GIT&quot;</span> <span class="cf">if</span> category <span class="op">!=</span> <span class="st">&quot;TOTAL&quot;</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb12-82"><a href="#cb12-82"></a>                <span class="st">&quot;repos&quot;</span>: data[<span class="st">&quot;repos&quot;</span>],</span>
<span id="cb12-83"><a href="#cb12-83"></a>                <span class="st">&quot;total_commits&quot;</span>: data[<span class="st">&quot;commits&quot;</span>],</span>
<span id="cb12-84"><a href="#cb12-84"></a>                <span class="st">&quot;iac_files&quot;</span>: data[<span class="st">&quot;iac_files&quot;</span>],</span>
<span id="cb12-85"><a href="#cb12-85"></a>                <span class="st">&quot;iac_commits&quot;</span>: data[<span class="st">&quot;iac_commits&quot;</span>],</span>
<span id="cb12-86"><a href="#cb12-86"></a>                <span class="st">&quot;time_period&quot;</span>: data[<span class="st">&quot;time_period&quot;</span>] <span class="cf">if</span> data[<span class="st">&quot;time_period&quot;</span>] <span class="cf">else</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb12-87"><a href="#cb12-87"></a>            })</span>
<span id="cb12-88"><a href="#cb12-88"></a></span>
<span id="cb12-89"><a href="#cb12-89"></a></span>
<span id="cb12-90"><a href="#cb12-90"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb12-91"><a href="#cb12-91"></a>    <span class="cf">if</span> <span class="st">&quot;--input&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv <span class="kw">or</span> <span class="st">&quot;--output&quot;</span> <span class="kw">not</span> <span class="kw">in</span> sys.argv:</span>
<span id="cb12-92"><a href="#cb12-92"></a>        <span class="bu">print</span>(<span class="st">&quot;Usage: python3 4-analyze.py --input path --output path&quot;</span>)</span>
<span id="cb12-93"><a href="#cb12-93"></a>        sys.exit(<span class="dv">1</span>)</span>
<span id="cb12-94"><a href="#cb12-94"></a></span>
<span id="cb12-95"><a href="#cb12-95"></a>    input_csv <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--input&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb12-96"><a href="#cb12-96"></a>    output_csv <span class="op">=</span> os.path.abspath(sys.argv[sys.argv.index(<span class="st">&quot;--output&quot;</span>) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb12-97"><a href="#cb12-97"></a></span>
<span id="cb12-98"><a href="#cb12-98"></a>    analyze_csv(input_csv, output_csv)</span>
<span id="cb12-99"><a href="#cb12-99"></a></span>
<span id="cb12-100"><a href="#cb12-100"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Resultados armazenados em: </span><span class="sc">{</span>output_csv<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<h2 id="script-shell">Script Shell</h2>
<h3 id="repository-cloner-code">Repository Cloner Code</h3>
<div class="sourceCode" id="cb13"><pre
class="sourceCode numberSource sh numberLines"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># Initial configurations</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="va">default_dir</span><span class="op">=</span><span class="st">&quot;dataset&quot;</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="va">log_file</span><span class="op">=</span><span class="st">&quot;clone_logs.csv&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="va">repos_file</span><span class="op">=</span><span class="st">&quot;repos_list.txt&quot;</span> <span class="co"># File with the list of repositories</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="va">threads</span><span class="op">=</span>10 <span class="co"># Number of threads</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="va">start_line</span><span class="op">=</span>2 <span class="co"># Default starting line</span></span>
<span id="cb13-9"><a href="#cb13-9"></a></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="kw">function</span><span class="fu"> usage()</span> <span class="kw">{</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="bu">echo</span> <span class="st">&quot;Usage: </span><span class="va">$0</span><span class="st"> [-d directory] [-f repos_file] [-s start_line] [-t threads] [-c credential]&quot;</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="bu">echo</span> <span class="st">&quot;Options:&quot;</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="bu">echo</span> <span class="st">&quot;  -d  Destination directory for cloning repositories (default: dataset)&quot;</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>  <span class="bu">echo</span> <span class="st">&quot;  -f  File containing the list of repositories (one per line) (default: repos_list.txt)&quot;</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>  <span class="bu">echo</span> <span class="st">&quot;  -s  Starting line to continue cloning (default: 2)&quot;</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>  <span class="bu">echo</span> <span class="st">&quot;  -t  Number of simultaneous clones (default: 10)&quot;</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>  <span class="bu">echo</span> <span class="st">&quot;  -c  Credential type: ssh or token&quot;</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>  <span class="bu">exit</span> 1</span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="kw">}</span></span>
<span id="cb13-20"><a href="#cb13-20"></a></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co"># Process arguments</span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="cf">while</span> <span class="bu">getopts</span> <span class="st">&quot;d:f:s:t:c:&quot;</span> <span class="va">opt</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-23"><a href="#cb13-23"></a>  <span class="cf">case</span> <span class="st">&quot;</span><span class="va">$opt</span><span class="st">&quot;</span> <span class="kw">in</span></span>
<span id="cb13-24"><a href="#cb13-24"></a>    <span class="ss">d</span><span class="kw">)</span> <span class="va">target_dir</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb13-25"><a href="#cb13-25"></a>    <span class="ss">f</span><span class="kw">)</span> <span class="va">repos_file</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb13-26"><a href="#cb13-26"></a>    <span class="ss">s</span><span class="kw">)</span> <span class="va">start_line</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb13-27"><a href="#cb13-27"></a>    <span class="ss">t</span><span class="kw">)</span> <span class="va">threads</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb13-28"><a href="#cb13-28"></a>    <span class="ss">c</span><span class="kw">)</span> <span class="va">credential_type</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb13-29"><a href="#cb13-29"></a>    <span class="pp">*</span><span class="kw">)</span> <span class="ex">usage</span> <span class="cf">;;</span></span>
<span id="cb13-30"><a href="#cb13-30"></a>  <span class="cf">esac</span></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="cf">done</span></span>
<span id="cb13-32"><a href="#cb13-32"></a></span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="kw">[[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">&quot;</span> <span class="kw">]]</span> <span class="kw">&amp;&amp;</span> <span class="va">target_dir</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$default_dir</span><span class="st">&quot;</span></span>
<span id="cb13-34"><a href="#cb13-34"></a><span class="kw">[[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$credential_type</span><span class="st">&quot;</span> <span class="kw">]]</span> <span class="kw">&amp;&amp;</span> <span class="va">credential_type</span><span class="op">=</span><span class="st">&quot;ssh&quot;</span></span>
<span id="cb13-35"><a href="#cb13-35"></a></span>
<span id="cb13-36"><a href="#cb13-36"></a><span class="co"># Initial validations</span></span>
<span id="cb13-37"><a href="#cb13-37"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$repos_file</span><span class="st">&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb13-38"><a href="#cb13-38"></a>  <span class="bu">echo</span> <span class="st">&quot;Error: Repositories file (</span><span class="va">$repos_file</span><span class="st">) not found.&quot;</span></span>
<span id="cb13-39"><a href="#cb13-39"></a>  <span class="bu">exit</span> 1</span>
<span id="cb13-40"><a href="#cb13-40"></a><span class="cf">fi</span></span>
<span id="cb13-41"><a href="#cb13-41"></a></span>
<span id="cb13-42"><a href="#cb13-42"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$credential_type</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;ssh&quot;</span> <span class="kw">&amp;&amp;</span> <span class="st">&quot;</span><span class="va">$credential_type</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;token&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb13-43"><a href="#cb13-43"></a>  <span class="bu">echo</span> <span class="st">&quot;Error: Invalid credential type. Use &#39;ssh&#39; or &#39;token&#39;.&quot;</span></span>
<span id="cb13-44"><a href="#cb13-44"></a>  <span class="bu">exit</span> 1</span>
<span id="cb13-45"><a href="#cb13-45"></a><span class="cf">fi</span></span>
<span id="cb13-46"><a href="#cb13-46"></a></span>
<span id="cb13-47"><a href="#cb13-47"></a><span class="co"># The following command can prevent parallelism errors</span></span>
<span id="cb13-48"><a href="#cb13-48"></a><span class="co"># It increases the limit of open files</span></span>
<span id="cb13-49"><a href="#cb13-49"></a><span class="bu">ulimit</span> <span class="at">-n</span> 4096</span>
<span id="cb13-50"><a href="#cb13-50"></a></span>
<span id="cb13-51"><a href="#cb13-51"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">&quot;</span></span>
<span id="cb13-52"><a href="#cb13-52"></a><span class="bu">echo</span> <span class="st">&quot;Destination directory created at (</span><span class="va">$target_dir</span><span class="st">)&quot;</span></span>
<span id="cb13-53"><a href="#cb13-53"></a></span>
<span id="cb13-54"><a href="#cb13-54"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb13-55"><a href="#cb13-55"></a>  <span class="bu">echo</span> <span class="st">&quot;Repository,Status,Message&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb13-56"><a href="#cb13-56"></a><span class="cf">fi</span></span>
<span id="cb13-57"><a href="#cb13-57"></a><span class="bu">echo</span> <span class="st">&quot;Log file created at (</span><span class="va">$log_file</span><span class="st">)&quot;</span></span>
<span id="cb13-58"><a href="#cb13-58"></a></span>
<span id="cb13-59"><a href="#cb13-59"></a><span class="fu">clone_repo()</span> <span class="kw">{</span></span>
<span id="cb13-60"><a href="#cb13-60"></a>  <span class="bu">local</span> <span class="va">repo_url</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span></span>
<span id="cb13-61"><a href="#cb13-61"></a>  <span class="bu">local</span> <span class="va">repo_name</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="at">-s</span> .git <span class="st">&quot;</span><span class="va">$repo_url</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb13-62"><a href="#cb13-62"></a></span>
<span id="cb13-63"><a href="#cb13-63"></a>  <span class="cf">if</span> <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$credential_type</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;token&quot;</span> <span class="kw">&amp;&amp;</span> <span class="st">&quot;</span><span class="va">$repo_url</span><span class="st">&quot;</span> <span class="ot">==</span> https://<span class="pp">*</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb13-64"><a href="#cb13-64"></a>    <span class="va">repo_url</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$repo_url</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&quot;s|https://|https://</span><span class="va">$github_token</span><span class="st">@|&quot;</span><span class="va">)</span></span>
<span id="cb13-65"><a href="#cb13-65"></a>  <span class="cf">fi</span></span>
<span id="cb13-66"><a href="#cb13-66"></a></span>
<span id="cb13-67"><a href="#cb13-67"></a>  <span class="bu">echo</span> <span class="st">&quot;Cloning </span><span class="va">$repo_name</span><span class="st">...&quot;</span></span>
<span id="cb13-68"><a href="#cb13-68"></a></span>
<span id="cb13-69"><a href="#cb13-69"></a>  <span class="cf">if</span> <span class="fu">git</span> clone <span class="st">&quot;</span><span class="va">$repo_url</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">/</span><span class="va">$repo_name</span><span class="st">&quot;</span> <span class="op">&amp;&gt;</span>/dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb13-70"><a href="#cb13-70"></a>    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$repo_url</span><span class="st">,Success,&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb13-71"><a href="#cb13-71"></a>    <span class="bu">echo</span> <span class="st">&quot;[OK] </span><span class="va">$repo_name</span><span class="st"> cloned successfully.&quot;</span></span>
<span id="cb13-72"><a href="#cb13-72"></a>  <span class="cf">else</span></span>
<span id="cb13-73"><a href="#cb13-73"></a>    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$repo_url</span><span class="st">,Error,Failed to clone&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb13-74"><a href="#cb13-74"></a>    <span class="bu">echo</span> <span class="st">&quot;[ERROR] Failed to clone </span><span class="va">$repo_name</span><span class="st">.&quot;</span></span>
<span id="cb13-75"><a href="#cb13-75"></a>  <span class="cf">fi</span></span>
<span id="cb13-76"><a href="#cb13-76"></a><span class="kw">}</span></span>
<span id="cb13-77"><a href="#cb13-77"></a></span>
<span id="cb13-78"><a href="#cb13-78"></a><span class="bu">export</span> <span class="at">-f</span> <span class="va">clone_repo</span></span>
<span id="cb13-79"><a href="#cb13-79"></a><span class="bu">export</span> <span class="va">credential_type</span></span>
<span id="cb13-80"><a href="#cb13-80"></a><span class="va">github_token</span><span class="op">=</span><span class="st">&quot;&quot;</span></span>
<span id="cb13-81"><a href="#cb13-81"></a></span>
<span id="cb13-82"><a href="#cb13-82"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$credential_type</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;token&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb13-83"><a href="#cb13-83"></a>  <span class="bu">echo</span> <span class="st">&quot;Enter the GitHub token: &quot;</span></span>
<span id="cb13-84"><a href="#cb13-84"></a>  <span class="bu">read</span> <span class="at">-s</span> <span class="va">github_token</span></span>
<span id="cb13-85"><a href="#cb13-85"></a>  <span class="bu">export</span> <span class="va">github_token</span></span>
<span id="cb13-86"><a href="#cb13-86"></a><span class="cf">fi</span></span>
<span id="cb13-87"><a href="#cb13-87"></a><span class="bu">export</span> <span class="va">target_dir</span></span>
<span id="cb13-88"><a href="#cb13-88"></a><span class="bu">export</span> <span class="va">log_file</span></span>
<span id="cb13-89"><a href="#cb13-89"></a></span>
<span id="cb13-90"><a href="#cb13-90"></a><span class="co"># Process repositories in parallel</span></span>
<span id="cb13-91"><a href="#cb13-91"></a><span class="va">repos_to_clone</span><span class="op">=</span><span class="va">$(</span><span class="fu">tail</span> <span class="at">-n</span> +<span class="va">$start_line</span> <span class="st">&quot;</span><span class="va">$repos_file</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb13-92"><a href="#cb13-92"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$repos_to_clone</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="at">-P</span> <span class="va">$threads</span> <span class="at">-n</span> 1 <span class="at">-I</span> {} bash <span class="at">-c</span> <span class="st">&#39;clone_repo &quot;$1&quot;&#39;</span> _ {}</span>
<span id="cb13-93"><a href="#cb13-93"></a></span>
<span id="cb13-94"><a href="#cb13-94"></a><span class="fu">mkdir</span> <span class="at">-p</span> csv</span>
<span id="cb13-95"><a href="#cb13-95"></a><span class="fu">mv</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span> <span class="st">&quot;csv/</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb13-96"><a href="#cb13-96"></a></span>
<span id="cb13-97"><a href="#cb13-97"></a><span class="fu">find</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">&quot;</span> <span class="at">-type</span> d <span class="at">-exec</span> chmod +x {} <span class="dt">\;</span></span>
<span id="cb13-98"><a href="#cb13-98"></a></span>
<span id="cb13-99"><a href="#cb13-99"></a><span class="bu">echo</span> <span class="st">&quot;Process completed. Logs saved in csv/</span><span class="va">$log_file</span><span class="st">.&quot;</span></span></code></pre></div>
<h3 id="criteria-applier-code">Criteria Applier Code</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode numberSource sh numberLines"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="va">log_file</span><span class="op">=</span><span class="st">&quot;criterias.log&quot;</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="va">default_dir</span><span class="op">=</span><span class="st">&quot;dataset&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="va">python_cmd</span><span class="op">=</span><span class="st">&quot;python3&quot;</span></span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="kw">function</span><span class="fu"> usage()</span> <span class="kw">{</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="bu">echo</span> <span class="st">&quot;Usage: </span><span class="va">$0</span><span class="st"> [-d directory] [-p python_interpreter]&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="bu">echo</span> <span class="st">&quot;Options:&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="bu">echo</span> <span class="st">&quot;  -d  Specify the directory of the repositories cloned (default: dataset)&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="bu">echo</span> <span class="st">&quot;  -p  Specify the Python interpreter (default: python3)&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="bu">exit</span> 1</span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="kw">}</span></span>
<span id="cb14-14"><a href="#cb14-14"></a></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="cf">while</span> <span class="bu">getopts</span> <span class="st">&quot;d:p:&quot;</span> <span class="va">opt</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>  <span class="cf">case</span> <span class="st">&quot;</span><span class="va">$opt</span><span class="st">&quot;</span> <span class="kw">in</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>    <span class="ss">d</span><span class="kw">)</span> <span class="va">target_dir</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>    <span class="ss">p</span><span class="kw">)</span> <span class="va">python_cmd</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>    <span class="pp">*</span><span class="kw">)</span> <span class="ex">usage</span> <span class="cf">;;</span></span>
<span id="cb14-20"><a href="#cb14-20"></a>  <span class="cf">esac</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="cf">done</span></span>
<span id="cb14-22"><a href="#cb14-22"></a></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb14-24"><a href="#cb14-24"></a>  <span class="va">target_dir</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$default_dir</span><span class="st">&quot;</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="cf">fi</span></span>
<span id="cb14-26"><a href="#cb14-26"></a></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="bu">echo</span> <span class="st">&quot;Execution of the apply criterias script started&quot;</span> <span class="op">&gt;</span> <span class="va">$log_file</span></span>
<span id="cb14-28"><a href="#cb14-28"></a></span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="kw">function</span><span class="fu"> handle_error()</span> <span class="kw">{</span></span>
<span id="cb14-30"><a href="#cb14-30"></a>  <span class="bu">echo</span> <span class="st">&quot;[ERROR] </span><span class="va">$1</span><span class="st">. Exiting.&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-31"><a href="#cb14-31"></a>  <span class="bu">exit</span> 1</span>
<span id="cb14-32"><a href="#cb14-32"></a><span class="kw">}</span></span>
<span id="cb14-33"><a href="#cb14-33"></a></span>
<span id="cb14-34"><a href="#cb14-34"></a><span class="fu">mkdir</span> <span class="at">-p</span> csv/criterias-output <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Failed to create CSV directories&quot;</span></span>
<span id="cb14-35"><a href="#cb14-35"></a></span>
<span id="cb14-36"><a href="#cb14-36"></a><span class="bu">echo</span> <span class="st">&quot;Creating criterias directories...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-37"><a href="#cb14-37"></a><span class="fu">mkdir</span> <span class="at">-p</span> criterias/criteria1 criterias/criteria2 criterias/criteria3 criterias/criteria4 <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Failed to create criterias directories&quot;</span></span>
<span id="cb14-38"><a href="#cb14-38"></a></span>
<span id="cb14-39"><a href="#cb14-39"></a><span class="bu">echo</span> <span class="st">&quot;Running the first filtering process...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-40"><a href="#cb14-40"></a><span class="va">$python_cmd</span> replication/criterias.py <span class="at">--dataset</span> <span class="va">$target_dir</span> <span class="at">--input</span> <span class="va">$target_dir</span> <span class="at">--output</span> criterias/criteria1 <span class="at">--iac-percentage</span> <span class="at">--csv</span> csv/criterias-output/criterias_results.csv <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;First filtering process failed&quot;</span></span>
<span id="cb14-41"><a href="#cb14-41"></a></span>
<span id="cb14-42"><a href="#cb14-42"></a><span class="bu">echo</span> <span class="st">&quot;Running the second filtering process...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="va">$python_cmd</span> replication/criterias.py <span class="at">--dataset</span> <span class="va">$target_dir</span> <span class="at">--input</span> criterias/criteria1 <span class="at">--output</span> criterias/criteria2 <span class="at">--fork</span> <span class="at">--csv</span> csv/criterias-output/criterias_results.csv <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Second filtering process failed&quot;</span></span>
<span id="cb14-44"><a href="#cb14-44"></a></span>
<span id="cb14-45"><a href="#cb14-45"></a><span class="bu">echo</span> <span class="st">&quot;Running the third filtering process...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-46"><a href="#cb14-46"></a><span class="va">$python_cmd</span> replication/criterias.py <span class="at">--dataset</span> <span class="va">$target_dir</span> <span class="at">--input</span> criterias/criteria2 <span class="at">--output</span> criterias/criteria3 <span class="at">--commits-per-month</span> <span class="at">--csv</span> csv/criterias-output/criterias_results.csv <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Third filtering process failed&quot;</span></span>
<span id="cb14-47"><a href="#cb14-47"></a></span>
<span id="cb14-48"><a href="#cb14-48"></a><span class="bu">echo</span> <span class="st">&quot;Running the fourth filtering process...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-49"><a href="#cb14-49"></a><span class="va">$python_cmd</span> replication/criterias.py <span class="at">--dataset</span> <span class="va">$target_dir</span> <span class="at">--input</span> criterias/criteria3 <span class="at">--output</span> criterias/criteria4 <span class="at">--num-contributors</span> <span class="at">--csv</span> csv/criterias-output/criterias_results.csv <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Fourth filtering process failed&quot;</span></span>
<span id="cb14-50"><a href="#cb14-50"></a></span>
<span id="cb14-51"><a href="#cb14-51"></a><span class="bu">echo</span> <span class="st">&quot;Creating CSV directories...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-52"><a href="#cb14-52"></a><span class="fu">mkdir</span> <span class="at">-p</span> csv/criterias-output/criterias-frequency <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Failed to create CSV directories&quot;</span></span>
<span id="cb14-53"><a href="#cb14-53"></a></span>
<span id="cb14-54"><a href="#cb14-54"></a><span class="bu">echo</span> <span class="st">&quot;Generating the CSV with related files...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-55"><a href="#cb14-55"></a><span class="va">$python_cmd</span> replication/1-related-files-generator.py <span class="at">--input</span> <span class="va">$target_dir</span> <span class="at">--output</span> csv/criterias-output/csv1_files_with_neighbors.csv <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;CSV related files generation failed&quot;</span></span>
<span id="cb14-56"><a href="#cb14-56"></a></span>
<span id="cb14-57"><a href="#cb14-57"></a><span class="bu">echo</span> <span class="st">&quot;Generating the CSV with the commits summary...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-58"><a href="#cb14-58"></a><span class="va">$python_cmd</span> replication/2-commits-count.py <span class="at">--input</span> csv/criterias-output/csv1_files_with_neighbors.csv <span class="at">--output</span> csv/criterias-output/csv2_iac_commits_summary.csv <span class="at">--dataset-dir</span> <span class="va">$target_dir</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Commits summary CSV generation failed&quot;</span></span>
<span id="cb14-59"><a href="#cb14-59"></a></span>
<span id="cb14-60"><a href="#cb14-60"></a><span class="bu">echo</span> <span class="st">&quot;Generating the CSV with the time period...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-61"><a href="#cb14-61"></a><span class="va">$python_cmd</span> replication/3-time-period.py <span class="at">--input</span> csv/criterias-output/csv2_iac_commits_summary.csv <span class="at">--output</span> csv/criterias-output/csv3_iac_criterias_output.csv <span class="at">--dataset-dir</span> <span class="va">$target_dir</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Time period CSV generation failed&quot;</span></span>
<span id="cb14-62"><a href="#cb14-62"></a></span>
<span id="cb14-63"><a href="#cb14-63"></a><span class="bu">echo</span> <span class="st">&quot;Generating the CSV with frequency...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-64"><a href="#cb14-64"></a><span class="va">$python_cmd</span> replication/4-analyze.py <span class="at">--input</span> csv/criterias-output/csv3_iac_criterias_output.csv <span class="at">--output</span> csv/criterias-output/csv4_iac_output_frequency.csv <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Frequency CSV generation failed&quot;</span></span>
<span id="cb14-65"><a href="#cb14-65"></a></span>
<span id="cb14-66"><a href="#cb14-66"></a><span class="bu">echo</span> <span class="st">&quot;Generating criterias frequency csv...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span>
<span id="cb14-67"><a href="#cb14-67"></a><span class="va">$python_cmd</span> replication/criteria-frequency.py <span class="at">--input</span> criterias/criteria1,criterias/criteria2,criterias/criteria3,criterias/criteria4,<span class="va">$target_dir</span> <span class="at">--output</span> csv/criterias-output/criterias-frequency <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span> <span class="kw">||</span> <span class="ex">handle_error</span> <span class="st">&quot;Criterias frequency CSV generation failed&quot;</span></span>
<span id="cb14-68"><a href="#cb14-68"></a></span>
<span id="cb14-69"><a href="#cb14-69"></a><span class="bu">echo</span> <span class="st">&quot;Criterias execution completed. Logs saved to </span><span class="va">$log_file</span><span class="st">.&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$log_file</span></span></code></pre></div>
<h3 id="acid-runner-code">ACID Runner Code</h3>
<div class="sourceCode" id="cb15"><pre
class="sourceCode numberSource sh numberLines"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="va">log_file</span><span class="op">=</span><span class="st">&quot;run_acid.log&quot;</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="va">source_dir</span><span class="op">=</span><span class="st">&quot;dataset&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="va">flag_arg</span><span class="op">=</span><span class="st">&quot;REPLICATION&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="va">target_dir</span><span class="op">=</span><span class="st">&quot;ACID/dataset/</span><span class="va">$flag_arg</span><span class="st">&quot;</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="va">output_dir</span><span class="op">=</span><span class="st">&quot;csv/acid-output&quot;</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="va">script_to_run</span><span class="op">=</span><span class="st">&quot;ACID/main.py&quot;</span>  </span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="va">python_cmd</span><span class="op">=</span><span class="st">&quot;python3&quot;</span>          </span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="kw">function</span><span class="fu"> usage()</span> <span class="kw">{</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>  <span class="bu">echo</span> <span class="st">&quot;Usage: </span><span class="va">$0</span><span class="st"> [-c] [-p &lt;python_interpreter&gt;]&quot;</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>  <span class="bu">echo</span> <span class="st">&quot;Options:&quot;</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>  <span class="bu">echo</span> <span class="st">&quot;  -c    Use &#39;main-concurrent.py&#39; instead of &#39;main.py&#39;&quot;</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>  <span class="bu">echo</span> <span class="st">&quot;  -p    Specify the Python interpreter (default is &#39;python3&#39;)&quot;</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>  <span class="bu">exit</span> 1</span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="kw">}</span></span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="bu">echo</span> <span class="st">&quot;Starting run-acid.sh&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-20"><a href="#cb15-20"></a></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="cf">while</span> <span class="bu">getopts</span> <span class="st">&quot;cp:&quot;</span> <span class="va">opt</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb15-22"><a href="#cb15-22"></a>  <span class="cf">case</span> <span class="st">&quot;</span><span class="va">$opt</span><span class="st">&quot;</span> <span class="kw">in</span></span>
<span id="cb15-23"><a href="#cb15-23"></a>    <span class="ss">c</span><span class="kw">)</span> </span>
<span id="cb15-24"><a href="#cb15-24"></a>      <span class="va">script_to_run</span><span class="op">=</span><span class="st">&quot;ACID/main-concurrent.py&quot;</span></span>
<span id="cb15-25"><a href="#cb15-25"></a>      <span class="bu">echo</span> <span class="st">&quot;[INFO] Using concurrent script: </span><span class="va">$script_to_run</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-26"><a href="#cb15-26"></a>      <span class="cf">;;</span></span>
<span id="cb15-27"><a href="#cb15-27"></a>    <span class="ss">p</span><span class="kw">)</span> </span>
<span id="cb15-28"><a href="#cb15-28"></a>      <span class="va">python_cmd</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OPTARG</span><span class="st">&quot;</span></span>
<span id="cb15-29"><a href="#cb15-29"></a>      <span class="bu">echo</span> <span class="st">&quot;[INFO] Using Python interpreter: </span><span class="va">$python_cmd</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-30"><a href="#cb15-30"></a>      <span class="cf">;;</span></span>
<span id="cb15-31"><a href="#cb15-31"></a>    <span class="pp">*</span><span class="kw">)</span> </span>
<span id="cb15-32"><a href="#cb15-32"></a>      <span class="ex">usage</span> </span>
<span id="cb15-33"><a href="#cb15-33"></a>      <span class="cf">;;</span></span>
<span id="cb15-34"><a href="#cb15-34"></a>  <span class="cf">esac</span></span>
<span id="cb15-35"><a href="#cb15-35"></a><span class="cf">done</span></span>
<span id="cb15-36"><a href="#cb15-36"></a></span>
<span id="cb15-37"><a href="#cb15-37"></a><span class="bu">echo</span> <span class="st">&quot;[INFO] Creating directories...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-38"><a href="#cb15-38"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;ACID/dataset&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-39"><a href="#cb15-39"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">&quot;</span>  <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-40"><a href="#cb15-40"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$output_dir</span><span class="st">&quot;</span>  <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-41"><a href="#cb15-41"></a></span>
<span id="cb15-42"><a href="#cb15-42"></a><span class="bu">echo</span> <span class="st">&quot;[INFO] Creating symbolic links from </span><span class="va">$source_dir</span><span class="st"> to </span><span class="va">$target_dir</span><span class="st">...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-43"><a href="#cb15-43"></a><span class="cf">for</span> dir <span class="kw">in</span> <span class="st">&quot;</span><span class="va">$source_dir</span><span class="st">&quot;</span>/<span class="pp">*</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb15-44"><a href="#cb15-44"></a>  <span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-d</span> <span class="st">&quot;</span><span class="va">$dir</span><span class="st">&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb15-45"><a href="#cb15-45"></a>    <span class="va">dir_abs_path</span><span class="op">=</span><span class="va">$(</span><span class="fu">realpath</span> <span class="st">&quot;</span><span class="va">$dir</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb15-46"><a href="#cb15-46"></a>    <span class="va">dir_name</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">&quot;</span><span class="va">$dir</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb15-47"><a href="#cb15-47"></a>    </span>
<span id="cb15-48"><a href="#cb15-48"></a>    <span class="fu">ln</span> <span class="at">-s</span> <span class="st">&quot;</span><span class="va">$dir_abs_path</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">/</span><span class="va">$dir_name</span><span class="st">&quot;</span> <span class="dv">2</span><span class="op">&gt;&gt;</span><span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-49"><a href="#cb15-49"></a>    </span>
<span id="cb15-50"><a href="#cb15-50"></a>    <span class="bu">echo</span> <span class="st">&quot;[INFO] Link created: </span><span class="va">$target_dir</span><span class="st">/</span><span class="va">$dir_name</span><span class="st"> -&gt; </span><span class="va">$dir_abs_path</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-51"><a href="#cb15-51"></a>  <span class="cf">fi</span></span>
<span id="cb15-52"><a href="#cb15-52"></a><span class="cf">done</span></span>
<span id="cb15-53"><a href="#cb15-53"></a></span>
<span id="cb15-54"><a href="#cb15-54"></a><span class="bu">echo</span> <span class="st">&quot;[INFO] Generating eligible repositories CSV at </span><span class="va">$target_dir</span><span class="st">/eligible_repos.csv...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-55"><a href="#cb15-55"></a><span class="fu">ls</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$target_dir</span><span class="st">/eligible_repos.csv&quot;</span> <span class="dv">2</span><span class="op">&gt;&gt;</span><span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-56"><a href="#cb15-56"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="va">$?</span> <span class="ot">-eq</span> 0 <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb15-57"><a href="#cb15-57"></a>  <span class="bu">echo</span> <span class="st">&quot;[SUCCESS] CSV generated successfully.&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-58"><a href="#cb15-58"></a><span class="cf">else</span></span>
<span id="cb15-59"><a href="#cb15-59"></a>  <span class="bu">echo</span> <span class="st">&quot;[ERROR] Failed to generate CSV.&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-60"><a href="#cb15-60"></a>  <span class="bu">exit</span> 1</span>
<span id="cb15-61"><a href="#cb15-61"></a><span class="cf">fi</span></span>
<span id="cb15-62"><a href="#cb15-62"></a></span>
<span id="cb15-63"><a href="#cb15-63"></a><span class="bu">echo</span> <span class="st">&quot;[INFO] Running </span><span class="va">$script_to_run</span><span class="st"> with </span><span class="va">$python_cmd</span><span class="st">...&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-64"><a href="#cb15-64"></a><span class="va">$python_cmd</span> <span class="st">&quot;</span><span class="va">$script_to_run</span><span class="st">&quot;</span> <span class="at">--flag-arg</span> <span class="va">$flag_arg</span> <span class="at">--csv-replication</span> csv/criterias-output/csv3_iac_criterias_output.csv <span class="at">--csv-default</span> <span class="st">&quot;</span><span class="va">$source_dir</span><span class="st">&quot;</span> <span class="at">--output</span> <span class="st">&quot;</span><span class="va">$output_dir</span><span class="st">&quot;</span> <span class="dv">2</span><span class="op">&gt;&gt;</span><span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-65"><a href="#cb15-65"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="va">$?</span> <span class="ot">-eq</span> 0 <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb15-66"><a href="#cb15-66"></a>  <span class="bu">echo</span> <span class="st">&quot;[SUCCESS] </span><span class="va">$script_to_run</span><span class="st"> executed successfully.&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-67"><a href="#cb15-67"></a><span class="cf">else</span></span>
<span id="cb15-68"><a href="#cb15-68"></a>  <span class="bu">echo</span> <span class="st">&quot;[ERROR] </span><span class="va">$script_to_run</span><span class="st"> failed.&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span>
<span id="cb15-69"><a href="#cb15-69"></a>  <span class="bu">exit</span> 1</span>
<span id="cb15-70"><a href="#cb15-70"></a><span class="cf">fi</span></span>
<span id="cb15-71"><a href="#cb15-71"></a></span>
<span id="cb15-72"><a href="#cb15-72"></a><span class="bu">echo</span> <span class="st">&quot;[INFO] Script completed. Logs saved to </span><span class="va">$log_file</span><span class="st">.&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="st">&quot;</span><span class="va">$log_file</span><span class="st">&quot;</span></span></code></pre></div>
</body>
</html>
